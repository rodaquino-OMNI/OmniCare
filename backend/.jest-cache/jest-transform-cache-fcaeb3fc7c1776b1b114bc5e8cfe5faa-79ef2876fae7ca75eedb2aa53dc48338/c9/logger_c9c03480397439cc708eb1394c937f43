0818020586a0ed439875d2e840862dff
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = __importDefault(require("path"));
const winston_1 = __importDefault(require("winston"));
const config_1 = __importDefault(require("../config"));
// Custom format for structured logging
const customFormat = winston_1.default.format.combine(winston_1.default.format.timestamp({
    format: 'YYYY-MM-DD HH:mm:ss',
}), winston_1.default.format.errors({ stack: true }), winston_1.default.format.json());
// Console format for development
const consoleFormat = winston_1.default.format.combine(winston_1.default.format.timestamp({
    format: 'HH:mm:ss',
}), winston_1.default.format.colorize(), winston_1.default.format.simple());
// Create transports array
const transports = [];
// Console transport for all environments
transports.push(new winston_1.default.transports.Console({
    level: config_1.default.server.env === 'development' ? 'debug' : 'info',
    format: config_1.default.server.env === 'development' ? consoleFormat : customFormat,
    handleExceptions: true,
    handleRejections: true,
}));
// File transport for production
if (config_1.default.server.env === 'production') {
    // Ensure logs directory exists
    const logDir = path_1.default.dirname(config_1.default.logging.file);
    transports.push(
    // General log file
    new winston_1.default.transports.File({
        filename: config_1.default.logging.file,
        level: config_1.default.logging.level,
        format: customFormat,
        maxsize: 10 * 1024 * 1024, // 10MB
        maxFiles: 5,
        tailable: true,
        handleExceptions: true,
        handleRejections: true,
    }), 
    // Error log file
    new winston_1.default.transports.File({
        filename: path_1.default.join(logDir, 'error.log'),
        level: 'error',
        format: customFormat,
        maxsize: 10 * 1024 * 1024, // 10MB
        maxFiles: 5,
        tailable: true,
        handleExceptions: true,
        handleRejections: true,
    }));
}
// Create the logger instance
const logger = winston_1.default.createLogger({
    level: config_1.default.logging.level,
    format: customFormat,
    transports,
    exitOnError: false,
});
// Extend logger with custom methods
const customLogger = logger;
customLogger.fhir = (message, meta) => {
    logger.info(message, { context: 'FHIR', ...meta });
};
customLogger.security = (message, meta) => {
    logger.warn(message, { context: 'SECURITY', ...meta });
};
customLogger.performance = (message, meta) => {
    logger.info(message, { context: 'PERFORMANCE', ...meta });
};
customLogger.audit = (message, meta) => {
    logger.info(message, { context: 'AUDIT', ...meta });
};
customLogger.integration = (message, meta) => {
    logger.info(message, { context: 'INTEGRATION', ...meta });
};
// Handle uncaught exceptions and rejections
process.on('uncaughtException', (error) => {
    logger.error('Uncaught Exception:', error);
    process.exit(1);
});
process.on('unhandledRejection', (reason, promise) => {
    logger.error('Unhandled Rejection at:', promise, 'reason:', reason);
    process.exit(1);
});
exports.default = customLogger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvc3JjL3V0aWxzL2xvZ2dlci50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLGdEQUF3QjtBQUV4QixzREFBOEI7QUFFOUIsdURBQStCO0FBRS9CLHVDQUF1QztBQUN2QyxNQUFNLFlBQVksR0FBRyxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQ3pDLGlCQUFPLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUN2QixNQUFNLEVBQUUscUJBQXFCO0NBQzlCLENBQUMsRUFDRixpQkFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFDdEMsaUJBQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQ3RCLENBQUM7QUFFRixpQ0FBaUM7QUFDakMsTUFBTSxhQUFhLEdBQUcsaUJBQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUMxQyxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7SUFDdkIsTUFBTSxFQUFFLFVBQVU7Q0FDbkIsQ0FBQyxFQUNGLGlCQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxFQUN6QixpQkFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FDeEIsQ0FBQztBQUVGLDBCQUEwQjtBQUMxQixNQUFNLFVBQVUsR0FBd0IsRUFBRSxDQUFDO0FBRTNDLHlDQUF5QztBQUN6QyxVQUFVLENBQUMsSUFBSSxDQUNiLElBQUksaUJBQU8sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDO0lBQzdCLEtBQUssRUFBRSxnQkFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEtBQUssYUFBYSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU07SUFDN0QsTUFBTSxFQUFFLGdCQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsS0FBSyxhQUFhLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsWUFBWTtJQUMxRSxn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QUFPLEVBQUUsYUFBYSxFQUFFLEdBQUcsSUFBSSxFQUFFLENBQUMsQ0FBQztBQUM1RCxDQUFDLENBQUM7QUFFRiw0Q0FBNEM7QUFDNUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO0lBQ3hDLE1BQU0sQ0FBQyxLQUFLLENBQUMscUJBQXFCLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDM0MsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNsQixDQUFDLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxFQUFFLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUU7SUFDbkQsTUFBTSxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3BFLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDbEIsQ0FBQyxDQUFDLENBQUM7QUFFSCxrQkFBZSxZQUFZLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvc3JjL3V0aWxzL2xvZ2dlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IHdpbnN0b24gZnJvbSAnd2luc3Rvbic7XG5cbmltcG9ydCBjb25maWcgZnJvbSAnLi4vY29uZmlnJztcblxuLy8gQ3VzdG9tIGZvcm1hdCBmb3Igc3RydWN0dXJlZCBsb2dnaW5nXG5jb25zdCBjdXN0b21Gb3JtYXQgPSB3aW5zdG9uLmZvcm1hdC5jb21iaW5lKFxuICB3aW5zdG9uLmZvcm1hdC50aW1lc3RhbXAoe1xuICAgIGZvcm1hdDogJ1lZWVktTU0tREQgSEg6bW06c3MnLFxuICB9KSxcbiAgd2luc3Rvbi5mb3JtYXQuZXJyb3JzKHsgc3RhY2s6IHRydWUgfSksXG4gIHdpbnN0b24uZm9ybWF0Lmpzb24oKVxuKTtcblxuLy8gQ29uc29sZSBmb3JtYXQgZm9yIGRldmVsb3BtZW50XG5jb25zdCBjb25zb2xlRm9ybWF0ID0gd2luc3Rvbi5mb3JtYXQuY29tYmluZShcbiAgd2luc3Rvbi5mb3JtYXQudGltZXN0YW1wKHtcbiAgICBmb3JtYXQ6ICdISDptbTpzcycsXG4gIH0pLFxuICB3aW5zdG9uLmZvcm1hdC5jb2xvcml6ZSgpLFxuICB3aW5zdG9uLmZvcm1hdC5zaW1wbGUoKVxuKTtcblxuLy8gQ3JlYXRlIHRyYW5zcG9ydHMgYXJyYXlcbmNvbnN0IHRyYW5zcG9ydHM6IHdpbnN0b24udHJhbnNwb3J0W10gPSBbXTtcblxuLy8gQ29uc29sZSB0cmFuc3BvcnQgZm9yIGFsbCBlbnZpcm9ubWVudHNcbnRyYW5zcG9ydHMucHVzaChcbiAgbmV3IHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKHtcbiAgICBsZXZlbDogY29uZmlnLnNlcnZlci5lbnYgPT09ICdkZXZlbG9wbWVudCcgPyAnZGVidWcnIDogJ2luZm8nLFxuICAgIGZvcm1hdDogY29uZmlnLnNlcnZlci5lbnYgPT09ICdkZXZlbG9wbWVudCcgPyBjb25zb2xlRm9ybWF0IDogY3VzdG9tRm9ybWF0LFxuICAgIGhhbmRsZUV4Y2VwdGlvbnM6IHRydWUsXG4gICAgaGFuZGxlUmVqZWN0aW9uczogdHJ1ZSxcbiAgfSlcbik7XG5cbi8vIEZpbGUgdHJhbnNwb3J0IGZvciBwcm9kdWN0aW9uXG5pZiAoY29uZmlnLnNlcnZlci5lbnYgPT09ICdwcm9kdWN0aW9uJykge1xuICAvLyBFbnN1cmUgbG9ncyBkaXJlY3RvcnkgZXhpc3RzXG4gIGNvbnN0IGxvZ0RpciA9IHBhdGguZGlybmFtZShjb25maWcubG9nZ2luZy5maWxlKTtcbiAgXG4gIHRyYW5zcG9ydHMucHVzaChcbiAgICAvLyBHZW5lcmFsIGxvZyBmaWxlXG4gICAgbmV3IHdpbnN0b24udHJhbnNwb3J0cy5GaWxlKHtcbiAgICAgIGZpbGVuYW1lOiBjb25maWcubG9nZ2luZy5maWxlLFxuICAgICAgbGV2ZWw6IGNvbmZpZy5sb2dnaW5nLmxldmVsLFxuICAgICAgZm9ybWF0OiBjdXN0b21Gb3JtYXQsXG4gICAgICBtYXhzaXplOiAxMCAqIDEwMjQgKiAxMDI0LCAvLyAxME1CXG4gICAgICBtYXhGaWxlczogNSxcbiAgICAgIHRhaWxhYmxlOiB0cnVlLFxuICAgICAgaGFuZGxlRXhjZXB0aW9uczogdHJ1ZSxcbiAgICAgIGhhbmRsZVJlamVjdGlvbnM6IHRydWUsXG4gICAgfSksXG4gICAgXG4gICAgLy8gRXJyb3IgbG9nIGZpbGVcbiAgICBuZXcgd2luc3Rvbi50cmFuc3BvcnRzLkZpbGUoe1xuICAgICAgZmlsZW5hbWU6IHBhdGguam9pbihsb2dEaXIsICdlcnJvci5sb2cnKSxcbiAgICAgIGxldmVsOiAnZXJyb3InLFxuICAgICAgZm9ybWF0OiBjdXN0b21Gb3JtYXQsXG4gICAgICBtYXhzaXplOiAxMCAqIDEwMjQgKiAxMDI0LCAvLyAxME1CXG4gICAgICBtYXhGaWxlczogNSxcbiAgICAgIHRhaWxhYmxlOiB0cnVlLFxuICAgICAgaGFuZGxlRXhjZXB0aW9uczogdHJ1ZSxcbiAgICAgIGhhbmRsZVJlamVjdGlvbnM6IHRydWUsXG4gICAgfSlcbiAgKTtcbn1cblxuLy8gQ3JlYXRlIHRoZSBsb2dnZXIgaW5zdGFuY2VcbmNvbnN0IGxvZ2dlciA9IHdpbnN0b24uY3JlYXRlTG9nZ2VyKHtcbiAgbGV2ZWw6IGNvbmZpZy5sb2dnaW5nLmxldmVsLFxuICBmb3JtYXQ6IGN1c3RvbUZvcm1hdCxcbiAgdHJhbnNwb3J0cyxcbiAgZXhpdE9uRXJyb3I6IGZhbHNlLFxufSk7XG5cbi8vIEFkZCBjdXN0b20gbG9nZ2luZyBtZXRob2RzIGZvciBkaWZmZXJlbnQgY29udGV4dHNcbmludGVyZmFjZSBDdXN0b21Mb2dnZXIgZXh0ZW5kcyB3aW5zdG9uLkxvZ2dlciB7XG4gIGZoaXI6IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHZvaWQ7XG4gIHNlY3VyaXR5OiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB2b2lkO1xuICBwZXJmb3JtYW5jZTogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4gdm9pZDtcbiAgYXVkaXQ6IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHZvaWQ7XG4gIGludGVncmF0aW9uOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB2b2lkO1xufVxuXG4vLyBFeHRlbmQgbG9nZ2VyIHdpdGggY3VzdG9tIG1ldGhvZHNcbmNvbnN0IGN1c3RvbUxvZ2dlciA9IGxvZ2dlciBhcyBDdXN0b21Mb2dnZXI7XG5cbmN1c3RvbUxvZ2dlci5maGlyID0gKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4ge1xuICBsb2dnZXIuaW5mbyhtZXNzYWdlLCB7IGNvbnRleHQ6ICdGSElSJywgLi4ubWV0YSB9KTtcbn07XG5cbmN1c3RvbUxvZ2dlci5zZWN1cml0eSA9IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHtcbiAgbG9nZ2VyLndhcm4obWVzc2FnZSwgeyBjb250ZXh0OiAnU0VDVVJJVFknLCAuLi5tZXRhIH0pO1xufTtcblxuY3VzdG9tTG9nZ2VyLnBlcmZvcm1hbmNlID0gKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4ge1xuICBsb2dnZXIuaW5mbyhtZXNzYWdlLCB7IGNvbnRleHQ6ICdQRVJGT1JNQU5DRScsIC4uLm1ldGEgfSk7XG59O1xuXG5jdXN0b21Mb2dnZXIuYXVkaXQgPSAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB7XG4gIGxvZ2dlci5pbmZvKG1lc3NhZ2UsIHsgY29udGV4dDogJ0FVRElUJywgLi4ubWV0YSB9KTtcbn07XG5cbmN1c3RvbUxvZ2dlci5pbnRlZ3JhdGlvbiA9IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHtcbiAgbG9nZ2VyLmluZm8obWVzc2FnZSwgeyBjb250ZXh0OiAnSU5URUdSQVRJT04nLCAuLi5tZXRhIH0pO1xufTtcblxuLy8gSGFuZGxlIHVuY2F1Z2h0IGV4Y2VwdGlvbnMgYW5kIHJlamVjdGlvbnNcbnByb2Nlc3Mub24oJ3VuY2F1Z2h0RXhjZXB0aW9uJywgKGVycm9yKSA9PiB7XG4gIGxvZ2dlci5lcnJvcignVW5jYXVnaHQgRXhjZXB0aW9uOicsIGVycm9yKTtcbiAgcHJvY2Vzcy5leGl0KDEpO1xufSk7XG5cbnByb2Nlc3Mub24oJ3VuaGFuZGxlZFJlamVjdGlvbicsIChyZWFzb24sIHByb21pc2UpID0+IHtcbiAgbG9nZ2VyLmVycm9yKCdVbmhhbmRsZWQgUmVqZWN0aW9uIGF0OicsIHByb21pc2UsICdyZWFzb246JywgcmVhc29uKTtcbiAgcHJvY2Vzcy5leGl0KDEpO1xufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGN1c3RvbUxvZ2dlcjsiXSwidmVyc2lvbiI6M30=