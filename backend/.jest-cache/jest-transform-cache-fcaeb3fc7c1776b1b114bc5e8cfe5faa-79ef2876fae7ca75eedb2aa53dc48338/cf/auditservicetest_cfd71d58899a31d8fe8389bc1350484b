0762a695df926e99cd03b5882479862c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock crypto for deterministic testing
jest.mock('crypto', () => ({
    randomBytes: jest.fn().mockReturnValue({
        toString: jest.fn().mockReturnValue('mockedrandom123')
    }),
    createHash: jest.fn().mockReturnValue({
        update: jest.fn().mockReturnThis(),
        digest: jest.fn().mockReturnValue('mockedhash')
    })
}));
const audit_service_1 = require("../../../src/services/audit.service");
// Mock console.log to avoid test output pollution
jest.spyOn(console, 'log').mockImplementation(() => { });
jest.spyOn(console, 'error').mockImplementation(() => { });
describe('AuditService', () => {
    let auditService;
    let originalEnv;
    beforeEach(() => {
        originalEnv = process.env;
        process.env = { ...originalEnv, AUDIT_ENCRYPTION_KEY: 'test-key-123' };
        auditService = new audit_service_1.AuditService();
    });
    afterEach(() => {
        process.env = originalEnv;
        auditService.shutdown();
    });
    describe('logUserAction', () => {
        it('should log a successful user action', async () => {
            const eventSpy = jest.fn();
            auditService.on('auditEntry', eventSpy);
            await auditService.logUserAction('user123', 'read', 'Patient', 'pat123', '192.168.1.1', 'Mozilla/5.0', true);
            expect(eventSpy).toHaveBeenCalledWith(expect.objectContaining({
                userId: 'user123',
                action: 'read',
                resource: 'Patient',
                resourceId: 'pat123',
                ipAddress: '192.168.1.1',
                userAgent: 'Mozilla/5.0',
                success: true,
                errorMessage: undefined
            }));
        });
        it('should log a failed user action with error message', async () => {
            const eventSpy = jest.fn();
            auditService.on('auditEntry', eventSpy);
            await auditService.logUserAction('user123', 'update', 'Patient', 'pat123', '192.168.1.1', 'Mozilla/5.0', false, 'Access denied');
            expect(eventSpy).toHaveBeenCalledWith(expect.objectContaining({
                userId: 'user123',
                action: 'update',
                resource: 'Patient',
                resourceId: 'pat123',
                success: false,
                errorMessage: 'Access denied'
            }));
        });
        it('should emit security event for security-relevant actions', async () => {
            const securityEventSpy = jest.fn();
            auditService.on('securityEvent', securityEventSpy);
            await auditService.logUserAction('user123', 'login', 'User', 'user123', '192.168.1.1', 'Mozilla/5.0', true);
            expect(securityEventSpy).toHaveBeenCalledWith(expect.objectContaining({
                type: 'LOGIN_SUCCESS',
                userId: 'user123',
                severity: 'LOW',
                description: 'User action: login on User'
            }));
        });
        it('should handle additional data encryption', async () => {
            const additionalData = {
                patientSSN: '123-45-6789',
                medicalRecord: 'Sensitive info',
                diagnosis: 'Test diagnosis'
            };
            await auditService.logUserAction('user123', 'read', 'Patient', 'pat123', '192.168.1.1', 'Mozilla/5.0', true, undefined, additionalData);
            // Check that sensitive fields are encrypted
            expect(console.log).toHaveBeenCalledWith('Audit Entry:', expect.stringContaining('encrypted:'));
        });
    });
    describe('logSecurityEvent', () => {
        it('should log a security event', async () => {
            const eventSpy = jest.fn();
            auditService.on('securityEvent', eventSpy);
            const securityEvent = {
                type: 'DATA_ACCESS',
                userId: 'user123',
                severity: 'MEDIUM',
                description: 'Accessed patient data',
                metadata: { resource: 'Patient', action: 'read' }
            };
            await auditService.logSecurityEvent(securityEvent);
            expect(eventSpy).toHaveBeenCalledWith(securityEvent);
        });
        it('should handle critical security events', async () => {
            const criticalEventSpy = jest.fn();
            auditService.on('criticalSecurityEvent', criticalEventSpy);
            const criticalEvent = {
                type: 'UNAUTHORIZED_ACCESS',
                userId: 'user123',
                severity: 'CRITICAL',
                description: 'Attempted unauthorized access',
                metadata: {}
            };
            await auditService.logSecurityEvent(criticalEvent);
            expect(criticalEventSpy).toHaveBeenCalledWith(criticalEvent);
        });
    });
    describe('generateHipaaComplianceReport', () => {
        beforeEach(async () => {
            // Set up some test audit entries
            await auditService.logUserAction('user1', 'read', 'Patient', 'pat1', '192.168.1.1', 'Mozilla/5.0', true);
            await auditService.logUserAction('user2', 'update', 'Patient', 'pat2', '192.168.1.2', 'Mozilla/5.0', false, 'Validation error');
            await auditService.logUserAction('user1', 'login', 'User', 'user1', '192.168.1.1', 'Mozilla/5.0', true);
        });
        it('should generate HIPAA compliance report', async () => {
            const startDate = new Date(Date.now() - 24 * 60 * 60 * 1000);
            const endDate = new Date();
            const generatedBy = 'admin123';
            const report = await auditService.generateHipaaComplianceReport(startDate, endDate, generatedBy);
            expect(report).toEqual(expect.objectContaining({
                reportType: 'HIPAA_ACCESS_LOG',
                generatedBy,
                dateRange: { start: startDate, end: endDate },
                summary: expect.objectContaining({
                    totalAccesses: 3,
                    uniqueUsers: 2,
                    failedAttempts: 1,
                    securityIncidents: 0
                })
            }));
            expect(report.data).toHaveLength(3);
            expect(report.reportId).toMatch(/^audit_/);
        });
    });
    describe('searchAuditLogs', () => {
        beforeEach(async () => {
            // Set up test data
            await auditService.logUserAction('user1', 'read', 'Patient', 'pat1', '192.168.1.1', 'Mozilla/5.0', true);
            await auditService.logUserAction('user2', 'update', 'Observation', 'obs1', '192.168.1.2', 'Mozilla/5.0', false);
        });
        it('should search audit logs with filters', async () => {
            const results = await auditService.searchAuditLogs('', {
                userId: 'user1',
                success: true
            });
            expect(results).toHaveLength(1);
            expect(results[0]).toEqual(expect.objectContaining({
                userId: 'user1',
                success: true
            }));
        });
        it('should search audit logs with text query', async () => {
            const results = await auditService.searchAuditLogs('Observation');
            expect(results).toHaveLength(1);
            expect(results[0]).toEqual(expect.objectContaining({
                resource: 'Observation'
            }));
        });
        it('should apply pagination', async () => {
            const results = await auditService.searchAuditLogs('', {
                limit: 1,
                offset: 1
            });
            expect(results).toHaveLength(1);
        });
        it('should filter by date range', async () => {
            const startDate = new Date(Date.now() - 60 * 1000); // 1 minute ago
            const endDate = new Date();
            const results = await auditService.searchAuditLogs('', {
                startDate,
                endDate
            });
            expect(results.length).toBeGreaterThan(0);
            results.forEach(entry => {
                expect(entry.timestamp).toBeInstanceOf(Date);
                expect(entry.timestamp.getTime()).toBeGreaterThanOrEqual(startDate.getTime());
                expect(entry.timestamp.getTime()).toBeLessThanOrEqual(endDate.getTime());
            });
        });
    });
    describe('getAuditStatistics', () => {
        beforeEach(async () => {
            // Set up test data
            await auditService.logUserAction('user1', 'read', 'Patient', 'pat1', '192.168.1.1', 'Mozilla/5.0', true);
            await auditService.logUserAction('user1', 'update', 'Patient', 'pat1', '192.168.1.1', 'Mozilla/5.0', false);
            await auditService.logUserAction('user2', 'read', 'Observation', 'obs1', '192.168.1.2', 'Mozilla/5.0', true);
        });
        it('should generate audit statistics for daily timeframe', async () => {
            const stats = await auditService.getAuditStatistics('daily');
            expect(stats).toEqual(expect.objectContaining({
                totalEvents: 3,
                successfulEvents: 2,
                failedEvents: 1,
                uniqueUsers: 2,
                eventsByType: expect.objectContaining({
                    read: 2,
                    update: 1
                }),
                eventsByUser: expect.objectContaining({
                    user1: 2,
                    user2: 1
                }),
                topResources: expect.arrayContaining([
                    expect.objectContaining({ resource: 'Patient', count: 2 }),
                    expect.objectContaining({ resource: 'Observation', count: 1 })
                ]),
                securityIncidents: 0
            }));
        });
        it('should generate statistics for different timeframes', async () => {
            const weeklyStats = await auditService.getAuditStatistics('weekly');
            const monthlyStats = await auditService.getAuditStatistics('monthly');
            expect(weeklyStats.totalEvents).toBe(3);
            expect(monthlyStats.totalEvents).toBe(3);
        });
    });
    describe('security event classification', () => {
        it('should classify login actions correctly', async () => {
            const securityEventSpy = jest.fn();
            auditService.on('securityEvent', securityEventSpy);
            await auditService.logUserAction('user123', 'login', 'User', 'user123', '192.168.1.1', 'Mozilla/5.0', true);
            expect(securityEventSpy).toHaveBeenCalledWith(expect.objectContaining({
                type: 'LOGIN_SUCCESS',
                severity: 'LOW'
            }));
        });
        it('should classify failed login as high severity', async () => {
            const securityEventSpy = jest.fn();
            auditService.on('securityEvent', securityEventSpy);
            await auditService.logUserAction('user123', 'login', 'User', 'user123', '192.168.1.1', 'Mozilla/5.0', false, 'Invalid credentials');
            expect(securityEventSpy).toHaveBeenCalledWith(expect.objectContaining({
                type: 'LOGIN_SUCCESS',
                severity: 'HIGH'
            }));
        });
        it('should classify password changes correctly', async () => {
            const securityEventSpy = jest.fn();
            auditService.on('securityEvent', securityEventSpy);
            await auditService.logUserAction('user123', 'password_change', 'User', 'user123', '192.168.1.1', 'Mozilla/5.0', true);
            expect(securityEventSpy).toHaveBeenCalledWith(expect.objectContaining({
                type: 'PASSWORD_CHANGE',
                severity: 'LOW'
            }));
        });
        it('should classify system configuration as medium severity', async () => {
            const securityEventSpy = jest.fn();
            auditService.on('securityEvent', securityEventSpy);
            await auditService.logUserAction('user123', 'system_configuration', 'Config', 'config1', '192.168.1.1', 'Mozilla/5.0', true);
            expect(securityEventSpy).toHaveBeenCalledWith(expect.objectContaining({
                type: 'DATA_ACCESS',
                severity: 'MEDIUM'
            }));
        });
    });
    describe('data encryption', () => {
        it('should identify sensitive fields correctly', () => {
            const sensitiveData = {
                password: 'secret123',
                ssn: '123-45-6789',
                email: 'test@example.com',
                medicalRecord: 'sensitive info',
                normalField: 'not sensitive'
            };
            // Test through logUserAction which calls the private method
            auditService.logUserAction('user123', 'read', 'Patient', 'pat123', '192.168.1.1', 'Mozilla/5.0', true, undefined, sensitiveData);
            // Verify encrypted output in console.log
            expect(console.log).toHaveBeenCalledWith('Audit Entry:', expect.stringContaining('encrypted:'));
        });
    });
    describe('audit ID generation', () => {
        it('should generate unique audit IDs', async () => {
            const ids = new Set();
            for (let i = 0; i < 10; i++) {
                await auditService.logUserAction('user123', 'read', 'Patient', 'pat123', '192.168.1.1', 'Mozilla/5.0', true);
            }
            // All IDs should be unique
            expect(ids.size).toBe(10);
        });
        it('should generate audit IDs with correct format', async () => {
            const eventSpy = jest.fn();
            auditService.on('auditEntry', eventSpy);
            await auditService.logUserAction('user123', 'read', 'Patient', 'pat123', '192.168.1.1', 'Mozilla/5.0', true);
            const auditEntry = eventSpy.mock.calls[0][0];
            expect(auditEntry.id).toMatch(/^audit_[a-z0-9]+_[a-f0-9]+$/);
        });
    });
    describe('event emission', () => {
        it('should emit auditEntry events', (done) => {
            auditService.on('auditEntry', (entry) => {
                expect(entry).toBeDefined();
                expect(entry.userId).toBe('user123');
                done();
            });
            auditService.logUserAction('user123', 'read', 'Patient', 'pat123', '192.168.1.1', 'Mozilla/5.0', true);
        });
        it('should emit securityEvent events', (done) => {
            auditService.on('securityEvent', (event) => {
                expect(event).toBeDefined();
                expect(event.userId).toBe('user123');
                done();
            });
            auditService.logUserAction('user123', 'login', 'User', 'user123', '192.168.1.1', 'Mozilla/5.0', true);
        });
        it('should emit criticalSecurityEvent for critical events', (done) => {
            auditService.on('criticalSecurityEvent', (event) => {
                expect(event).toBeDefined();
                expect(event.severity).toBe('CRITICAL');
                done();
            });
            const criticalEvent = {
                type: 'UNAUTHORIZED_ACCESS',
                userId: 'user123',
                severity: 'CRITICAL',
                description: 'Critical security event',
                metadata: {}
            };
            auditService.logSecurityEvent(criticalEvent);
        });
    });
    describe('error handling', () => {
        it('should handle invalid dates gracefully', async () => {
            const invalidStartDate = new Date('invalid');
            const endDate = new Date();
            expect(() => auditService.generateHipaaComplianceReport(invalidStartDate, endDate, 'admin')).not.toThrow();
        });
        it('should handle empty search results', async () => {
            const results = await auditService.searchAuditLogs('nonexistent');
            expect(results).toEqual([]);
        });
        it('should handle statistics with no data', async () => {
            const freshService = new audit_service_1.AuditService();
            const stats = await freshService.getAuditStatistics();
            expect(stats.totalEvents).toBe(0);
            expect(stats.uniqueUsers).toBe(0);
            expect(stats.eventsByType).toEqual({});
            freshService.shutdown();
        });
    });
    describe('shutdown', () => {
        it('should clean up event listeners on shutdown', () => {
            const eventSpy = jest.fn();
            auditService.on('auditEntry', eventSpy);
            expect(auditService.listenerCount('auditEntry')).toBe(1);
            auditService.shutdown();
            expect(auditService.listenerCount('auditEntry')).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvdGVzdHMvdW5pdC9zZXJ2aWNlcy9hdWRpdC5zZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFHQSx3Q0FBd0M7QUFDeEMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN6QixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztRQUNyQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQztLQUN2RCxDQUFDO0lBQ0YsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7UUFDcEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7UUFDbEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDO0tBQ2hELENBQUM7Q0FDSCxDQUFDLENBQUMsQ0FBQztBQVpKLHVFQUFtRTtBQWNuRSxrREFBa0Q7QUFDbEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLEdBQUUsQ0FBQyxDQUFDLENBQUM7QUFDeEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLEdBQUUsQ0FBQyxDQUFDLENBQUM7QUFFMUQsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7SUFDNUIsSUFBSSxZQUEwQixDQUFDO0lBQy9CLElBQUksV0FBOEIsQ0FBQztJQUVuQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7UUFDMUIsT0FBTyxDQUFDLEdBQUcsR0FBRyxFQUFFLEdBQUcsV0FBVyxFQUFFLG9C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O1lBQ3hDLE1BQU0sS0FBSyxHQUFHLE1BQU0sWUFBWSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFFdEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFdkMsWUFBWSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtRQUN4QixFQUFFLENBQUMsNkNBQTZDLEVBQUUsR0FBRyxFQUFFO1lBQ3JELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMzQixZQUFZLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQztZQUV4QyxNQUFNLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUV6RCxZQUFZLENBQUMsUUFBUSxFQUFFLENBQUM7WUFFeEIsTUFBTSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvL2NsYXVkZS1wcm9qZWN0cy9PbW5pQ2FyZS9iYWNrZW5kL3Rlc3RzL3VuaXQvc2VydmljZXMvYXVkaXQuc2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEF1ZGl0U2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9hdWRpdC5zZXJ2aWNlJztcbmltcG9ydCB7IEF1ZGl0TG9nRW50cnksIFNlY3VyaXR5RXZlbnQsIENvbXBsaWFuY2VSZXBvcnQgfSBmcm9tICcuLi8uLi8uLi9zcmMvdHlwZXMvYXV0aC50eXBlcyc7XG5cbi8vIE1vY2sgY3J5cHRvIGZvciBkZXRlcm1pbmlzdGljIHRlc3Rpbmdcbmplc3QubW9jaygnY3J5cHRvJywgKCkgPT4gKHtcbiAgcmFuZG9tQnl0ZXM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgIHRvU3RyaW5nOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdtb2NrZWRyYW5kb20xMjMnKVxuICB9KSxcbiAgY3JlYXRlSGFzaDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICBkaWdlc3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ21vY2tlZGhhc2gnKVxuICB9KVxufSkpO1xuXG4vLyBNb2NrIGNvbnNvbGUubG9nIHRvIGF2b2lkIHRlc3Qgb3V0cHV0IHBvbGx1dGlvblxuamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcbmplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcblxuZGVzY3JpYmUoJ0F1ZGl0U2VydmljZScsICgpID0+IHtcbiAgbGV0IGF1ZGl0U2VydmljZTogQXVkaXRTZXJ2aWNlO1xuICBsZXQgb3JpZ2luYWxFbnY6IE5vZGVKUy5Qcm9jZXNzRW52O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIG9yaWdpbmFsRW52ID0gcHJvY2Vzcy5lbnY7XG4gICAgcHJvY2Vzcy5lbnYgPSB7IC4uLm9yaWdpbmFsRW52LCBBVURJVF9FTkNSWVBUSU9OX0tFWTogJ3Rlc3Qta2V5LTEyMycgfTtcbiAgICBhdWRpdFNlcnZpY2UgPSBuZXcgQXVkaXRTZXJ2aWNlKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgcHJvY2Vzcy5lbnYgPSBvcmlnaW5hbEVudjtcbiAgICBhdWRpdFNlcnZpY2Uuc2h1dGRvd24oKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xvZ1VzZXJBY3Rpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBsb2cgYSBzdWNjZXNzZnVsIHVzZXIgYWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRTcHkgPSBqZXN0LmZuKCk7XG4gICAgICBhdWRpdFNlcnZpY2Uub24oJ2F1ZGl0RW50cnknLCBldmVudFNweSk7XG5cbiAgICAgIGF3YWl0IGF1ZGl0U2VydmljZS5sb2dVc2VyQWN0aW9uKFxuICAgICAgICAndXNlcjEyMycsXG4gICAgICAgICdyZWFkJyxcbiAgICAgICAgJ1BhdGllbnQnLFxuICAgICAgICAncGF0MTIzJyxcbiAgICAgICAgJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgJ01vemlsbGEvNS4wJyxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KGV2ZW50U3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxuICAgICAgICAgIGFjdGlvbjogJ3JlYWQnLFxuICAgICAgICAgIHJlc291cmNlOiAnUGF0aWVudCcsXG4gICAgICAgICAgcmVzb3VyY2VJZDogJ3BhdDEyMycsXG4gICAgICAgICAgaXBBZGRyZXNzOiAnMTkyLjE2OC4xLjEnLFxuICAgICAgICAgIHVzZXJBZ2VudDogJ01vemlsbGEvNS4wJyxcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIGVycm9yTWVzc2FnZTogdW5kZWZpbmVkXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgYSBmYWlsZWQgdXNlciBhY3Rpb24gd2l0aCBlcnJvciBtZXNzYWdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRTcHkgPSBqZXN0LmZuKCk7XG4gICAgICBhdWRpdFNlcnZpY2Uub24oJ2F1ZGl0RW50cnknLCBldmVudFNweSk7XG5cbiAgICAgIGF3YWl0IGF1ZGl0U2VydmljZS5sb2dVc2VyQWN0aW9uKFxuICAgICAgICAndXNlcjEyMycsXG4gICAgICAgICd1cGRhdGUnLFxuICAgICAgICAnUGF0aWVudCcsXG4gICAgICAgICdwYXQxMjMnLFxuICAgICAgICAnMTkyLjE2OC4xLjEnLFxuICAgICAgICAnTW96aWxsYS81LjAnLFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgJ0FjY2VzcyBkZW5pZWQnXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoZXZlbnRTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXG4gICAgICAgICAgYWN0aW9uOiAndXBkYXRlJyxcbiAgICAgICAgICByZXNvdXJjZTogJ1BhdGllbnQnLFxuICAgICAgICAgIHJlc291cmNlSWQ6ICdwYXQxMjMnLFxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yTWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQnXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBlbWl0IHNlY3VyaXR5IGV2ZW50IGZvciBzZWN1cml0eS1yZWxldmFudCBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VjdXJpdHlFdmVudFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGF1ZGl0U2VydmljZS5vbignc2VjdXJpdHlFdmVudCcsIHNlY3VyaXR5RXZlbnRTcHkpO1xuXG4gICAgICBhd2FpdCBhdWRpdFNlcnZpY2UubG9nVXNlckFjdGlvbihcbiAgICAgICAgJ3VzZXIxMjMnLFxuICAgICAgICAnbG9naW4nLFxuICAgICAgICAnVXNlcicsXG4gICAgICAgICd1c2VyMTIzJyxcbiAgICAgICAgJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgJ01vemlsbGEvNS4wJyxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHNlY3VyaXR5RXZlbnRTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdHlwZTogJ0xPR0lOX1NVQ0NFU1MnLFxuICAgICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxuICAgICAgICAgIHNldmVyaXR5OiAnTE9XJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ1VzZXIgYWN0aW9uOiBsb2dpbiBvbiBVc2VyJ1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGFkZGl0aW9uYWwgZGF0YSBlbmNyeXB0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWRkaXRpb25hbERhdGEgPSB7XG4gICAgICAgIHBhdGllbnRTU046ICcxMjMtNDUtNjc4OScsXG4gICAgICAgIG1lZGljYWxSZWNvcmQ6ICdTZW5zaXRpdmUgaW5mbycsXG4gICAgICAgIGRpYWdub3NpczogJ1Rlc3QgZGlhZ25vc2lzJ1xuICAgICAgfTtcblxuICAgICAgYXdhaXQgYXVkaXRTZXJ2aWNlLmxvZ1VzZXJBY3Rpb24oXG4gICAgICAgICd1c2VyMTIzJyxcbiAgICAgICAgJ3JlYWQnLFxuICAgICAgICAnUGF0aWVudCcsXG4gICAgICAgICdwYXQxMjMnLFxuICAgICAgICAnMTkyLjE2OC4xLjEnLFxuICAgICAgICAnTW96aWxsYS81LjAnLFxuICAgICAgICB0cnVlLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIGFkZGl0aW9uYWxEYXRhXG4gICAgICApO1xuXG4gICAgICAvLyBDaGVjayB0aGF0IHNlbnNpdGl2ZSBmaWVsZHMgYXJlIGVuY3J5cHRlZFxuICAgICAgZXhwZWN0KGNvbnNvbGUubG9nKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ0F1ZGl0IEVudHJ5OicsXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdlbmNyeXB0ZWQ6JylcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdsb2dTZWN1cml0eUV2ZW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbG9nIGEgc2VjdXJpdHkgZXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGF1ZGl0U2VydmljZS5vbignc2VjdXJpdHlFdmVudCcsIGV2ZW50U3B5KTtcblxuICAgICAgY29uc3Qgc2VjdXJpdHlFdmVudDogU2VjdXJpdHlFdmVudCA9IHtcbiAgICAgICAgdHlwZTogJ0RBVEFfQUNDRVNTJyxcbiAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXG4gICAgICAgIHNldmVyaXR5OiAnTUVESVVNJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdBY2Nlc3NlZCBwYXRpZW50IGRhdGEnLFxuICAgICAgICBtZXRhZGF0YTogeyByZXNvdXJjZTogJ1BhdGllbnQnLCBhY3Rpb246ICdyZWFkJyB9XG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBhdWRpdFNlcnZpY2UubG9nU2VjdXJpdHlFdmVudChzZWN1cml0eUV2ZW50KTtcblxuICAgICAgZXhwZWN0KGV2ZW50U3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChzZWN1cml0eUV2ZW50KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNyaXRpY2FsIHNlY3VyaXR5IGV2ZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNyaXRpY2FsRXZlbnRTcHkgPSBqZXN0LmZuKCk7XG4gICAgICBhdWRpdFNlcnZpY2Uub24oJ2NyaXRpY2FsU2VjdXJpdHlFdmVudCcsIGNyaXRpY2FsRXZlbnRTcHkpO1xuXG4gICAgICBjb25zdCBjcml0aWNhbEV2ZW50OiBTZWN1cml0eUV2ZW50ID0ge1xuICAgICAgICB0eXBlOiAnVU5BVVRIT1JJWkVEX0FDQ0VTUycsXG4gICAgICAgIHVzZXJJZDogJ3VzZXIxMjMnLFxuICAgICAgICBzZXZlcml0eTogJ0NSSVRJQ0FMJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdBdHRlbXB0ZWQgdW5hdXRob3JpemVkIGFjY2VzcycsXG4gICAgICAgIG1ldGFkYXRhOiB7fVxuICAgICAgfTtcblxuICAgICAgYXdhaXQgYXVkaXRTZXJ2aWNlLmxvZ1NlY3VyaXR5RXZlbnQoY3JpdGljYWxFdmVudCk7XG5cbiAgICAgIGV4cGVjdChjcml0aWNhbEV2ZW50U3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChjcml0aWNhbEV2ZW50KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dlbmVyYXRlSGlwYWFDb21wbGlhbmNlUmVwb3J0JywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2V0IHVwIHNvbWUgdGVzdCBhdWRpdCBlbnRyaWVzXG4gICAgICBhd2FpdCBhdWRpdFNlcnZpY2UubG9nVXNlckFjdGlvbihcbiAgICAgICAgJ3VzZXIxJyxcbiAgICAgICAgJ3JlYWQnLFxuICAgICAgICAnUGF0aWVudCcsXG4gICAgICAgICdwYXQxJyxcbiAgICAgICAgJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgJ01vemlsbGEvNS4wJyxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcbiAgICAgIGF3YWl0IGF1ZGl0U2VydmljZS5sb2dVc2VyQWN0aW9uKFxuICAgICAgICAndXNlcjInLFxuICAgICAgICAndXBkYXRlJyxcbiAgICAgICAgJ1BhdGllbnQnLFxuICAgICAgICAncGF0MicsXG4gICAgICAgICcxOTIuMTY4LjEuMicsXG4gICAgICAgICdNb3ppbGxhLzUuMCcsXG4gICAgICAgIGZhbHNlLFxuICAgICAgICAnVmFsaWRhdGlvbiBlcnJvcidcbiAgICAgICk7XG4gICAgICBhd2FpdCBhdWRpdFNlcnZpY2UubG9nVXNlckFjdGlvbihcbiAgICAgICAgJ3VzZXIxJyxcbiAgICAgICAgJ2xvZ2luJyxcbiAgICAgICAgJ1VzZXInLFxuICAgICAgICAndXNlcjEnLFxuICAgICAgICAnMTkyLjE2OC4xLjEnLFxuICAgICAgICAnTW96aWxsYS81LjAnLFxuICAgICAgICB0cnVlXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBISVBBQSBjb21wbGlhbmNlIHJlcG9ydCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKERhdGUubm93KCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgZ2VuZXJhdGVkQnkgPSAnYWRtaW4xMjMnO1xuXG4gICAgICBjb25zdCByZXBvcnQgPSBhd2FpdCBhdWRpdFNlcnZpY2UuZ2VuZXJhdGVIaXBhYUNvbXBsaWFuY2VSZXBvcnQoXG4gICAgICAgIHN0YXJ0RGF0ZSxcbiAgICAgICAgZW5kRGF0ZSxcbiAgICAgICAgZ2VuZXJhdGVkQnlcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXBvcnQpLnRvRXF1YWwoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICByZXBvcnRUeXBlOiAnSElQQUFfQUNDRVNTX0xPRycsXG4gICAgICAgICAgZ2VuZXJhdGVkQnksXG4gICAgICAgICAgZGF0ZVJhbmdlOiB7IHN0YXJ0OiBzdGFydERhdGUsIGVuZDogZW5kRGF0ZSB9LFxuICAgICAgICAgIHN1bW1hcnk6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIHRvdGFsQWNjZXNzZXM6IDMsXG4gICAgICAgICAgICB1bmlxdWVVc2VyczogMixcbiAgICAgICAgICAgIGZhaWxlZEF0dGVtcHRzOiAxLFxuICAgICAgICAgICAgc2VjdXJpdHlJbmNpZGVudHM6IDBcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlcG9ydC5kYXRhKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3QocmVwb3J0LnJlcG9ydElkKS50b01hdGNoKC9eYXVkaXRfLyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZWFyY2hBdWRpdExvZ3MnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAvLyBTZXQgdXAgdGVzdCBkYXRhXG4gICAgICBhd2FpdCBhdWRpdFNlcnZpY2UubG9nVXNlckFjdGlvbihcbiAgICAgICAgJ3VzZXIxJyxcbiAgICAgICAgJ3JlYWQnLFxuICAgICAgICAnUGF0aWVudCcsXG4gICAgICAgICdwYXQxJyxcbiAgICAgICAgJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgJ01vemlsbGEvNS4wJyxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcbiAgICAgIGF3YWl0IGF1ZGl0U2VydmljZS5sb2dVc2VyQWN0aW9uKFxuICAgICAgICAndXNlcjInLFxuICAgICAgICAndXBkYXRlJyxcbiAgICAgICAgJ09ic2VydmF0aW9uJyxcbiAgICAgICAgJ29iczEnLFxuICAgICAgICAnMTkyLjE2OC4xLjInLFxuICAgICAgICAnTW96aWxsYS81LjAnLFxuICAgICAgICBmYWxzZVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2VhcmNoIGF1ZGl0IGxvZ3Mgd2l0aCBmaWx0ZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGF1ZGl0U2VydmljZS5zZWFyY2hBdWRpdExvZ3MoJycsIHtcbiAgICAgICAgdXNlcklkOiAndXNlcjEnLFxuICAgICAgICBzdWNjZXNzOiB0cnVlXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdHMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzWzBdKS50b0VxdWFsKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdXNlcklkOiAndXNlcjEnLFxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWVcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNlYXJjaCBhdWRpdCBsb2dzIHdpdGggdGV4dCBxdWVyeScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBhdWRpdFNlcnZpY2Uuc2VhcmNoQXVkaXRMb2dzKCdPYnNlcnZhdGlvbicpO1xuXG4gICAgICBleHBlY3QocmVzdWx0cykudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMF0pLnRvRXF1YWwoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICByZXNvdXJjZTogJ09ic2VydmF0aW9uJ1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYXBwbHkgcGFnaW5hdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBhdWRpdFNlcnZpY2Uuc2VhcmNoQXVkaXRMb2dzKCcnLCB7XG4gICAgICAgIGxpbWl0OiAxLFxuICAgICAgICBvZmZzZXQ6IDFcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0cykudG9IYXZlTGVuZ3RoKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgYnkgZGF0ZSByYW5nZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKERhdGUubm93KCkgLSA2MCAqIDEwMDApOyAvLyAxIG1pbnV0ZSBhZ29cbiAgICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgYXVkaXRTZXJ2aWNlLnNlYXJjaEF1ZGl0TG9ncygnJywge1xuICAgICAgICBzdGFydERhdGUsXG4gICAgICAgIGVuZERhdGVcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0cy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIHJlc3VsdHMuZm9yRWFjaChlbnRyeSA9PiB7XG4gICAgICAgIGV4cGVjdChlbnRyeS50aW1lc3RhbXApLnRvQmVJbnN0YW5jZU9mKERhdGUpO1xuICAgICAgICBleHBlY3QoZW50cnkudGltZXN0YW1wLmdldFRpbWUoKSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbChzdGFydERhdGUuZ2V0VGltZSgpKTtcbiAgICAgICAgZXhwZWN0KGVudHJ5LnRpbWVzdGFtcC5nZXRUaW1lKCkpLnRvQmVMZXNzVGhhbk9yRXF1YWwoZW5kRGF0ZS5nZXRUaW1lKCkpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRBdWRpdFN0YXRpc3RpY3MnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAvLyBTZXQgdXAgdGVzdCBkYXRhXG4gICAgICBhd2FpdCBhdWRpdFNlcnZpY2UubG9nVXNlckFjdGlvbihcbiAgICAgICAgJ3VzZXIxJyxcbiAgICAgICAgJ3JlYWQnLFxuICAgICAgICAnUGF0aWVudCcsXG4gICAgICAgICdwYXQxJyxcbiAgICAgICAgJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgJ01vemlsbGEvNS4wJyxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcbiAgICAgIGF3YWl0IGF1ZGl0U2VydmljZS5sb2dVc2VyQWN0aW9uKFxuICAgICAgICAndXNlcjEnLFxuICAgICAgICAndXBkYXRlJyxcbiAgICAgICAgJ1BhdGllbnQnLFxuICAgICAgICAncGF0MScsXG4gICAgICAgICcxOTIuMTY4LjEuMScsXG4gICAgICAgICdNb3ppbGxhLzUuMCcsXG4gICAgICAgIGZhbHNlXG4gICAgICApO1xuICAgICAgYXdhaXQgYXVkaXRTZXJ2aWNlLmxvZ1VzZXJBY3Rpb24oXG4gICAgICAgICd1c2VyMicsXG4gICAgICAgICdyZWFkJyxcbiAgICAgICAgJ09ic2VydmF0aW9uJyxcbiAgICAgICAgJ29iczEnLFxuICAgICAgICAnMTkyLjE2OC4xLjInLFxuICAgICAgICAnTW96aWxsYS81LjAnLFxuICAgICAgICB0cnVlXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBhdWRpdCBzdGF0aXN0aWNzIGZvciBkYWlseSB0aW1lZnJhbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IGF1ZGl0U2VydmljZS5nZXRBdWRpdFN0YXRpc3RpY3MoJ2RhaWx5Jyk7XG5cbiAgICAgIGV4cGVjdChzdGF0cykudG9FcXVhbChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHRvdGFsRXZlbnRzOiAzLFxuICAgICAgICAgIHN1Y2Nlc3NmdWxFdmVudHM6IDIsXG4gICAgICAgICAgZmFpbGVkRXZlbnRzOiAxLFxuICAgICAgICAgIHVuaXF1ZVVzZXJzOiAyLFxuICAgICAgICAgIGV2ZW50c0J5VHlwZTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgcmVhZDogMixcbiAgICAgICAgICAgIHVwZGF0ZTogMVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGV2ZW50c0J5VXNlcjogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgdXNlcjE6IDIsXG4gICAgICAgICAgICB1c2VyMjogMVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHRvcFJlc291cmNlczogZXhwZWN0LmFycmF5Q29udGFpbmluZyhbXG4gICAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IHJlc291cmNlOiAnUGF0aWVudCcsIGNvdW50OiAyIH0pLFxuICAgICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyByZXNvdXJjZTogJ09ic2VydmF0aW9uJywgY291bnQ6IDEgfSlcbiAgICAgICAgICBdKSxcbiAgICAgICAgICBzZWN1cml0eUluY2lkZW50czogMFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgc3RhdGlzdGljcyBmb3IgZGlmZmVyZW50IHRpbWVmcmFtZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB3ZWVrbHlTdGF0cyA9IGF3YWl0IGF1ZGl0U2VydmljZS5nZXRBdWRpdFN0YXRpc3RpY3MoJ3dlZWtseScpO1xuICAgICAgY29uc3QgbW9udGhseVN0YXRzID0gYXdhaXQgYXVkaXRTZXJ2aWNlLmdldEF1ZGl0U3RhdGlzdGljcygnbW9udGhseScpO1xuXG4gICAgICBleHBlY3Qod2Vla2x5U3RhdHMudG90YWxFdmVudHMpLnRvQmUoMyk7XG4gICAgICBleHBlY3QobW9udGhseVN0YXRzLnRvdGFsRXZlbnRzKS50b0JlKDMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2VjdXJpdHkgZXZlbnQgY2xhc3NpZmljYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjbGFzc2lmeSBsb2dpbiBhY3Rpb25zIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlY3VyaXR5RXZlbnRTcHkgPSBqZXN0LmZuKCk7XG4gICAgICBhdWRpdFNlcnZpY2Uub24oJ3NlY3VyaXR5RXZlbnQnLCBzZWN1cml0eUV2ZW50U3B5KTtcblxuICAgICAgYXdhaXQgYXVkaXRTZXJ2aWNlLmxvZ1VzZXJBY3Rpb24oXG4gICAgICAgICd1c2VyMTIzJyxcbiAgICAgICAgJ2xvZ2luJyxcbiAgICAgICAgJ1VzZXInLFxuICAgICAgICAndXNlcjEyMycsXG4gICAgICAgICcxOTIuMTY4LjEuMScsXG4gICAgICAgICdNb3ppbGxhLzUuMCcsXG4gICAgICAgIHRydWVcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChzZWN1cml0eUV2ZW50U3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHR5cGU6ICdMT0dJTl9TVUNDRVNTJyxcbiAgICAgICAgICBzZXZlcml0eTogJ0xPVydcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNsYXNzaWZ5IGZhaWxlZCBsb2dpbiBhcyBoaWdoIHNldmVyaXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VjdXJpdHlFdmVudFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGF1ZGl0U2VydmljZS5vbignc2VjdXJpdHlFdmVudCcsIHNlY3VyaXR5RXZlbnRTcHkpO1xuXG4gICAgICBhd2FpdCBhdWRpdFNlcnZpY2UubG9nVXNlckFjdGlvbihcbiAgICAgICAgJ3VzZXIxMjMnLFxuICAgICAgICAnbG9naW4nLFxuICAgICAgICAnVXNlcicsXG4gICAgICAgICd1c2VyMTIzJyxcbiAgICAgICAgJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgJ01vemlsbGEvNS4wJyxcbiAgICAgICAgZmFsc2UsXG4gICAgICAgICdJbnZhbGlkIGNyZWRlbnRpYWxzJ1xuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHNlY3VyaXR5RXZlbnRTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdHlwZTogJ0xPR0lOX1NVQ0NFU1MnLFxuICAgICAgICAgIHNldmVyaXR5OiAnSElHSCdcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNsYXNzaWZ5IHBhc3N3b3JkIGNoYW5nZXMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VjdXJpdHlFdmVudFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGF1ZGl0U2VydmljZS5vbignc2VjdXJpdHlFdmVudCcsIHNlY3VyaXR5RXZlbnRTcHkpO1xuXG4gICAgICBhd2FpdCBhdWRpdFNlcnZpY2UubG9nVXNlckFjdGlvbihcbiAgICAgICAgJ3VzZXIxMjMnLFxuICAgICAgICAncGFzc3dvcmRfY2hhbmdlJyxcbiAgICAgICAgJ1VzZXInLFxuICAgICAgICAndXNlcjEyMycsXG4gICAgICAgICcxOTIuMTY4LjEuMScsXG4gICAgICAgICdNb3ppbGxhLzUuMCcsXG4gICAgICAgIHRydWVcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChzZWN1cml0eUV2ZW50U3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHR5cGU6ICdQQVNTV09SRF9DSEFOR0UnLFxuICAgICAgICAgIHNldmVyaXR5OiAnTE9XJ1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2xhc3NpZnkgc3lzdGVtIGNvbmZpZ3VyYXRpb24gYXMgbWVkaXVtIHNldmVyaXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VjdXJpdHlFdmVudFNweSA9IGplc3QuZm4oKTtcbiAgICAgIGF1ZGl0U2VydmljZS5vbignc2VjdXJpdHlFdmVudCcsIHNlY3VyaXR5RXZlbnRTcHkpO1xuXG4gICAgICBhd2FpdCBhdWRpdFNlcnZpY2UubG9nVXNlckFjdGlvbihcbiAgICAgICAgJ3VzZXIxMjMnLFxuICAgICAgICAnc3lzdGVtX2NvbmZpZ3VyYXRpb24nLFxuICAgICAgICAnQ29uZmlnJyxcbiAgICAgICAgJ2NvbmZpZzEnLFxuICAgICAgICAnMTkyLjE2OC4xLjEnLFxuICAgICAgICAnTW96aWxsYS81LjAnLFxuICAgICAgICB0cnVlXG4gICAgICApO1xuXG4gICAgICBleHBlY3Qoc2VjdXJpdHlFdmVudFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB0eXBlOiAnREFUQV9BQ0NFU1MnLFxuICAgICAgICAgIHNldmVyaXR5OiAnTUVESVVNJ1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RhdGEgZW5jcnlwdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGlkZW50aWZ5IHNlbnNpdGl2ZSBmaWVsZHMgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2Vuc2l0aXZlRGF0YSA9IHtcbiAgICAgICAgcGFzc3dvcmQ6ICdzZWNyZXQxMjMnLFxuICAgICAgICBzc246ICcxMjMtNDUtNjc4OScsXG4gICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgIG1lZGljYWxSZWNvcmQ6ICdzZW5zaXRpdmUgaW5mbycsXG4gICAgICAgIG5vcm1hbEZpZWxkOiAnbm90IHNlbnNpdGl2ZSdcbiAgICAgIH07XG5cbiAgICAgIC8vIFRlc3QgdGhyb3VnaCBsb2dVc2VyQWN0aW9uIHdoaWNoIGNhbGxzIHRoZSBwcml2YXRlIG1ldGhvZFxuICAgICAgYXVkaXRTZXJ2aWNlLmxvZ1VzZXJBY3Rpb24oXG4gICAgICAgICd1c2VyMTIzJyxcbiAgICAgICAgJ3JlYWQnLFxuICAgICAgICAnUGF0aWVudCcsXG4gICAgICAgICdwYXQxMjMnLFxuICAgICAgICAnMTkyLjE2OC4xLjEnLFxuICAgICAgICAnTW96aWxsYS81LjAnLFxuICAgICAgICB0cnVlLFxuICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgIHNlbnNpdGl2ZURhdGFcbiAgICAgICk7XG5cbiAgICAgIC8vIFZlcmlmeSBlbmNyeXB0ZWQgb3V0cHV0IGluIGNvbnNvbGUubG9nXG4gICAgICBleHBlY3QoY29uc29sZS5sb2cpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnQXVkaXQgRW50cnk6JyxcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ2VuY3J5cHRlZDonKVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2F1ZGl0IElEIGdlbmVyYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSB1bmlxdWUgYXVkaXQgSURzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaWRzID0gbmV3IFNldCgpO1xuICAgICAgXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgICAgYXdhaXQgYXVkaXRTZXJ2aWNlLmxvZ1VzZXJBY3Rpb24oXG4gICAgICAgICAgJ3VzZXIxMjMnLFxuICAgICAgICAgICdyZWFkJyxcbiAgICAgICAgICAnUGF0aWVudCcsXG4gICAgICAgICAgJ3BhdDEyMycsXG4gICAgICAgICAgJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgICAnTW96aWxsYS81LjAnLFxuICAgICAgICAgIHRydWVcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWxsIElEcyBzaG91bGQgYmUgdW5pcXVlXG4gICAgICBleHBlY3QoaWRzLnNpemUpLnRvQmUoMTApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBhdWRpdCBJRHMgd2l0aCBjb3JyZWN0IGZvcm1hdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50U3B5ID0gamVzdC5mbigpO1xuICAgICAgYXVkaXRTZXJ2aWNlLm9uKCdhdWRpdEVudHJ5JywgZXZlbnRTcHkpO1xuXG4gICAgICBhd2FpdCBhdWRpdFNlcnZpY2UubG9nVXNlckFjdGlvbihcbiAgICAgICAgJ3VzZXIxMjMnLFxuICAgICAgICAncmVhZCcsXG4gICAgICAgICdQYXRpZW50JyxcbiAgICAgICAgJ3BhdDEyMycsXG4gICAgICAgICcxOTIuMTY4LjEuMScsXG4gICAgICAgICdNb3ppbGxhLzUuMCcsXG4gICAgICAgIHRydWVcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGF1ZGl0RW50cnkgPSBldmVudFNweS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KGF1ZGl0RW50cnkuaWQpLnRvTWF0Y2goL15hdWRpdF9bYS16MC05XStfW2EtZjAtOV0rJC8pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXZlbnQgZW1pc3Npb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBlbWl0IGF1ZGl0RW50cnkgZXZlbnRzJywgKGRvbmUpID0+IHtcbiAgICAgIGF1ZGl0U2VydmljZS5vbignYXVkaXRFbnRyeScsIChlbnRyeTogQXVkaXRMb2dFbnRyeSkgPT4ge1xuICAgICAgICBleHBlY3QoZW50cnkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChlbnRyeS51c2VySWQpLnRvQmUoJ3VzZXIxMjMnKTtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGF1ZGl0U2VydmljZS5sb2dVc2VyQWN0aW9uKFxuICAgICAgICAndXNlcjEyMycsXG4gICAgICAgICdyZWFkJyxcbiAgICAgICAgJ1BhdGllbnQnLFxuICAgICAgICAncGF0MTIzJyxcbiAgICAgICAgJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgJ01vemlsbGEvNS4wJyxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBzZWN1cml0eUV2ZW50IGV2ZW50cycsIChkb25lKSA9PiB7XG4gICAgICBhdWRpdFNlcnZpY2Uub24oJ3NlY3VyaXR5RXZlbnQnLCAoZXZlbnQ6IFNlY3VyaXR5RXZlbnQpID0+IHtcbiAgICAgICAgZXhwZWN0KGV2ZW50KS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QoZXZlbnQudXNlcklkKS50b0JlKCd1c2VyMTIzJyk7XG4gICAgICAgIGRvbmUoKTtcbiAgICAgIH0pO1xuXG4gICAgICBhdWRpdFNlcnZpY2UubG9nVXNlckFjdGlvbihcbiAgICAgICAgJ3VzZXIxMjMnLFxuICAgICAgICAnbG9naW4nLFxuICAgICAgICAnVXNlcicsXG4gICAgICAgICd1c2VyMTIzJyxcbiAgICAgICAgJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgJ01vemlsbGEvNS4wJyxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBjcml0aWNhbFNlY3VyaXR5RXZlbnQgZm9yIGNyaXRpY2FsIGV2ZW50cycsIChkb25lKSA9PiB7XG4gICAgICBhdWRpdFNlcnZpY2Uub24oJ2NyaXRpY2FsU2VjdXJpdHlFdmVudCcsIChldmVudDogU2VjdXJpdHlFdmVudCkgPT4ge1xuICAgICAgICBleHBlY3QoZXZlbnQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChldmVudC5zZXZlcml0eSkudG9CZSgnQ1JJVElDQUwnKTtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNyaXRpY2FsRXZlbnQ6IFNlY3VyaXR5RXZlbnQgPSB7XG4gICAgICAgIHR5cGU6ICdVTkFVVEhPUklaRURfQUNDRVNTJyxcbiAgICAgICAgdXNlcklkOiAndXNlcjEyMycsXG4gICAgICAgIHNldmVyaXR5OiAnQ1JJVElDQUwnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0NyaXRpY2FsIHNlY3VyaXR5IGV2ZW50JyxcbiAgICAgICAgbWV0YWRhdGE6IHt9XG4gICAgICB9O1xuXG4gICAgICBhdWRpdFNlcnZpY2UubG9nU2VjdXJpdHlFdmVudChjcml0aWNhbEV2ZW50KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Vycm9yIGhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgZGF0ZXMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRTdGFydERhdGUgPSBuZXcgRGF0ZSgnaW52YWxpZCcpO1xuICAgICAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdCgoKSA9PiBcbiAgICAgICAgYXVkaXRTZXJ2aWNlLmdlbmVyYXRlSGlwYWFDb21wbGlhbmNlUmVwb3J0KFxuICAgICAgICAgIGludmFsaWRTdGFydERhdGUsXG4gICAgICAgICAgZW5kRGF0ZSxcbiAgICAgICAgICAnYWRtaW4nXG4gICAgICAgIClcbiAgICAgICkubm90LnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHNlYXJjaCByZXN1bHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGF1ZGl0U2VydmljZS5zZWFyY2hBdWRpdExvZ3MoJ25vbmV4aXN0ZW50Jyk7XG4gICAgICBleHBlY3QocmVzdWx0cykudG9FcXVhbChbXSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzdGF0aXN0aWNzIHdpdGggbm8gZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGZyZXNoU2VydmljZSA9IG5ldyBBdWRpdFNlcnZpY2UoKTtcbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgZnJlc2hTZXJ2aWNlLmdldEF1ZGl0U3RhdGlzdGljcygpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxFdmVudHMpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMudW5pcXVlVXNlcnMpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMuZXZlbnRzQnlUeXBlKS50b0VxdWFsKHt9KTtcbiAgICAgIFxuICAgICAgZnJlc2hTZXJ2aWNlLnNodXRkb3duKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzaHV0ZG93bicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNsZWFuIHVwIGV2ZW50IGxpc3RlbmVycyBvbiBzaHV0ZG93bicsICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50U3B5ID0gamVzdC5mbigpO1xuICAgICAgYXVkaXRTZXJ2aWNlLm9uKCdhdWRpdEVudHJ5JywgZXZlbnRTcHkpO1xuICAgICAgXG4gICAgICBleHBlY3QoYXVkaXRTZXJ2aWNlLmxpc3RlbmVyQ291bnQoJ2F1ZGl0RW50cnknKSkudG9CZSgxKTtcbiAgICAgIFxuICAgICAgYXVkaXRTZXJ2aWNlLnNodXRkb3duKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChhdWRpdFNlcnZpY2UubGlzdGVuZXJDb3VudCgnYXVkaXRFbnRyeScpKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==