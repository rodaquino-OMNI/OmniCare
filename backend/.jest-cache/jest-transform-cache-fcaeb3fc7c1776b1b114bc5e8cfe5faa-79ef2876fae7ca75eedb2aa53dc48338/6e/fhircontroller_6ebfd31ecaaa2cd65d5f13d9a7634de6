1c48d8f2341f528f3d0312efd7189f1b
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.fhirController = exports.FHIRController = void 0;
const cds_hooks_service_1 = require("@/services/cds-hooks.service");
const fhir_resources_service_1 = require("@/services/fhir-resources.service");
const medplum_service_1 = require("@/services/medplum.service");
const subscriptions_service_1 = require("@/services/subscriptions.service");
const logger_1 = __importDefault(require("@/utils/logger"));
const error_utils_1 = require("@/utils/error.utils");
const fhir_validation_utils_1 = require("@/utils/fhir-validation.utils");
/**
 * FHIR API Controller
 * Handles all FHIR REST API endpoints according to FHIR R4 specification
 */
class FHIRController {
    // ===============================
    // FHIR METADATA AND CAPABILITY
    // ===============================
    /**
     * GET /fhir/R4/metadata - FHIR Capability Statement
     */
    async getCapabilityStatement(req, res) {
        try {
            logger_1.default.fhir('Capability statement requested', {
                userAgent: req.get('User-Agent'),
                ip: req.ip,
            });
            const capabilityStatement = await medplum_service_1.medplumService.getCapabilityStatement();
            res.json(capabilityStatement);
        }
        catch (error) {
            logger_1.default.error('Failed to get capability statement:', error);
            res.status(500).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'exception',
                        diagnostics: 'Failed to retrieve capability statement',
                    }],
            });
        }
    }
    // ===============================
    // RESOURCE CRUD OPERATIONS
    // ===============================
    /**
     * POST /fhir/R4/{resourceType} - Create resource
     */
    async createResource(req, res) {
        try {
            const { resourceType } = req.params;
            const resource = req.body;
            logger_1.default.fhir('Creating resource', {
                resourceType,
                userId: req.user?.id,
                hasId: !!resource.id,
            });
            const validatedResourceType = (0, fhir_validation_utils_1.validateResourceType)(resourceType);
            // Validate resource type
            if (resource.resourceType !== validatedResourceType) {
                res.status(400).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'invalid',
                            diagnostics: `Resource type mismatch: expected ${resourceType}, got ${resource.resourceType}`,
                        }],
                });
                return;
            }
            // Remove id if present (server assigns IDs)
            if (resource.id) {
                delete resource.id;
            }
            const createdResource = await medplum_service_1.medplumService.createResource(resource);
            // Notify subscriptions
            await subscriptions_service_1.subscriptionsService.processResourceChange(validatedResourceType, createdResource.id ?? '', 'create', createdResource);
            res.status(201)
                .location(`/fhir/R4/${resourceType}/${createdResource.id}`)
                .json(createdResource);
        }
        catch (error) {
            logger_1.default.error('Failed to create resource:', error);
            res.status(500).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'exception',
                        diagnostics: 'Failed to create resource',
                    }],
            });
        }
    }
    /**
     * GET /fhir/R4/{resourceType}/{id} - Read resource
     */
    async readResource(req, res) {
        try {
            const { resourceType, id } = req.params;
            logger_1.default.fhir('Reading resource', {
                resourceType,
                id,
                userId: req.user?.id,
            });
            // Validate parameters
            if (!resourceType || !id) {
                res.status(400).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'required',
                            diagnostics: 'Resource type and ID are required',
                        }],
                });
                return;
            }
            const validatedResourceType = (0, fhir_validation_utils_1.validateResourceType)(resourceType);
            const resource = await medplum_service_1.medplumService.readResource(validatedResourceType, id);
            res.json(resource);
        }
        catch (error) {
            logger_1.default.error('Failed to read resource:', error);
            if (((0, error_utils_1.hasMessage)(error) && error.message.includes('not found')) || error.status === 404) {
                res.status(404).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'not-found',
                            diagnostics: `${req.params.resourceType}/${req.params.id} not found`,
                        }],
                });
            }
            else {
                res.status(500).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'exception',
                            diagnostics: 'Failed to read resource',
                        }],
                });
            }
        }
    }
    /**
     * PUT /fhir/R4/{resourceType}/{id} - Update resource
     */
    async updateResource(req, res) {
        try {
            const { resourceType, id } = req.params;
            const resource = req.body;
            logger_1.default.fhir('Updating resource', {
                resourceType,
                id,
                userId: req.user?.id,
            });
            // Validate parameters
            if (!resourceType || !id) {
                res.status(400).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'required',
                            diagnostics: 'Resource type and ID are required',
                        }],
                });
                return;
            }
            const validatedResourceType = (0, fhir_validation_utils_1.validateResourceType)(resourceType);
            // Validate resource type and ID
            if (resource.resourceType !== validatedResourceType) {
                res.status(400).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'invalid',
                            diagnostics: `Resource type mismatch: expected ${resourceType}, got ${resource.resourceType}`,
                        }],
                });
                return;
            }
            if (resource.id && resource.id !== id) {
                res.status(400).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'invalid',
                            diagnostics: `Resource ID mismatch: expected ${id}, got ${resource.id}`,
                        }],
                });
                return;
            }
            // Ensure resource has the correct ID
            resource.id = id;
            const updatedResource = await medplum_service_1.medplumService.updateResource(resource);
            // Notify subscriptions
            await subscriptions_service_1.subscriptionsService.processResourceChange(validatedResourceType, id, 'update', updatedResource);
            res.json(updatedResource);
        }
        catch (error) {
            logger_1.default.error('Failed to update resource:', error);
            if (((0, error_utils_1.hasMessage)(error) && error.message.includes('not found')) || error.status === 404) {
                res.status(404).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'not-found',
                            diagnostics: `${req.params.resourceType}/${req.params.id} not found`,
                        }],
                });
            }
            else {
                res.status(500).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'exception',
                            diagnostics: 'Failed to update resource',
                        }],
                });
            }
        }
    }
    /**
     * DELETE /fhir/R4/{resourceType}/{id} - Delete resource
     */
    async deleteResource(req, res) {
        try {
            const { resourceType, id } = req.params;
            logger_1.default.fhir('Deleting resource', {
                resourceType,
                id,
                userId: req.user?.id,
            });
            // Validate parameters
            if (!resourceType || !id) {
                res.status(400).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'required',
                            diagnostics: 'Resource type and ID are required',
                        }],
                });
                return;
            }
            const validatedResourceType = (0, fhir_validation_utils_1.validateResourceType)(resourceType);
            await medplum_service_1.medplumService.deleteResource(validatedResourceType, id);
            // Notify subscriptions
            await subscriptions_service_1.subscriptionsService.processResourceChange(validatedResourceType, id, 'delete');
            res.status(204).send();
        }
        catch (error) {
            logger_1.default.error('Failed to delete resource:', error);
            if (((0, error_utils_1.hasMessage)(error) && error.message.includes('not found')) || error.status === 404) {
                res.status(404).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'not-found',
                            diagnostics: `${req.params.resourceType}/${req.params.id} not found`,
                        }],
                });
            }
            else {
                res.status(500).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'exception',
                            diagnostics: 'Failed to delete resource',
                        }],
                });
            }
        }
    }
    // ===============================
    // SEARCH OPERATIONS
    // ===============================
    /**
     * GET /fhir/R4/{resourceType} - Search resources
     */
    async searchResources(req, res) {
        try {
            const { resourceType } = req.params;
            const searchParams = req.query;
            logger_1.default.fhir('Searching resources', {
                resourceType,
                searchParams: Object.keys(searchParams),
                userId: req.user?.id,
            });
            // Validate parameters
            if (!resourceType) {
                res.status(400).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'required',
                            diagnostics: 'Resource type is required',
                        }],
                });
                return;
            }
            const validatedResourceType = (0, fhir_validation_utils_1.validateResourceType)(resourceType);
            const searchResults = await medplum_service_1.medplumService.searchResources(validatedResourceType, searchParams);
            res.json(searchResults);
        }
        catch (error) {
            logger_1.default.error('Failed to search resources:', error);
            res.status(500).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'exception',
                        diagnostics: 'Failed to search resources',
                    }],
            });
        }
    }
    // ===============================
    // BATCH/TRANSACTION OPERATIONS
    // ===============================
    /**
     * POST /fhir/R4 - Process batch/transaction bundle
     */
    async processBatch(req, res) {
        try {
            const bundle = req.body;
            logger_1.default.fhir('Processing batch/transaction', {
                bundleType: bundle.type,
                entryCount: bundle.entry?.length || 0,
                userId: req.user?.id,
            });
            if (bundle.resourceType !== 'Bundle') {
                res.status(400).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'invalid',
                            diagnostics: 'Expected Bundle resource type',
                        }],
                });
                return;
            }
            if (!['batch', 'transaction'].includes(bundle.type)) {
                res.status(400).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'invalid',
                            diagnostics: 'Bundle type must be batch or transaction',
                        }],
                });
                return;
            }
            const bundleRequest = {
                resourceType: 'Bundle',
                type: bundle.type,
                resources: bundle.entry?.map((entry) => entry.resource) || [],
                timestamp: bundle.timestamp,
            };
            const result = await medplum_service_1.medplumService.executeBatch(bundleRequest);
            res.json(result);
        }
        catch (error) {
            logger_1.default.error('Failed to process batch/transaction:', error);
            res.status(500).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'exception',
                        diagnostics: 'Failed to process batch/transaction',
                    }],
            });
        }
    }
    // ===============================
    // PATIENT-SPECIFIC OPERATIONS
    // ===============================
    /**
     * GET /fhir/R4/Patient/{id}/$everything - Get all patient data
     */
    async getPatientEverything(req, res) {
        try {
            const { id } = req.params;
            logger_1.default.fhir('Getting patient everything', {
                patientId: id,
                userId: req.user?.id,
            });
            const result = await fhir_resources_service_1.fhirResourcesService.getPatientEverything(id ?? '');
            res.json(result);
        }
        catch (error) {
            logger_1.default.error('Failed to get patient everything:', error);
            res.status(500).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'exception',
                        diagnostics: 'Failed to retrieve patient data',
                    }],
            });
        }
    }
    // ===============================
    // VALIDATION OPERATIONS
    // ===============================
    /**
     * POST /fhir/R4/{resourceType}/$validate - Validate resource
     */
    async validateResource(req, res) {
        try {
            const { resourceType } = req.params;
            const resource = req.body;
            logger_1.default.fhir('Validating resource', {
                resourceType,
                userId: req.user?.id,
            });
            const validationResult = await fhir_resources_service_1.fhirResourcesService.validateResource(resource);
            if (validationResult.valid) {
                res.status(200).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'information',
                            code: 'informational',
                            diagnostics: 'Resource is valid',
                        }],
                });
            }
            else {
                res.status(400).json({
                    resourceType: 'OperationOutcome',
                    issue: [
                        ...validationResult.errors.map(error => ({
                            severity: 'error',
                            code: error.code,
                            diagnostics: error.message,
                            expression: error.path ? [error.path] : undefined,
                        })),
                        ...validationResult.warnings.map(warning => ({
                            severity: 'warning',
                            code: warning.code,
                            diagnostics: warning.message,
                            expression: warning.path ? [warning.path] : undefined,
                        })),
                    ],
                });
            }
        }
        catch (error) {
            logger_1.default.error('Failed to validate resource:', error);
            res.status(500).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'exception',
                        diagnostics: 'Failed to validate resource',
                    }],
            });
        }
    }
    // ===============================
    // GRAPHQL OPERATIONS
    // ===============================
    /**
     * POST /fhir/R4/$graphql - Execute GraphQL query
     */
    async executeGraphQL(req, res) {
        try {
            const { query, variables } = req.body;
            logger_1.default.fhir('Executing GraphQL query', {
                userId: req.user?.id,
                hasVariables: !!variables,
            });
            const result = await medplum_service_1.medplumService.graphql(query, variables);
            res.json(result);
        }
        catch (error) {
            logger_1.default.error('Failed to execute GraphQL query:', error);
            res.status(500).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'exception',
                        diagnostics: 'Failed to execute GraphQL query',
                    }],
            });
        }
    }
    // ===============================
    // CDS HOOKS OPERATIONS
    // ===============================
    /**
     * GET /cds-services - CDS Hooks discovery
     */
    async getCDSServices(req, res) {
        try {
            logger_1.default.info('CDS Hooks discovery requested', {
                userAgent: req.get('User-Agent'),
                ip: req.ip,
            });
            const discoveryDocument = cds_hooks_service_1.cdsHooksService.getDiscoveryDocument();
            res.json(discoveryDocument);
        }
        catch (error) {
            logger_1.default.error('Failed to get CDS services:', error);
            res.status(500).json({
                error: 'Failed to retrieve CDS services',
            });
        }
    }
    /**
     * POST /cds-services/{service-id} - Execute CDS Hook
     */
    async executeCDSHook(req, res) {
        try {
            const { serviceId } = req.params;
            const hookRequest = req.body;
            logger_1.default.info('CDS Hook execution requested', {
                serviceId,
                hook: hookRequest.hook,
                patientId: hookRequest.context.patientId,
                userId: req.user?.id,
            });
            let response;
            switch (serviceId) {
                case 'omnicare-patient-risk-assessment':
                    response = await cds_hooks_service_1.cdsHooksService.executePatientView(hookRequest);
                    break;
                case 'omnicare-medication-safety':
                    response = await cds_hooks_service_1.cdsHooksService.executeMedicationPrescribe(hookRequest);
                    break;
                case 'omnicare-order-review':
                    response = await cds_hooks_service_1.cdsHooksService.executeOrderReview(hookRequest);
                    break;
                default:
                    res.status(404).json({
                        error: `CDS service ${serviceId} not found`,
                    });
                    return;
            }
            res.json(response);
        }
        catch (error) {
            logger_1.default.error('Failed to execute CDS hook:', error);
            res.status(500).json({
                error: 'Failed to execute CDS hook',
            });
        }
    }
    // ===============================
    // SUBSCRIPTION OPERATIONS
    // ===============================
    /**
     * GET /fhir/R4/Subscription - List subscriptions
     */
    async listSubscriptions(req, res) {
        try {
            logger_1.default.fhir('Listing subscriptions', {
                userId: req.user?.id,
            });
            const subscriptions = subscriptions_service_1.subscriptionsService.listActiveSubscriptions();
            const bundle = {
                resourceType: 'Bundle',
                type: 'searchset',
                total: subscriptions.length,
                entry: subscriptions.map(sub => ({
                    resource: {
                        resourceType: 'Subscription',
                        id: sub.id,
                        status: sub.status,
                        criteria: sub.criteria,
                        channel: sub.channel,
                        reason: 'OmniCare EMR Subscription',
                    },
                })),
            };
            res.json(bundle);
        }
        catch (error) {
            logger_1.default.error('Failed to list subscriptions:', error);
            res.status(500).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'exception',
                        diagnostics: 'Failed to list subscriptions',
                    }],
            });
        }
    }
    // ===============================
    // HEALTH CHECK
    // ===============================
    /**
     * GET /health - Health check endpoint
     */
    async healthCheck(req, res) {
        try {
            const [medplumHealth, cdsHealth, subscriptionsHealth] = await Promise.all([
                medplum_service_1.medplumService.getHealthStatus(),
                cds_hooks_service_1.cdsHooksService.getHealthStatus(),
                subscriptions_service_1.subscriptionsService.getHealthStatus(),
            ]);
            const overallStatus = [medplumHealth, cdsHealth, subscriptionsHealth]
                .every(health => health.status === 'UP') ? 'UP' : 'DOWN';
            const healthStatus = {
                status: overallStatus,
                timestamp: new Date().toISOString(),
                components: {
                    medplum: medplumHealth,
                    cdsHooks: cdsHealth,
                    subscriptions: subscriptionsHealth,
                },
            };
            res.status(overallStatus === 'UP' ? 200 : 503).json(healthStatus);
        }
        catch (error) {
            logger_1.default.error('Health check failed:', error);
            res.status(503).json({
                status: 'DOWN',
                timestamp: new Date().toISOString(),
                error: 'Health check failed',
            });
        }
    }
}
exports.FHIRController = FHIRController;
// Export singleton instance
exports.fhirController = new FHIRController();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvc3JjL2NvbnRyb2xsZXJzL2ZoaXIuY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQSxvRUFBK0Q7QUFDL0QsOEVBQXlFO0FBQ3pFLGdFQUE0RDtBQUM1RCw0RUFBd0U7QUFFeEUsNERBQW9DO0FBQ3BDLHFEQUFrRTtBQUNsRSx5RUFBcUU7QUFFckU7OztHQUdHO0FBQ0gsTUFBYSxjQUFjO0lBRXpCLGtDQUFrQztJQUNsQywrQkFBK0I7SUFDL0Isa0NBQWtDO0lBRWxDOztPQUVHO0lBQ0gsS0FBSyxDQUFDLHNCQUFzQixDQUFDLEdBQVksRUFBRSxHQUFhO1FBQ3RELElBQUksQ0FBQztZQUNILGdCQUFNLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxFQUFFO2dCQUM1QyxTQUFTLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUM7Z0JBQ2hDLEVBQUUsRUFBRSxHQUFHLENBQUMsRUFBRTthQUNYLENBQUMsQ0FBQztZQUVILE1BQU0sbUJBQW1CLEdBQUcsTUFBTSxnQ0FBYyxDQUFDLHNCQUFzQixFQUFFLENBQUM7WUFFMUUsR0FBRyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ2hDLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsZ0JBQU0sQ0FBQyxLQUFLLENBQUMscUNBQXFDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDM0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLFlBQVksRUFBRSxrQkFBa0I7Z0JBQ2hDLEtBQUssRUFBRSxDQUFDO3dCQUNOLFFBQVEsRUFBRSxPQUFPO3dCQUNqQixJQUFJLEVBQUUsV0FBVzt3QkFDakIsV0FBVyxFQUFFLHlDQUF5QztxQkFDdkQsQ0FBQzthQUNILENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDO0lBRUQsa0NBQWtDO0lBQ2xDLDJCQUEyQjtJQUMzQixr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QUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLGdCQUFNLENBQUMsS0FBSyxDQUFDLHNCQUFzQixFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQzVDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixNQUFNLEVBQUUsTUFBTTtnQkFDZCxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7Z0JBQ25DLEtBQUssRUFBRSxxQkFBcUI7YUFDN0IsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUM7Q0FDRjtBQXJyQkQsd0NBcXJCQztBQUVELDRCQUE0QjtBQUNmLFFBQUEsY0FBYyxHQUFHLElBQUksY0FBYyxFQUFFLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvc3JjL2NvbnRyb2xsZXJzL2ZoaXIuY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gJ2V4cHJlc3MnO1xuXG5pbXBvcnQgeyBjZHNIb29rc1NlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2Nkcy1ob29rcy5zZXJ2aWNlJztcbmltcG9ydCB7IGZoaXJSZXNvdXJjZXNTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9maGlyLXJlc291cmNlcy5zZXJ2aWNlJztcbmltcG9ydCB7IG1lZHBsdW1TZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9tZWRwbHVtLnNlcnZpY2UnO1xuaW1wb3J0IHsgc3Vic2NyaXB0aW9uc1NlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL3N1YnNjcmlwdGlvbnMuc2VydmljZSc7XG5pbXBvcnQgeyBGSElSU2VhcmNoUGFyYW1zLCBDRFNIb29rUmVxdWVzdCwgQnVuZGxlUmVxdWVzdCB9IGZyb20gJ0AvdHlwZXMvZmhpcic7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJ0AvdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IGdldEVycm9yTWVzc2FnZSwgaGFzTWVzc2FnZSB9IGZyb20gJ0AvdXRpbHMvZXJyb3IudXRpbHMnO1xuaW1wb3J0IHsgdmFsaWRhdGVSZXNvdXJjZVR5cGUgfSBmcm9tICdAL3V0aWxzL2ZoaXItdmFsaWRhdGlvbi51dGlscyc7XG5cbi8qKlxuICogRkhJUiBBUEkgQ29udHJvbGxlclxuICogSGFuZGxlcyBhbGwgRkhJUiBSRVNUIEFQSSBlbmRwb2ludHMgYWNjb3JkaW5nIHRvIEZISVIgUjQgc3BlY2lmaWNhdGlvblxuICovXG5leHBvcnQgY2xhc3MgRkhJUkNvbnRyb2xsZXIge1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gRkhJUiBNRVRBREFUQSBBTkQgQ0FQQUJJTElUWVxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIEdFVCAvZmhpci9SNC9tZXRhZGF0YSAtIEZISVIgQ2FwYWJpbGl0eSBTdGF0ZW1lbnRcbiAgICovXG4gIGFzeW5jIGdldENhcGFiaWxpdHlTdGF0ZW1lbnQocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGxvZ2dlci5maGlyKCdDYXBhYmlsaXR5IHN0YXRlbWVudCByZXF1ZXN0ZWQnLCB7XG4gICAgICAgIHVzZXJBZ2VudDogcmVxLmdldCgnVXNlci1BZ2VudCcpLFxuICAgICAgICBpcDogcmVxLmlwLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNhcGFiaWxpdHlTdGF0ZW1lbnQgPSBhd2FpdCBtZWRwbHVtU2VydmljZS5nZXRDYXBhYmlsaXR5U3RhdGVtZW50KCk7XG4gICAgICBcbiAgICAgIHJlcy5qc29uKGNhcGFiaWxpdHlTdGF0ZW1lbnQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgY2FwYWJpbGl0eSBzdGF0ZW1lbnQ6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgY29kZTogJ2V4Y2VwdGlvbicsXG4gICAgICAgICAgZGlhZ25vc3RpY3M6ICdGYWlsZWQgdG8gcmV0cmlldmUgY2FwYWJpbGl0eSBzdGF0ZW1lbnQnLFxuICAgICAgICB9XSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gUkVTT1VSQ0UgQ1JVRCBPUEVSQVRJT05TXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogUE9TVCAvZmhpci9SNC97cmVzb3VyY2VUeXBlfSAtIENyZWF0ZSByZXNvdXJjZVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlUmVzb3VyY2UocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgcmVzb3VyY2VUeXBlIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgcmVzb3VyY2UgPSByZXEuYm9keTtcblxuICAgICAgbG9nZ2VyLmZoaXIoJ0NyZWF0aW5nIHJlc291cmNlJywge1xuICAgICAgICByZXNvdXJjZVR5cGUsXG4gICAgICAgIHVzZXJJZDogcmVxLnVzZXI/LmlkLFxuICAgICAgICBoYXNJZDogISFyZXNvdXJjZS5pZCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB2YWxpZGF0ZWRSZXNvdXJjZVR5cGUgPSB2YWxpZGF0ZVJlc291cmNlVHlwZShyZXNvdXJjZVR5cGUpO1xuXG4gICAgICAvLyBWYWxpZGF0ZSByZXNvdXJjZSB0eXBlXG4gICAgICBpZiAocmVzb3VyY2UucmVzb3VyY2VUeXBlICE9PSB2YWxpZGF0ZWRSZXNvdXJjZVR5cGUpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHJlc291cmNlVHlwZTogJ09wZXJhdGlvbk91dGNvbWUnLFxuICAgICAgICAgIGlzc3VlOiBbe1xuICAgICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgICBjb2RlOiAnaW52YWxpZCcsXG4gICAgICAgICAgICBkaWFnbm9zdGljczogYFJlc291cmNlIHR5cGUgbWlzbWF0Y2g6IGV4cGVjdGVkICR7cmVzb3VyY2VUeXBlfSwgZ290ICR7cmVzb3VyY2UucmVzb3VyY2VUeXBlfWAsXG4gICAgICAgICAgfV0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFJlbW92ZSBpZCBpZiBwcmVzZW50IChzZXJ2ZXIgYXNzaWducyBJRHMpXG4gICAgICBpZiAocmVzb3VyY2UuaWQpIHtcbiAgICAgICAgZGVsZXRlIHJlc291cmNlLmlkO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBjcmVhdGVkUmVzb3VyY2UgPSBhd2FpdCBtZWRwbHVtU2VydmljZS5jcmVhdGVSZXNvdXJjZShyZXNvdXJjZSk7XG5cbiAgICAgIC8vIE5vdGlmeSBzdWJzY3JpcHRpb25zXG4gICAgICBhd2FpdCBzdWJzY3JpcHRpb25zU2VydmljZS5wcm9jZXNzUmVzb3VyY2VDaGFuZ2UoXG4gICAgICAgIHZhbGlkYXRlZFJlc291cmNlVHlwZSxcbiAgICAgICAgY3JlYXRlZFJlc291cmNlLmlkID8/ICcnLFxuICAgICAgICAnY3JlYXRlJyxcbiAgICAgICAgY3JlYXRlZFJlc291cmNlXG4gICAgICApO1xuXG4gICAgICByZXMuc3RhdHVzKDIwMSlcbiAgICAgICAgLmxvY2F0aW9uKGAvZmhpci9SNC8ke3Jlc291cmNlVHlwZX0vJHtjcmVhdGVkUmVzb3VyY2UuaWR9YClcbiAgICAgICAgLmpzb24oY3JlYXRlZFJlc291cmNlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIHJlc291cmNlOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgIGlzc3VlOiBbe1xuICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgIGNvZGU6ICdleGNlcHRpb24nLFxuICAgICAgICAgIGRpYWdub3N0aWNzOiAnRmFpbGVkIHRvIGNyZWF0ZSByZXNvdXJjZScsXG4gICAgICAgIH1dLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdFVCAvZmhpci9SNC97cmVzb3VyY2VUeXBlfS97aWR9IC0gUmVhZCByZXNvdXJjZVxuICAgKi9cbiAgYXN5bmMgcmVhZFJlc291cmNlKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHJlc291cmNlVHlwZSwgaWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIGxvZ2dlci5maGlyKCdSZWFkaW5nIHJlc291cmNlJywge1xuICAgICAgICByZXNvdXJjZVR5cGUsXG4gICAgICAgIGlkLFxuICAgICAgICB1c2VySWQ6IHJlcS51c2VyPy5pZCxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBWYWxpZGF0ZSBwYXJhbWV0ZXJzXG4gICAgICBpZiAoIXJlc291cmNlVHlwZSB8fCAhaWQpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHJlc291cmNlVHlwZTogJ09wZXJhdGlvbk91dGNvbWUnLFxuICAgICAgICAgIGlzc3VlOiBbe1xuICAgICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgICBjb2RlOiAncmVxdWlyZWQnLFxuICAgICAgICAgICAgZGlhZ25vc3RpY3M6ICdSZXNvdXJjZSB0eXBlIGFuZCBJRCBhcmUgcmVxdWlyZWQnLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB2YWxpZGF0ZWRSZXNvdXJjZVR5cGUgPSB2YWxpZGF0ZVJlc291cmNlVHlwZShyZXNvdXJjZVR5cGUpO1xuICAgICAgY29uc3QgcmVzb3VyY2UgPSBhd2FpdCBtZWRwbHVtU2VydmljZS5yZWFkUmVzb3VyY2UodmFsaWRhdGVkUmVzb3VyY2VUeXBlLCBpZCk7XG4gICAgICBcbiAgICAgIHJlcy5qc29uKHJlc291cmNlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gcmVhZCByZXNvdXJjZTonLCBlcnJvcik7XG4gICAgICBcbiAgICAgIGlmICgoaGFzTWVzc2FnZShlcnJvcikgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnbm90IGZvdW5kJykpIHx8IChlcnJvciBhcyBhbnkpLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgICAgY29kZTogJ25vdC1mb3VuZCcsXG4gICAgICAgICAgICBkaWFnbm9zdGljczogYCR7cmVxLnBhcmFtcy5yZXNvdXJjZVR5cGV9LyR7cmVxLnBhcmFtcy5pZH0gbm90IGZvdW5kYCxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdleGNlcHRpb24nLFxuICAgICAgICAgICAgZGlhZ25vc3RpY3M6ICdGYWlsZWQgdG8gcmVhZCByZXNvdXJjZScsXG4gICAgICAgICAgfV0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQVVQgL2ZoaXIvUjQve3Jlc291cmNlVHlwZX0ve2lkfSAtIFVwZGF0ZSByZXNvdXJjZVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlUmVzb3VyY2UocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgcmVzb3VyY2VUeXBlLCBpZCB9ID0gcmVxLnBhcmFtcztcbiAgICAgIGNvbnN0IHJlc291cmNlID0gcmVxLmJvZHk7XG5cbiAgICAgIGxvZ2dlci5maGlyKCdVcGRhdGluZyByZXNvdXJjZScsIHtcbiAgICAgICAgcmVzb3VyY2VUeXBlLFxuICAgICAgICBpZCxcbiAgICAgICAgdXNlcklkOiByZXEudXNlcj8uaWQsXG4gICAgICB9KTtcblxuICAgICAgLy8gVmFsaWRhdGUgcGFyYW1ldGVyc1xuICAgICAgaWYgKCFyZXNvdXJjZVR5cGUgfHwgIWlkKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgICAgY29kZTogJ3JlcXVpcmVkJyxcbiAgICAgICAgICAgIGRpYWdub3N0aWNzOiAnUmVzb3VyY2UgdHlwZSBhbmQgSUQgYXJlIHJlcXVpcmVkJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdmFsaWRhdGVkUmVzb3VyY2VUeXBlID0gdmFsaWRhdGVSZXNvdXJjZVR5cGUocmVzb3VyY2VUeXBlKTtcblxuICAgICAgLy8gVmFsaWRhdGUgcmVzb3VyY2UgdHlwZSBhbmQgSURcbiAgICAgIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgIT09IHZhbGlkYXRlZFJlc291cmNlVHlwZSkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdpbnZhbGlkJyxcbiAgICAgICAgICAgIGRpYWdub3N0aWNzOiBgUmVzb3VyY2UgdHlwZSBtaXNtYXRjaDogZXhwZWN0ZWQgJHtyZXNvdXJjZVR5cGV9LCBnb3QgJHtyZXNvdXJjZS5yZXNvdXJjZVR5cGV9YCxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlc291cmNlLmlkICYmIHJlc291cmNlLmlkICE9PSBpZCkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdpbnZhbGlkJyxcbiAgICAgICAgICAgIGRpYWdub3N0aWNzOiBgUmVzb3VyY2UgSUQgbWlzbWF0Y2g6IGV4cGVjdGVkICR7aWR9LCBnb3QgJHtyZXNvdXJjZS5pZH1gLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBFbnN1cmUgcmVzb3VyY2UgaGFzIHRoZSBjb3JyZWN0IElEXG4gICAgICByZXNvdXJjZS5pZCA9IGlkO1xuXG4gICAgICBjb25zdCB1cGRhdGVkUmVzb3VyY2UgPSBhd2FpdCBtZWRwbHVtU2VydmljZS51cGRhdGVSZXNvdXJjZShyZXNvdXJjZSk7XG5cbiAgICAgIC8vIE5vdGlmeSBzdWJzY3JpcHRpb25zXG4gICAgICBhd2FpdCBzdWJzY3JpcHRpb25zU2VydmljZS5wcm9jZXNzUmVzb3VyY2VDaGFuZ2UoXG4gICAgICAgIHZhbGlkYXRlZFJlc291cmNlVHlwZSxcbiAgICAgICAgaWQsXG4gICAgICAgICd1cGRhdGUnLFxuICAgICAgICB1cGRhdGVkUmVzb3VyY2VcbiAgICAgICk7XG5cbiAgICAgIHJlcy5qc29uKHVwZGF0ZWRSZXNvdXJjZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHVwZGF0ZSByZXNvdXJjZTonLCBlcnJvcik7XG4gICAgICBcbiAgICAgIGlmICgoaGFzTWVzc2FnZShlcnJvcikgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnbm90IGZvdW5kJykpIHx8IChlcnJvciBhcyBhbnkpLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgICAgY29kZTogJ25vdC1mb3VuZCcsXG4gICAgICAgICAgICBkaWFnbm9zdGljczogYCR7cmVxLnBhcmFtcy5yZXNvdXJjZVR5cGV9LyR7cmVxLnBhcmFtcy5pZH0gbm90IGZvdW5kYCxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdleGNlcHRpb24nLFxuICAgICAgICAgICAgZGlhZ25vc3RpY3M6ICdGYWlsZWQgdG8gdXBkYXRlIHJlc291cmNlJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERFTEVURSAvZmhpci9SNC97cmVzb3VyY2VUeXBlfS97aWR9IC0gRGVsZXRlIHJlc291cmNlXG4gICAqL1xuICBhc3luYyBkZWxldGVSZXNvdXJjZShyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyByZXNvdXJjZVR5cGUsIGlkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBsb2dnZXIuZmhpcignRGVsZXRpbmcgcmVzb3VyY2UnLCB7XG4gICAgICAgIHJlc291cmNlVHlwZSxcbiAgICAgICAgaWQsXG4gICAgICAgIHVzZXJJZDogcmVxLnVzZXI/LmlkLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFZhbGlkYXRlIHBhcmFtZXRlcnNcbiAgICAgIGlmICghcmVzb3VyY2VUeXBlIHx8ICFpZCkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdyZXF1aXJlZCcsXG4gICAgICAgICAgICBkaWFnbm9zdGljczogJ1Jlc291cmNlIHR5cGUgYW5kIElEIGFyZSByZXF1aXJlZCcsXG4gICAgICAgICAgfV0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZFJlc291cmNlVHlwZSA9IHZhbGlkYXRlUmVzb3VyY2VUeXBlKHJlc291cmNlVHlwZSk7XG4gICAgICBhd2FpdCBtZWRwbHVtU2VydmljZS5kZWxldGVSZXNvdXJjZSh2YWxpZGF0ZWRSZXNvdXJjZVR5cGUsIGlkKTtcblxuICAgICAgLy8gTm90aWZ5IHN1YnNjcmlwdGlvbnNcbiAgICAgIGF3YWl0IHN1YnNjcmlwdGlvbnNTZXJ2aWNlLnByb2Nlc3NSZXNvdXJjZUNoYW5nZShcbiAgICAgICAgdmFsaWRhdGVkUmVzb3VyY2VUeXBlLFxuICAgICAgICBpZCxcbiAgICAgICAgJ2RlbGV0ZSdcbiAgICAgICk7XG5cbiAgICAgIHJlcy5zdGF0dXMoMjA0KS5zZW5kKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGRlbGV0ZSByZXNvdXJjZTonLCBlcnJvcik7XG4gICAgICBcbiAgICAgIGlmICgoaGFzTWVzc2FnZShlcnJvcikgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnbm90IGZvdW5kJykpIHx8IChlcnJvciBhcyBhbnkpLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgICAgY29kZTogJ25vdC1mb3VuZCcsXG4gICAgICAgICAgICBkaWFnbm9zdGljczogYCR7cmVxLnBhcmFtcy5yZXNvdXJjZVR5cGV9LyR7cmVxLnBhcmFtcy5pZH0gbm90IGZvdW5kYCxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdleGNlcHRpb24nLFxuICAgICAgICAgICAgZGlhZ25vc3RpY3M6ICdGYWlsZWQgdG8gZGVsZXRlIHJlc291cmNlJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBTRUFSQ0ggT1BFUkFUSU9OU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIEdFVCAvZmhpci9SNC97cmVzb3VyY2VUeXBlfSAtIFNlYXJjaCByZXNvdXJjZXNcbiAgICovXG4gIGFzeW5jIHNlYXJjaFJlc291cmNlcyhyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyByZXNvdXJjZVR5cGUgfSA9IHJlcS5wYXJhbXM7XG4gICAgICBjb25zdCBzZWFyY2hQYXJhbXM6IEZISVJTZWFyY2hQYXJhbXMgPSByZXEucXVlcnkgYXMgYW55O1xuXG4gICAgICBsb2dnZXIuZmhpcignU2VhcmNoaW5nIHJlc291cmNlcycsIHtcbiAgICAgICAgcmVzb3VyY2VUeXBlLFxuICAgICAgICBzZWFyY2hQYXJhbXM6IE9iamVjdC5rZXlzKHNlYXJjaFBhcmFtcyksXG4gICAgICAgIHVzZXJJZDogcmVxLnVzZXI/LmlkLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFZhbGlkYXRlIHBhcmFtZXRlcnNcbiAgICAgIGlmICghcmVzb3VyY2VUeXBlKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgICAgY29kZTogJ3JlcXVpcmVkJyxcbiAgICAgICAgICAgIGRpYWdub3N0aWNzOiAnUmVzb3VyY2UgdHlwZSBpcyByZXF1aXJlZCcsXG4gICAgICAgICAgfV0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZFJlc291cmNlVHlwZSA9IHZhbGlkYXRlUmVzb3VyY2VUeXBlKHJlc291cmNlVHlwZSk7XG4gICAgICBjb25zdCBzZWFyY2hSZXN1bHRzID0gYXdhaXQgbWVkcGx1bVNlcnZpY2Uuc2VhcmNoUmVzb3VyY2VzKHZhbGlkYXRlZFJlc291cmNlVHlwZSwgc2VhcmNoUGFyYW1zKTtcbiAgICAgIFxuICAgICAgcmVzLmpzb24oc2VhcmNoUmVzdWx0cyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHNlYXJjaCByZXNvdXJjZXM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgY29kZTogJ2V4Y2VwdGlvbicsXG4gICAgICAgICAgZGlhZ25vc3RpY3M6ICdGYWlsZWQgdG8gc2VhcmNoIHJlc291cmNlcycsXG4gICAgICAgIH1dLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBCQVRDSC9UUkFOU0FDVElPTiBPUEVSQVRJT05TXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogUE9TVCAvZmhpci9SNCAtIFByb2Nlc3MgYmF0Y2gvdHJhbnNhY3Rpb24gYnVuZGxlXG4gICAqL1xuICBhc3luYyBwcm9jZXNzQmF0Y2gocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGJ1bmRsZSA9IHJlcS5ib2R5O1xuXG4gICAgICBsb2dnZXIuZmhpcignUHJvY2Vzc2luZyBiYXRjaC90cmFuc2FjdGlvbicsIHtcbiAgICAgICAgYnVuZGxlVHlwZTogYnVuZGxlLnR5cGUsXG4gICAgICAgIGVudHJ5Q291bnQ6IGJ1bmRsZS5lbnRyeT8ubGVuZ3RoIHx8IDAsXG4gICAgICAgIHVzZXJJZDogcmVxLnVzZXI/LmlkLFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChidW5kbGUucmVzb3VyY2VUeXBlICE9PSAnQnVuZGxlJykge1xuICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdpbnZhbGlkJyxcbiAgICAgICAgICAgIGRpYWdub3N0aWNzOiAnRXhwZWN0ZWQgQnVuZGxlIHJlc291cmNlIHR5cGUnLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoIVsnYmF0Y2gnLCAndHJhbnNhY3Rpb24nXS5pbmNsdWRlcyhidW5kbGUudHlwZSkpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHJlc291cmNlVHlwZTogJ09wZXJhdGlvbk91dGNvbWUnLFxuICAgICAgICAgIGlzc3VlOiBbe1xuICAgICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgICBjb2RlOiAnaW52YWxpZCcsXG4gICAgICAgICAgICBkaWFnbm9zdGljczogJ0J1bmRsZSB0eXBlIG11c3QgYmUgYmF0Y2ggb3IgdHJhbnNhY3Rpb24nLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBidW5kbGVSZXF1ZXN0OiBCdW5kbGVSZXF1ZXN0ID0ge1xuICAgICAgICByZXNvdXJjZVR5cGU6ICdCdW5kbGUnLFxuICAgICAgICB0eXBlOiBidW5kbGUudHlwZSxcbiAgICAgICAgcmVzb3VyY2VzOiBidW5kbGUuZW50cnk/Lm1hcCgoZW50cnk6IGFueSkgPT4gZW50cnkucmVzb3VyY2UpIHx8IFtdLFxuICAgICAgICB0aW1lc3RhbXA6IGJ1bmRsZS50aW1lc3RhbXAsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtZWRwbHVtU2VydmljZS5leGVjdXRlQmF0Y2goYnVuZGxlUmVxdWVzdCk7XG4gICAgICBcbiAgICAgIHJlcy5qc29uKHJlc3VsdCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHByb2Nlc3MgYmF0Y2gvdHJhbnNhY3Rpb246JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgY29kZTogJ2V4Y2VwdGlvbicsXG4gICAgICAgICAgZGlhZ25vc3RpY3M6ICdGYWlsZWQgdG8gcHJvY2VzcyBiYXRjaC90cmFuc2FjdGlvbicsXG4gICAgICAgIH1dLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBQQVRJRU5ULVNQRUNJRklDIE9QRVJBVElPTlNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBHRVQgL2ZoaXIvUjQvUGF0aWVudC97aWR9LyRldmVyeXRoaW5nIC0gR2V0IGFsbCBwYXRpZW50IGRhdGFcbiAgICovXG4gIGFzeW5jIGdldFBhdGllbnRFdmVyeXRoaW5nKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBsb2dnZXIuZmhpcignR2V0dGluZyBwYXRpZW50IGV2ZXJ5dGhpbmcnLCB7XG4gICAgICAgIHBhdGllbnRJZDogaWQsXG4gICAgICAgIHVzZXJJZDogcmVxLnVzZXI/LmlkLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZoaXJSZXNvdXJjZXNTZXJ2aWNlLmdldFBhdGllbnRFdmVyeXRoaW5nKGlkID8/ICcnKTtcbiAgICAgIFxuICAgICAgcmVzLmpzb24ocmVzdWx0KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZ2V0IHBhdGllbnQgZXZlcnl0aGluZzonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHJlc291cmNlVHlwZTogJ09wZXJhdGlvbk91dGNvbWUnLFxuICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICBjb2RlOiAnZXhjZXB0aW9uJyxcbiAgICAgICAgICBkaWFnbm9zdGljczogJ0ZhaWxlZCB0byByZXRyaWV2ZSBwYXRpZW50IGRhdGEnLFxuICAgICAgICB9XSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gVkFMSURBVElPTiBPUEVSQVRJT05TXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogUE9TVCAvZmhpci9SNC97cmVzb3VyY2VUeXBlfS8kdmFsaWRhdGUgLSBWYWxpZGF0ZSByZXNvdXJjZVxuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGVSZXNvdXJjZShyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyByZXNvdXJjZVR5cGUgfSA9IHJlcS5wYXJhbXM7XG4gICAgICBjb25zdCByZXNvdXJjZSA9IHJlcS5ib2R5O1xuXG4gICAgICBsb2dnZXIuZmhpcignVmFsaWRhdGluZyByZXNvdXJjZScsIHtcbiAgICAgICAgcmVzb3VyY2VUeXBlLFxuICAgICAgICB1c2VySWQ6IHJlcS51c2VyPy5pZCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gYXdhaXQgZmhpclJlc291cmNlc1NlcnZpY2UudmFsaWRhdGVSZXNvdXJjZShyZXNvdXJjZSk7XG4gICAgICBcbiAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0LnZhbGlkKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICAgIHNldmVyaXR5OiAnaW5mb3JtYXRpb24nLFxuICAgICAgICAgICAgY29kZTogJ2luZm9ybWF0aW9uYWwnLFxuICAgICAgICAgICAgZGlhZ25vc3RpY3M6ICdSZXNvdXJjZSBpcyB2YWxpZCcsXG4gICAgICAgICAgfV0sXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHJlc291cmNlVHlwZTogJ09wZXJhdGlvbk91dGNvbWUnLFxuICAgICAgICAgIGlzc3VlOiBbXG4gICAgICAgICAgICAuLi52YWxpZGF0aW9uUmVzdWx0LmVycm9ycy5tYXAoZXJyb3IgPT4gKHtcbiAgICAgICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicgYXMgY29uc3QsXG4gICAgICAgICAgICAgIGNvZGU6IGVycm9yLmNvZGUsXG4gICAgICAgICAgICAgIGRpYWdub3N0aWNzOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgICBleHByZXNzaW9uOiBlcnJvci5wYXRoID8gW2Vycm9yLnBhdGhdIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgLi4udmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5tYXAod2FybmluZyA9PiAoe1xuICAgICAgICAgICAgICBzZXZlcml0eTogJ3dhcm5pbmcnIGFzIGNvbnN0LFxuICAgICAgICAgICAgICBjb2RlOiB3YXJuaW5nLmNvZGUsXG4gICAgICAgICAgICAgIGRpYWdub3N0aWNzOiB3YXJuaW5nLm1lc3NhZ2UsXG4gICAgICAgICAgICAgIGV4cHJlc3Npb246IHdhcm5pbmcucGF0aCA/IFt3YXJuaW5nLnBhdGhdIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgIF0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byB2YWxpZGF0ZSByZXNvdXJjZTonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHJlc291cmNlVHlwZTogJ09wZXJhdGlvbk91dGNvbWUnLFxuICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICBjb2RlOiAnZXhjZXB0aW9uJyxcbiAgICAgICAgICBkaWFnbm9zdGljczogJ0ZhaWxlZCB0byB2YWxpZGF0ZSByZXNvdXJjZScsXG4gICAgICAgIH1dLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBHUkFQSFFMIE9QRVJBVElPTlNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBQT1NUIC9maGlyL1I0LyRncmFwaHFsIC0gRXhlY3V0ZSBHcmFwaFFMIHF1ZXJ5XG4gICAqL1xuICBhc3luYyBleGVjdXRlR3JhcGhRTChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBxdWVyeSwgdmFyaWFibGVzIH0gPSByZXEuYm9keTtcblxuICAgICAgbG9nZ2VyLmZoaXIoJ0V4ZWN1dGluZyBHcmFwaFFMIHF1ZXJ5Jywge1xuICAgICAgICB1c2VySWQ6IHJlcS51c2VyPy5pZCxcbiAgICAgICAgaGFzVmFyaWFibGVzOiAhIXZhcmlhYmxlcyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtZWRwbHVtU2VydmljZS5ncmFwaHFsKHF1ZXJ5LCB2YXJpYWJsZXMpO1xuICAgICAgXG4gICAgICByZXMuanNvbihyZXN1bHQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBleGVjdXRlIEdyYXBoUUwgcXVlcnk6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgY29kZTogJ2V4Y2VwdGlvbicsXG4gICAgICAgICAgZGlhZ25vc3RpY3M6ICdGYWlsZWQgdG8gZXhlY3V0ZSBHcmFwaFFMIHF1ZXJ5JyxcbiAgICAgICAgfV0sXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIENEUyBIT09LUyBPUEVSQVRJT05TXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogR0VUIC9jZHMtc2VydmljZXMgLSBDRFMgSG9va3MgZGlzY292ZXJ5XG4gICAqL1xuICBhc3luYyBnZXRDRFNTZXJ2aWNlcyhyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmluZm8oJ0NEUyBIb29rcyBkaXNjb3ZlcnkgcmVxdWVzdGVkJywge1xuICAgICAgICB1c2VyQWdlbnQ6IHJlcS5nZXQoJ1VzZXItQWdlbnQnKSxcbiAgICAgICAgaXA6IHJlcS5pcCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBkaXNjb3ZlcnlEb2N1bWVudCA9IGNkc0hvb2tzU2VydmljZS5nZXREaXNjb3ZlcnlEb2N1bWVudCgpO1xuICAgICAgXG4gICAgICByZXMuanNvbihkaXNjb3ZlcnlEb2N1bWVudCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGdldCBDRFMgc2VydmljZXM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byByZXRyaWV2ZSBDRFMgc2VydmljZXMnLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBPU1QgL2Nkcy1zZXJ2aWNlcy97c2VydmljZS1pZH0gLSBFeGVjdXRlIENEUyBIb29rXG4gICAqL1xuICBhc3luYyBleGVjdXRlQ0RTSG9vayhyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBzZXJ2aWNlSWQgfSA9IHJlcS5wYXJhbXM7XG4gICAgICBjb25zdCBob29rUmVxdWVzdDogQ0RTSG9va1JlcXVlc3QgPSByZXEuYm9keTtcblxuICAgICAgbG9nZ2VyLmluZm8oJ0NEUyBIb29rIGV4ZWN1dGlvbiByZXF1ZXN0ZWQnLCB7XG4gICAgICAgIHNlcnZpY2VJZCxcbiAgICAgICAgaG9vazogaG9va1JlcXVlc3QuaG9vayxcbiAgICAgICAgcGF0aWVudElkOiBob29rUmVxdWVzdC5jb250ZXh0LnBhdGllbnRJZCxcbiAgICAgICAgdXNlcklkOiByZXEudXNlcj8uaWQsXG4gICAgICB9KTtcblxuICAgICAgbGV0IHJlc3BvbnNlO1xuICAgICAgXG4gICAgICBzd2l0Y2ggKHNlcnZpY2VJZCkge1xuICAgICAgICBjYXNlICdvbW5pY2FyZS1wYXRpZW50LXJpc2stYXNzZXNzbWVudCc6XG4gICAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCBjZHNIb29rc1NlcnZpY2UuZXhlY3V0ZVBhdGllbnRWaWV3KGhvb2tSZXF1ZXN0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnb21uaWNhcmUtbWVkaWNhdGlvbi1zYWZldHknOlxuICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgY2RzSG9va3NTZXJ2aWNlLmV4ZWN1dGVNZWRpY2F0aW9uUHJlc2NyaWJlKGhvb2tSZXF1ZXN0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnb21uaWNhcmUtb3JkZXItcmV2aWV3JzpcbiAgICAgICAgICByZXNwb25zZSA9IGF3YWl0IGNkc0hvb2tzU2VydmljZS5leGVjdXRlT3JkZXJSZXZpZXcoaG9va1JlcXVlc3QpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICAgIGVycm9yOiBgQ0RTIHNlcnZpY2UgJHtzZXJ2aWNlSWR9IG5vdCBmb3VuZGAsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbihyZXNwb25zZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGV4ZWN1dGUgQ0RTIGhvb2s6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBleGVjdXRlIENEUyBob29rJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gU1VCU0NSSVBUSU9OIE9QRVJBVElPTlNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBHRVQgL2ZoaXIvUjQvU3Vic2NyaXB0aW9uIC0gTGlzdCBzdWJzY3JpcHRpb25zXG4gICAqL1xuICBhc3luYyBsaXN0U3Vic2NyaXB0aW9ucyhyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmZoaXIoJ0xpc3Rpbmcgc3Vic2NyaXB0aW9ucycsIHtcbiAgICAgICAgdXNlcklkOiByZXEudXNlcj8uaWQsXG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc3Vic2NyaXB0aW9ucyA9IHN1YnNjcmlwdGlvbnNTZXJ2aWNlLmxpc3RBY3RpdmVTdWJzY3JpcHRpb25zKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGJ1bmRsZSA9IHtcbiAgICAgICAgcmVzb3VyY2VUeXBlOiAnQnVuZGxlJyxcbiAgICAgICAgdHlwZTogJ3NlYXJjaHNldCcsXG4gICAgICAgIHRvdGFsOiBzdWJzY3JpcHRpb25zLmxlbmd0aCxcbiAgICAgICAgZW50cnk6IHN1YnNjcmlwdGlvbnMubWFwKHN1YiA9PiAoe1xuICAgICAgICAgIHJlc291cmNlOiB7XG4gICAgICAgICAgICByZXNvdXJjZVR5cGU6ICdTdWJzY3JpcHRpb24nLFxuICAgICAgICAgICAgaWQ6IHN1Yi5pZCxcbiAgICAgICAgICAgIHN0YXR1czogc3ViLnN0YXR1cyxcbiAgICAgICAgICAgIGNyaXRlcmlhOiBzdWIuY3JpdGVyaWEsXG4gICAgICAgICAgICBjaGFubmVsOiBzdWIuY2hhbm5lbCxcbiAgICAgICAgICAgIHJlYXNvbjogJ09tbmlDYXJlIEVNUiBTdWJzY3JpcHRpb24nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pKSxcbiAgICAgIH07XG5cbiAgICAgIHJlcy5qc29uKGJ1bmRsZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGxpc3Qgc3Vic2NyaXB0aW9uczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHJlc291cmNlVHlwZTogJ09wZXJhdGlvbk91dGNvbWUnLFxuICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICBjb2RlOiAnZXhjZXB0aW9uJyxcbiAgICAgICAgICBkaWFnbm9zdGljczogJ0ZhaWxlZCB0byBsaXN0IHN1YnNjcmlwdGlvbnMnLFxuICAgICAgICB9XSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gSEVBTFRIIENIRUNLXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogR0VUIC9oZWFsdGggLSBIZWFsdGggY2hlY2sgZW5kcG9pbnRcbiAgICovXG4gIGFzeW5jIGhlYWx0aENoZWNrKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBbbWVkcGx1bUhlYWx0aCwgY2RzSGVhbHRoLCBzdWJzY3JpcHRpb25zSGVhbHRoXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgbWVkcGx1bVNlcnZpY2UuZ2V0SGVhbHRoU3RhdHVzKCksXG4gICAgICAgIGNkc0hvb2tzU2VydmljZS5nZXRIZWFsdGhTdGF0dXMoKSxcbiAgICAgICAgc3Vic2NyaXB0aW9uc1NlcnZpY2UuZ2V0SGVhbHRoU3RhdHVzKCksXG4gICAgICBdKTtcblxuICAgICAgY29uc3Qgb3ZlcmFsbFN0YXR1cyA9IFttZWRwbHVtSGVhbHRoLCBjZHNIZWFsdGgsIHN1YnNjcmlwdGlvbnNIZWFsdGhdXG4gICAgICAgIC5ldmVyeShoZWFsdGggPT4gaGVhbHRoLnN0YXR1cyA9PT0gJ1VQJykgPyAnVVAnIDogJ0RPV04nO1xuXG4gICAgICBjb25zdCBoZWFsdGhTdGF0dXMgPSB7XG4gICAgICAgIHN0YXR1czogb3ZlcmFsbFN0YXR1cyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGNvbXBvbmVudHM6IHtcbiAgICAgICAgICBtZWRwbHVtOiBtZWRwbHVtSGVhbHRoLFxuICAgICAgICAgIGNkc0hvb2tzOiBjZHNIZWFsdGgsXG4gICAgICAgICAgc3Vic2NyaXB0aW9uczogc3Vic2NyaXB0aW9uc0hlYWx0aCxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIHJlcy5zdGF0dXMob3ZlcmFsbFN0YXR1cyA9PT0gJ1VQJyA/IDIwMCA6IDUwMykuanNvbihoZWFsdGhTdGF0dXMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0hlYWx0aCBjaGVjayBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDMpLmpzb24oe1xuICAgICAgICBzdGF0dXM6ICdET1dOJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGVycm9yOiAnSGVhbHRoIGNoZWNrIGZhaWxlZCcsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IGZoaXJDb250cm9sbGVyID0gbmV3IEZISVJDb250cm9sbGVyKCk7Il0sInZlcnNpb24iOjN9