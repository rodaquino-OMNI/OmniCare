c6aea29f11c638c4e5ddfa0be1b491a7
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const hl7v2_parser_service_1 = require("../../src/services/integration/hl7v2/hl7v2-parser.service");
const fhir_resources_service_1 = require("../../src/services/fhir-resources.service");
const medplum_service_1 = require("../../src/services/medplum.service");
const hl7v2_types_1 = require("../../src/services/integration/types/hl7v2.types");
const logger_1 = __importDefault(require("../../src/utils/logger"));
/**
 * HL7 Message Processing Integration Tests
 * Tests end-to-end HL7 v2 message parsing, validation, and FHIR transformation
 */
describe('HL7 Message Processing Integration', () => {
    let testPatientId;
    beforeAll(async () => {
        await medplum_service_1.medplumService.initialize();
    });
    describe('HL7 v2 Message Parsing', () => {
        test('should parse ADT^A01 (Patient Admission) message', () => {
            const hl7Message = `MSH|^~\\&|SENDING_APP|SENDING_FACILITY|RECEIVING_APP|RECEIVING_FACILITY|20240101120000||ADT^A01^ADT_A01|MSG001|P|2.5.1
EVN||202401011200|||^SMITH^JOHN^J^^^DR
PID|1||123456789^^^MRN^MR||DOE^JOHN^MIDDLE^^JR|MAIDEN|19900101|M||2106-3|123 MAIN ST^^ANYTOWN^ST^12345^USA||(555)555-1234|(555)555-5678|EN|M|CHR|123456789|||N|USA||||||||||20240101
NK1|1|DOE^JANE^|SPO|123 MAIN ST^^ANYTOWN^ST^12345^USA|(555)555-1234
PV1|1|I|2000^2012^01||||1234567^ATTENDING^DOCTOR|||SUR||||A|||1234567^ATTENDING^DOCTOR|INP|^^^VISIT001||||||||||||||||||||||||202401011200`;
            const parsedMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(hl7Message);
            expect(parsedMessage.messageType).toBe('ADT');
            expect(parsedMessage.triggerEvent).toBe('A01');
            expect(parsedMessage.messageControlId).toBe('MSG001');
            expect(parsedMessage.sendingApplication).toBe('SENDING_APP');
            expect(parsedMessage.receivingApplication).toBe('RECEIVING_APP');
            expect(parsedMessage.segments.length).toBeGreaterThan(0);
            // Verify MSH segment
            const mshSegment = parsedMessage.segments.find(s => s.segmentType === 'MSH');
            expect(mshSegment).toBeDefined();
            // Verify PID segment
            const pidSegment = parsedMessage.segments.find(s => s.segmentType === 'PID');
            expect(pidSegment).toBeDefined();
            expect(pidSegment?.fields.length).toBeGreaterThan(0);
            // Verify PV1 segment
            const pv1Segment = parsedMessage.segments.find(s => s.segmentType === 'PV1');
            expect(pv1Segment).toBeDefined();
        });
        test('should parse ORU^R01 (Observation Result) message', () => {
            const hl7Message = `MSH|^~\\&|LAB_SYSTEM|LAB_FACILITY|EMR_SYSTEM|HOSPITAL|20240101130000||ORU^R01^ORU_R01|LAB001|P|2.5.1
PID|1||123456789^^^MRN^MR||DOE^JOHN^MIDDLE^^JR||19900101|M
OBR|1|ORDER001|RESULT001|CBC^COMPLETE BLOOD COUNT^LN|||20240101120000|20240101125000||||||||||1234567^ORDERING^DOCTOR||||||20240101130000||F|||
OBX|1|NM|4544-3^HEMATOCRIT^LN||42.0|%|40.0-50.0|N|||F|||20240101125000
OBX|2|NM|718-7^HEMOGLOBIN^LN||14.2|g/dL|12.0-16.0|N|||F|||20240101125000
OBX|3|NM|4515-3^LEUKOCYTES^LN||7.5|K/uL|4.0-11.0|N|||F|||20240101125000`;
            const parsedMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(hl7Message);
            expect(parsedMessage.messageType).toBe('ORU');
            expect(parsedMessage.triggerEvent).toBe('R01');
            expect(parsedMessage.sendingApplication).toBe('LAB_SYSTEM');
            // Verify OBR segment
            const obrSegment = parsedMessage.segments.find(s => s.segmentType === 'OBR');
            expect(obrSegment).toBeDefined();
            // Verify OBX segments
            const obxSegments = parsedMessage.segments.filter(s => s.segmentType === 'OBX');
            expect(obxSegments.length).toBe(3);
        });
        test('should parse SIU^S12 (Appointment Scheduling) message', () => {
            const hl7Message = `MSH|^~\\&|SCHEDULING|CLINIC|EMR|HOSPITAL|20240101140000||SIU^S12^SIU_S12|SCH001|P|2.5.1
SCH|SCHEDULED|||20240102090000|20240102100000|||||30^MINUTES|^SCHEDULED||||||ROUTINE|
PID|1||123456789^^^MRN^MR||DOE^JOHN^MIDDLE^^JR||19900101|M
RGS|1
AIS|1||OFFICE^OFFICE VISIT|||20240102090000|30^MINUTES|||SCHEDULED|`;
            const parsedMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(hl7Message);
            expect(parsedMessage.messageType).toBe('SIU');
            expect(parsedMessage.triggerEvent).toBe('S12');
            const schSegment = parsedMessage.segments.find(s => s.segmentType === 'SCH');
            expect(schSegment).toBeDefined();
        });
    });
    describe('HL7 Message Validation', () => {
        test('should validate message structure', () => {
            const validMessage = `MSH|^~\\&|APP|FACILITY|REC|HOSPITAL|20240101120000||ADT^A01|MSG001|P|2.5.1
PID|1||123456789|||DOE^JOHN|||M|`;
            const parsedMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(validMessage);
            const validationResult = hl7v2_parser_service_1.hl7v2ParserService.validateMessage(parsedMessage);
            expect(validationResult.valid).toBe(true);
            expect(validationResult.errors.length).toBe(0);
        });
        test('should detect validation errors', () => {
            // Message without required MSH segment
            const invalidMessage = {
                messageType: '',
                triggerEvent: '',
                messageStructure: '',
                messageControlId: '',
                sendingApplication: '',
                sendingFacility: '',
                receivingApplication: '',
                receivingFacility: '',
                timestamp: new Date(),
                processingId: '',
                versionId: '',
                segments: [], // Empty segments - should fail validation
                rawMessage: ''
            };
            const validationResult = hl7v2_parser_service_1.hl7v2ParserService.validateMessage(invalidMessage);
            expect(validationResult.valid).toBe(false);
            expect(validationResult.errors.length).toBeGreaterThan(0);
        });
        test('should validate data types', () => {
            const messageWithInvalidDate = `MSH|^~\\&|APP|FACILITY|REC|HOSPITAL|INVALID_DATE||ADT^A01|MSG001|P|2.5.1
PID|1||123456789|||DOE^JOHN|||M|`;
            try {
                const parsedMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(messageWithInvalidDate);
                expect(parsedMessage).toBeDefined();
                // Parser should handle invalid dates gracefully
            }
            catch (error) {
                expect(error.message).toContain('parsing failed');
            }
        });
    });
    describe('HL7 to FHIR Transformation', () => {
        test('should transform ADT^A01 message to FHIR Patient resource', async () => {
            const adtMessage = `MSH|^~\\&|EMR|HOSPITAL|FHIR|SYSTEM|20240101120000||ADT^A01|MSG001|P|2.5.1
PID|1||MRN123456789^^^MRN^MR||DOE^JOHN^MIDDLE^^JR||19900101|M||2106-3|123 MAIN ST^^ANYTOWN^ST^12345^USA||(555)555-1234|(555)555-5678|EN|M|CHR|`;
            const parsedMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(adtMessage);
            const pidSegment = parsedMessage.segments.find(s => s.segmentType === 'PID');
            expect(pidSegment).toBeDefined();
            // Transform PID segment data to FHIR Patient
            const patientData = {
                name: [{ given: ['JOHN', 'MIDDLE'], family: 'DOE', suffix: ['JR'] }],
                gender: 'male',
                birthDate: '1990-01-01',
                identifier: [{
                        system: 'http://hospital.org/mrn',
                        value: 'MRN123456789'
                    }],
                telecom: [
                    { system: 'phone', value: '(555)555-1234', use: 'home' },
                    { system: 'phone', value: '(555)555-5678', use: 'work' }
                ],
                address: [{
                        use: 'home',
                        line: ['123 MAIN ST'],
                        city: 'ANYTOWN',
                        state: 'ST',
                        postalCode: '12345',
                        country: 'USA'
                    }]
            };
            const fhirPatient = await fhir_resources_service_1.fhirResourcesService.createPatient(patientData);
            expect(fhirPatient.id).toBeDefined();
            expect(fhirPatient.resourceType).toBe('Patient');
            testPatientId = fhirPatient.id;
        });
        test('should transform ORU^R01 message to FHIR Observation resources', async () => {
            const oruMessage = `MSH|^~\\&|LAB|HOSPITAL|FHIR|SYSTEM|20240101130000||ORU^R01|LAB001|P|2.5.1
PID|1||${testPatientId}|||DOE^JOHN|||M|
OBR|1|ORDER001|RESULT001|CBC^COMPLETE BLOOD COUNT|||20240101120000||||||||1234567^DOCTOR^ORDERING||||||20240101130000||F
OBX|1|NM|718-7^HEMOGLOBIN^LN||14.2|g/dL|12.0-16.0|N|||F|||20240101125000`;
            const parsedMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(oruMessage);
            const obxSegments = parsedMessage.segments.filter(s => s.segmentType === 'OBX');
            expect(obxSegments.length).toBe(1);
            // Transform OBX segment to FHIR Observation
            const observationData = {
                status: 'final',
                category: [{
                        coding: [{
                                system: 'http://terminology.hl7.org/CodeSystem/observation-category',
                                code: 'laboratory',
                                display: 'Laboratory'
                            }]
                    }],
                code: {
                    coding: [{
                            system: 'http://loinc.org',
                            code: '718-7',
                            display: 'Hemoglobin'
                        }]
                },
                subject: { reference: `Patient/${testPatientId}` },
                valueQuantity: {
                    value: 14.2,
                    unit: 'g/dL',
                    system: 'http://unitsofmeasure.org',
                    code: 'g/dL'
                },
                referenceRange: [{
                        low: { value: 12.0, unit: 'g/dL' },
                        high: { value: 16.0, unit: 'g/dL' }
                    }]
            };
            const fhirObservation = await fhir_resources_service_1.fhirResourcesService.createObservation(observationData);
            expect(fhirObservation.id).toBeDefined();
            expect(fhirObservation.resourceType).toBe('Observation');
        });
    });
    describe('HL7 Acknowledgment Processing', () => {
        test('should generate ACK for successful message processing', () => {
            const originalMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(`MSH|^~\\&|APP|FACILITY|REC|HOSPITAL|20240101120000||ADT^A01|MSG001|P|2.5.1`);
            const ack = hl7v2_parser_service_1.hl7v2ParserService.generateAcknowledgment(originalMessage, hl7v2_types_1.HL7v2AckCode.APPLICATION_ACCEPT, 'Message processed successfully');
            expect(ack.messageType).toBe('ACK');
            expect(ack.messageControlId).toBe('MSG001');
            expect(ack.acknowledgmentCode).toBe(hl7v2_types_1.HL7v2AckCode.APPLICATION_ACCEPT);
            expect(ack.textMessage).toBe('Message processed successfully');
        });
        test('should generate NACK for failed message processing', () => {
            const originalMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(`MSH|^~\\&|APP|FACILITY|REC|HOSPITAL|20240101120000||ADT^A01|MSG002|P|2.5.1`);
            const ack = hl7v2_parser_service_1.hl7v2ParserService.generateAcknowledgment(originalMessage, hl7v2_types_1.HL7v2AckCode.APPLICATION_ERROR, 'Validation failed', {
                errorCode: 'VAL001',
                errorDescription: 'Required field missing in PID segment'
            });
            expect(ack.acknowledgmentCode).toBe(hl7v2_types_1.HL7v2AckCode.APPLICATION_ERROR);
            expect(ack.errorCondition).toBeDefined();
            expect(ack.errorCondition?.errorCode).toBe('VAL001');
        });
        test('should convert acknowledgment to HL7 string format', () => {
            const originalMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(`MSH|^~\\&|APP|FACILITY|REC|HOSPITAL|20240101120000||ADT^A01|MSG003|P|2.5.1`);
            const ack = hl7v2_parser_service_1.hl7v2ParserService.generateAcknowledgment(originalMessage, hl7v2_types_1.HL7v2AckCode.APPLICATION_ACCEPT);
            const ackString = hl7v2_parser_service_1.hl7v2ParserService.acknowledgeToString(ack, 'OMNICARE', 'HOSPITAL', 'APP', 'FACILITY');
            expect(ackString).toContain('MSH|^~\\&|OMNICARE|HOSPITAL|APP|FACILITY');
            expect(ackString).toContain('ACK|MSG003');
            expect(ackString).toContain(`MSA|${hl7v2_types_1.HL7v2AckCode.APPLICATION_ACCEPT}|MSG003`);
        });
    });
    describe('HL7 Error Handling', () => {
        test('should handle malformed HL7 messages', () => {
            const malformedMessage = 'This is not a valid HL7 message';
            expect(() => {
                hl7v2_parser_service_1.hl7v2ParserService.parseMessage(malformedMessage);
            }).toThrow();
        });
        test('should handle messages with missing required segments', () => {
            const messageWithoutMSH = 'PID|1||123456789|||DOE^JOHN|||M|';
            expect(() => {
                hl7v2_parser_service_1.hl7v2ParserService.parseMessage(messageWithoutMSH);
            }).toThrow('First segment must be MSH');
        });
        test('should handle unsupported message types gracefully', () => {
            const unsupportedMessage = `MSH|^~\\&|APP|FACILITY|REC|HOSPITAL|20240101120000||XXX^Y99|MSG001|P|2.5.1`;
            const parsedMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(unsupportedMessage);
            expect(parsedMessage.messageType).toBe('XXX');
            expect(parsedMessage.triggerEvent).toBe('Y99');
            // Should still parse but validation might flag it
            const validationResult = hl7v2_parser_service_1.hl7v2ParserService.validateMessage(parsedMessage);
            expect(validationResult).toBeDefined();
        });
    });
    describe('HL7 Performance Testing', () => {
        test('should handle large HL7 messages efficiently', () => {
            // Create a large HL7 message with many OBX segments
            let largeMessage = `MSH|^~\\&|LAB|HOSPITAL|FHIR|SYSTEM|20240101130000||ORU^R01|LAB001|P|2.5.1
PID|1||123456789|||DOE^JOHN|||M|
OBR|1|ORDER001|RESULT001|CBC^COMPLETE BLOOD COUNT|||20240101120000||||||||1234567^DOCTOR||||||20240101130000||F`;
            // Add 100 OBX segments
            for (let i = 1; i <= 100; i++) {
                largeMessage += `\nOBX|${i}|NM|${1000 + i}-7^TEST${i}^LN||${(Math.random() * 100).toFixed(1)}|mg/dL|0.0-100.0|N|||F|||20240101125000`;
            }
            const startTime = Date.now();
            const parsedMessage = hl7v2_parser_service_1.hl7v2ParserService.parseMessage(largeMessage);
            const endTime = Date.now();
            expect(parsedMessage.segments.length).toBeGreaterThan(100);
            expect(endTime - startTime).toBeLessThan(1000); // Should parse within 1 second
        });
        test('should handle concurrent HL7 message parsing', async () => {
            const messages = Array(10).fill(0).map((_, i) => `MSH|^~\\&|APP${i}|FACILITY|REC|HOSPITAL|20240101120000||ADT^A01|MSG${i.toString().padStart(3, '0')}|P|2.5.1
PID|1||${i.toString().padStart(9, '0')}|||DOE^PATIENT${i}|||M|`);
            const parsePromises = messages.map(msg => Promise.resolve(hl7v2_parser_service_1.hl7v2ParserService.parseMessage(msg)));
            const results = await Promise.allSettled(parsePromises);
            const successful = results.filter(r => r.status === 'fulfilled');
            expect(successful.length).toBe(10);
        });
    });
    afterAll(async () => {
        // Cleanup test patient if created
        if (testPatientId) {
            try {
                await medplum_service_1.medplumService.deleteResource('Patient', testPatientId);
            }
            catch (error) {
                logger_1.default.warn('Failed to cleanup test patient:', error);
            }
        }
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvdGVzdHMvaW50ZWdyYXRpb24vaGw3LWludGVncmF0aW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxvR0FBK0Y7QUFDL0Ysc0ZBQWlGO0FBQ2pGLHdFQUFvRTtBQUNwRSxrRkFBOEY7QUFDOUYsb0VBQTRDO0FBRTVDOzs7R0FHRztBQUNILFFBQVEsQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7SUFDbEQsSUFBSSxhQUFxQixDQUFDO0lBRTFCLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixNQUFNLGdDQUFjLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFO1FBQ3RDLElBQUksQ0FBQyxrREFBa0QsRUFBRSxHQUFHLEVBQUU7WUFDNUQsTUFBTSxVQUFVLEdBQUc7Ozs7MklBSWtILENBQUM7WUFFdEksTUFBTSxhQUFhLEdBQUcseUNBQWtCLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRWxFLE1BQU0sQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQy9DLE1BQU0sQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDdEQsTUFBTSxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUM3RCxNQUFNLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBQ2pFLE1BQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVB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QUUsQ0FDdkMsT0FBTyxDQUFDLE9BQU8sQ0FBQyx5Q0FBa0IsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FDdEQsQ0FBQztZQUVGLE1BQU0sT0FBTyxHQUFHLE1BQU0sT0FBTyxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUN4RCxNQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxXQUFXLENBQUMsQ0FBQztZQUVqRSxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNyQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ2xCLGtDQUFrQztRQUNsQyxJQUFJLGFBQWEsRUFBRSxDQUFDO1lBQ2xCLElBQUksQ0FBQztnQkFDSCxNQUFNLGdDQUFjLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsQ0FBQztZQUNoRSxDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZixnQkFBTSxDQUFDLElBQUksQ0FBQyxpQ0FBaUMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN4RCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvdGVzdHMvaW50ZWdyYXRpb24vaGw3LWludGVncmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaGw3djJQYXJzZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL2ludGVncmF0aW9uL2hsN3YyL2hsN3YyLXBhcnNlci5zZXJ2aWNlJztcbmltcG9ydCB7IGZoaXJSZXNvdXJjZXNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL2ZoaXItcmVzb3VyY2VzLnNlcnZpY2UnO1xuaW1wb3J0IHsgbWVkcGx1bVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zcmMvc2VydmljZXMvbWVkcGx1bS5zZXJ2aWNlJztcbmltcG9ydCB7IEhMN3YyTWVzc2FnZSwgSEw3djJBY2tDb2RlIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL2ludGVncmF0aW9uL3R5cGVzL2hsN3YyLnR5cGVzJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi4vLi4vc3JjL3V0aWxzL2xvZ2dlcic7XG5cbi8qKlxuICogSEw3IE1lc3NhZ2UgUHJvY2Vzc2luZyBJbnRlZ3JhdGlvbiBUZXN0c1xuICogVGVzdHMgZW5kLXRvLWVuZCBITDcgdjIgbWVzc2FnZSBwYXJzaW5nLCB2YWxpZGF0aW9uLCBhbmQgRkhJUiB0cmFuc2Zvcm1hdGlvblxuICovXG5kZXNjcmliZSgnSEw3IE1lc3NhZ2UgUHJvY2Vzc2luZyBJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgbGV0IHRlc3RQYXRpZW50SWQ6IHN0cmluZztcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IG1lZHBsdW1TZXJ2aWNlLmluaXRpYWxpemUoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0hMNyB2MiBNZXNzYWdlIFBhcnNpbmcnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHBhcnNlIEFEVF5BMDEgKFBhdGllbnQgQWRtaXNzaW9uKSBtZXNzYWdlJywgKCkgPT4ge1xuICAgICAgY29uc3QgaGw3TWVzc2FnZSA9IGBNU0h8Xn5cXFxcJnxTRU5ESU5HX0FQUHxTRU5ESU5HX0ZBQ0lMSVRZfFJFQ0VJVklOR19BUFB8UkVDRUlWSU5HX0ZBQ0lMSVRZfDIwMjQwMTAxMTIwMDAwfHxBRFReQTAxXkFEVF9BMDF8TVNHMDAxfFB8Mi41LjFcbkVWTnx8MjAyNDAxMDExMjAwfHx8XlNNSVRIXkpPSE5eSl5eXkRSXG5QSUR8MXx8MTIzNDU2Nzg5Xl5eTVJOXk1SfHxET0VeSk9ITl5NSURETEVeXkpSfE1BSURFTnwxOTkwMDEwMXxNfHwyMTA2LTN8MTIzIE1BSU4gU1ReXkFOWVRPV05eU1ReMTIzNDVeVVNBfHwoNTU1KTU1NS0xMjM0fCg1NTUpNTU1LTU2Nzh8RU58TXxDSFJ8MTIzNDU2Nzg5fHx8TnxVU0F8fHx8fHx8fHx8MjAyNDAxMDFcbk5LMXwxfERPRV5KQU5FXnxTUE98MTIzIE1BSU4gU1ReXkFOWVRPV05eU1ReMTIzNDVeVVNBfCg1NTUpNTU1LTEyMzRcblBWMXwxfEl8MjAwMF4yMDEyXjAxfHx8fDEyMzQ1NjdeQVRURU5ESU5HXkRPQ1RPUnx8fFNVUnx8fHxBfHx8MTIzNDU2N15BVFRFTkRJTkdeRE9DVE9SfElOUHxeXl5WSVNJVDAwMXx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fDIwMjQwMTAxMTIwMGA7XG5cbiAgICAgIGNvbnN0IHBhcnNlZE1lc3NhZ2UgPSBobDd2MlBhcnNlclNlcnZpY2UucGFyc2VNZXNzYWdlKGhsN01lc3NhZ2UpO1xuXG4gICAgICBleHBlY3QocGFyc2VkTWVzc2FnZS5tZXNzYWdlVHlwZSkudG9CZSgnQURUJyk7XG4gICAgICBleHBlY3QocGFyc2VkTWVzc2FnZS50cmlnZ2VyRXZlbnQpLnRvQmUoJ0EwMScpO1xuICAgICAgZXhwZWN0KHBhcnNlZE1lc3NhZ2UubWVzc2FnZUNvbnRyb2xJZCkudG9CZSgnTVNHMDAxJyk7XG4gICAgICBleHBlY3QocGFyc2VkTWVzc2FnZS5zZW5kaW5nQXBwbGljYXRpb24pLnRvQmUoJ1NFTkRJTkdfQVBQJyk7XG4gICAgICBleHBlY3QocGFyc2VkTWVzc2FnZS5yZWNlaXZpbmdBcHBsaWNhdGlvbikudG9CZSgnUkVDRUlWSU5HX0FQUCcpO1xuICAgICAgZXhwZWN0KHBhcnNlZE1lc3NhZ2Uuc2VnbWVudHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG5cbiAgICAgIC8vIFZlcmlmeSBNU0ggc2VnbWVudFxuICAgICAgY29uc3QgbXNoU2VnbWVudCA9IHBhcnNlZE1lc3NhZ2Uuc2VnbWVudHMuZmluZChzID0+IHMuc2VnbWVudFR5cGUgPT09ICdNU0gnKTtcbiAgICAgIGV4cGVjdChtc2hTZWdtZW50KS50b0JlRGVmaW5lZCgpO1xuXG4gICAgICAvLyBWZXJpZnkgUElEIHNlZ21lbnRcbiAgICAgIGNvbnN0IHBpZFNlZ21lbnQgPSBwYXJzZWRNZXNzYWdlLnNlZ21lbnRzLmZpbmQocyA9PiBzLnNlZ21lbnRUeXBlID09PSAnUElEJyk7XG4gICAgICBleHBlY3QocGlkU2VnbWVudCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChwaWRTZWdtZW50Py5maWVsZHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG5cbiAgICAgIC8vIFZlcmlmeSBQVjEgc2VnbWVudFxuICAgICAgY29uc3QgcHYxU2VnbWVudCA9IHBhcnNlZE1lc3NhZ2Uuc2VnbWVudHMuZmluZChzID0+IHMuc2VnbWVudFR5cGUgPT09ICdQVjEnKTtcbiAgICAgIGV4cGVjdChwdjFTZWdtZW50KS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHBhcnNlIE9SVV5SMDEgKE9ic2VydmF0aW9uIFJlc3VsdCkgbWVzc2FnZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGhsN01lc3NhZ2UgPSBgTVNIfF5+XFxcXCZ8TEFCX1NZU1RFTXxMQUJfRkFDSUxJVFl8RU1SX1NZU1RFTXxIT1NQSVRBTHwyMDI0MDEwMTEzMDAwMHx8T1JVXlIwMV5PUlVfUjAxfExBQjAwMXxQfDIuNS4xXG5QSUR8MXx8MTIzNDU2Nzg5Xl5eTVJOXk1SfHxET0VeSk9ITl5NSURETEVeXkpSfHwxOTkwMDEwMXxNXG5PQlJ8MXxPUkRFUjAwMXxSRVNVTFQwMDF8Q0JDXkNPTVBMRVRFIEJMT09EIENPVU5UXkxOfHx8MjAyNDAxMDExMjAwMDB8MjAyNDAxMDExMjUwMDB8fHx8fHx8fHx8MTIzNDU2N15PUkRFUklOR15ET0NUT1J8fHx8fHwyMDI0MDEwMTEzMDAwMHx8Rnx8fFxuT0JYfDF8Tk18NDU0NC0zXkhFTUFUT0NSSVReTE58fDQyLjB8JXw0MC4wLTUwLjB8Tnx8fEZ8fHwyMDI0MDEwMTEyNTAwMFxuT0JYfDJ8Tk18NzE4LTdeSEVNT0dMT0JJTl5MTnx8MTQuMnxnL2RMfDEyLjAtMTYuMHxOfHx8Rnx8fDIwMjQwMTAxMTI1MDAwXG5PQlh8M3xOTXw0NTE1LTNeTEVVS09DWVRFU15MTnx8Ny41fEsvdUx8NC4wLTExLjB8Tnx8fEZ8fHwyMDI0MDEwMTEyNTAwMGA7XG5cbiAgICAgIGNvbnN0IHBhcnNlZE1lc3NhZ2UgPSBobDd2MlBhcnNlclNlcnZpY2UucGFyc2VNZXNzYWdlKGhsN01lc3NhZ2UpO1xuXG4gICAgICBleHBlY3QocGFyc2VkTWVzc2FnZS5tZXNzYWdlVHlwZSkudG9CZSgnT1JVJyk7XG4gICAgICBleHBlY3QocGFyc2VkTWVzc2FnZS50cmlnZ2VyRXZlbnQpLnRvQmUoJ1IwMScpO1xuICAgICAgZXhwZWN0KHBhcnNlZE1lc3NhZ2Uuc2VuZGluZ0FwcGxpY2F0aW9uKS50b0JlKCdMQUJfU1lTVEVNJyk7XG5cbiAgICAgIC8vIFZlcmlmeSBPQlIgc2VnbWVudFxuICAgICAgY29uc3Qgb2JyU2VnbWVudCA9IHBhcnNlZE1lc3NhZ2Uuc2VnbWVudHMuZmluZChzID0+IHMuc2VnbWVudFR5cGUgPT09ICdPQlInKTtcbiAgICAgIGV4cGVjdChvYnJTZWdtZW50KS50b0JlRGVmaW5lZCgpO1xuXG4gICAgICAvLyBWZXJpZnkgT0JYIHNlZ21lbnRzXG4gICAgICBjb25zdCBvYnhTZWdtZW50cyA9IHBhcnNlZE1lc3NhZ2Uuc2VnbWVudHMuZmlsdGVyKHMgPT4gcy5zZWdtZW50VHlwZSA9PT0gJ09CWCcpO1xuICAgICAgZXhwZWN0KG9ieFNlZ21lbnRzLmxlbmd0aCkudG9CZSgzKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBwYXJzZSBTSVVeUzEyIChBcHBvaW50bWVudCBTY2hlZHVsaW5nKSBtZXNzYWdlJywgKCkgPT4ge1xuICAgICAgY29uc3QgaGw3TWVzc2FnZSA9IGBNU0h8Xn5cXFxcJnxTQ0hFRFVMSU5HfENMSU5JQ3xFTVJ8SE9TUElUQUx8MjAyNDAxMDExNDAwMDB8fFNJVV5TMTJeU0lVX1MxMnxTQ0gwMDF8UHwyLjUuMVxuU0NIfFNDSEVEVUxFRHx8fDIwMjQwMTAyMDkwMDAwfDIwMjQwMTAyMTAwMDAwfHx8fHwzMF5NSU5VVEVTfF5TQ0hFRFVMRUR8fHx8fHxST1VUSU5FfFxuUElEfDF8fDEyMzQ1Njc4OV5eXk1STl5NUnx8RE9FXkpPSE5eTUlERExFXl5KUnx8MTk5MDAxMDF8TVxuUkdTfDFcbkFJU3wxfHxPRkZJQ0VeT0ZGSUNFIFZJU0lUfHx8MjAyNDAxMDIwOTAwMDB8MzBeTUlOVVRFU3x8fFNDSEVEVUxFRHxgO1xuXG4gICAgICBjb25zdCBwYXJzZWRNZXNzYWdlID0gaGw3djJQYXJzZXJTZXJ2aWNlLnBhcnNlTWVzc2FnZShobDdNZXNzYWdlKTtcblxuICAgICAgZXhwZWN0KHBhcnNlZE1lc3NhZ2UubWVzc2FnZVR5cGUpLnRvQmUoJ1NJVScpO1xuICAgICAgZXhwZWN0KHBhcnNlZE1lc3NhZ2UudHJpZ2dlckV2ZW50KS50b0JlKCdTMTInKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc2NoU2VnbWVudCA9IHBhcnNlZE1lc3NhZ2Uuc2VnbWVudHMuZmluZChzID0+IHMuc2VnbWVudFR5cGUgPT09ICdTQ0gnKTtcbiAgICAgIGV4cGVjdChzY2hTZWdtZW50KS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSEw3IE1lc3NhZ2UgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgbWVzc2FnZSBzdHJ1Y3R1cmUnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZE1lc3NhZ2UgPSBgTVNIfF5+XFxcXCZ8QVBQfEZBQ0lMSVRZfFJFQ3xIT1NQSVRBTHwyMDI0MDEwMTEyMDAwMHx8QURUXkEwMXxNU0cwMDF8UHwyLjUuMVxuUElEfDF8fDEyMzQ1Njc4OXx8fERPRV5KT0hOfHx8TXxgO1xuXG4gICAgICBjb25zdCBwYXJzZWRNZXNzYWdlID0gaGw3djJQYXJzZXJTZXJ2aWNlLnBhcnNlTWVzc2FnZSh2YWxpZE1lc3NhZ2UpO1xuICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdCA9IGhsN3YyUGFyc2VyU2VydmljZS52YWxpZGF0ZU1lc3NhZ2UocGFyc2VkTWVzc2FnZSk7XG5cbiAgICAgIGV4cGVjdCh2YWxpZGF0aW9uUmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBkZXRlY3QgdmFsaWRhdGlvbiBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICAvLyBNZXNzYWdlIHdpdGhvdXQgcmVxdWlyZWQgTVNIIHNlZ21lbnRcbiAgICAgIGNvbnN0IGludmFsaWRNZXNzYWdlOiBITDd2Mk1lc3NhZ2UgPSB7XG4gICAgICAgIG1lc3NhZ2VUeXBlOiAnJyxcbiAgICAgICAgdHJpZ2dlckV2ZW50OiAnJyxcbiAgICAgICAgbWVzc2FnZVN0cnVjdHVyZTogJycsXG4gICAgICAgIG1lc3NhZ2VDb250cm9sSWQ6ICcnLFxuICAgICAgICBzZW5kaW5nQXBwbGljYXRpb246ICcnLFxuICAgICAgICBzZW5kaW5nRmFjaWxpdHk6ICcnLFxuICAgICAgICByZWNlaXZpbmdBcHBsaWNhdGlvbjogJycsXG4gICAgICAgIHJlY2VpdmluZ0ZhY2lsaXR5OiAnJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBwcm9jZXNzaW5nSWQ6ICcnLFxuICAgICAgICB2ZXJzaW9uSWQ6ICcnLFxuICAgICAgICBzZWdtZW50czogW10sIC8vIEVtcHR5IHNlZ21lbnRzIC0gc2hvdWxkIGZhaWwgdmFsaWRhdGlvblxuICAgICAgICByYXdNZXNzYWdlOiAnJ1xuICAgICAgfTtcblxuICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdCA9IGhsN3YyUGFyc2VyU2VydmljZS52YWxpZGF0ZU1lc3NhZ2UoaW52YWxpZE1lc3NhZ2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRpb25SZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHZhbGlkYXRlIGRhdGEgdHlwZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlV2l0aEludmFsaWREYXRlID0gYE1TSHxeflxcXFwmfEFQUHxGQUNJTElUWXxSRUN8SE9TUElUQUx8SU5WQUxJRF9EQVRFfHxBRFReQTAxfE1TRzAwMXxQfDIuNS4xXG5QSUR8MXx8MTIzNDU2Nzg5fHx8RE9FXkpPSE58fHxNfGA7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnNlZE1lc3NhZ2UgPSBobDd2MlBhcnNlclNlcnZpY2UucGFyc2VNZXNzYWdlKG1lc3NhZ2VXaXRoSW52YWxpZERhdGUpO1xuICAgICAgICBleHBlY3QocGFyc2VkTWVzc2FnZSkudG9CZURlZmluZWQoKTtcbiAgICAgICAgLy8gUGFyc2VyIHNob3VsZCBoYW5kbGUgaW52YWxpZCBkYXRlcyBncmFjZWZ1bGx5XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9Db250YWluKCdwYXJzaW5nIGZhaWxlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSEw3IHRvIEZISVIgVHJhbnNmb3JtYXRpb24nLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHRyYW5zZm9ybSBBRFReQTAxIG1lc3NhZ2UgdG8gRkhJUiBQYXRpZW50IHJlc291cmNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWR0TWVzc2FnZSA9IGBNU0h8Xn5cXFxcJnxFTVJ8SE9TUElUQUx8RkhJUnxTWVNURU18MjAyNDAxMDExMjAwMDB8fEFEVF5BMDF8TVNHMDAxfFB8Mi41LjFcblBJRHwxfHxNUk4xMjM0NTY3ODleXl5NUk5eTVJ8fERPRV5KT0hOXk1JRERMRV5eSlJ8fDE5OTAwMTAxfE18fDIxMDYtM3wxMjMgTUFJTiBTVF5eQU5ZVE9XTl5TVF4xMjM0NV5VU0F8fCg1NTUpNTU1LTEyMzR8KDU1NSk1NTUtNTY3OHxFTnxNfENIUnxgO1xuXG4gICAgICBjb25zdCBwYXJzZWRNZXNzYWdlID0gaGw3djJQYXJzZXJTZXJ2aWNlLnBhcnNlTWVzc2FnZShhZHRNZXNzYWdlKTtcbiAgICAgIGNvbnN0IHBpZFNlZ21lbnQgPSBwYXJzZWRNZXNzYWdlLnNlZ21lbnRzLmZpbmQocyA9PiBzLnNlZ21lbnRUeXBlID09PSAnUElEJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChwaWRTZWdtZW50KS50b0JlRGVmaW5lZCgpO1xuXG4gICAgICAvLyBUcmFuc2Zvcm0gUElEIHNlZ21lbnQgZGF0YSB0byBGSElSIFBhdGllbnRcbiAgICAgIGNvbnN0IHBhdGllbnREYXRhID0ge1xuICAgICAgICBuYW1lOiBbeyBnaXZlbjogWydKT0hOJywgJ01JRERMRSddLCBmYW1pbHk6ICdET0UnLCBzdWZmaXg6IFsnSlInXSB9XSxcbiAgICAgICAgZ2VuZGVyOiAnbWFsZScgYXMgY29uc3QsXG4gICAgICAgIGJpcnRoRGF0ZTogJzE5OTAtMDEtMDEnLFxuICAgICAgICBpZGVudGlmaWVyOiBbe1xuICAgICAgICAgIHN5c3RlbTogJ2h0dHA6Ly9ob3NwaXRhbC5vcmcvbXJuJyxcbiAgICAgICAgICB2YWx1ZTogJ01STjEyMzQ1Njc4OSdcbiAgICAgICAgfV0sXG4gICAgICAgIHRlbGVjb206IFtcbiAgICAgICAgICB7IHN5c3RlbTogJ3Bob25lJyBhcyBjb25zdCwgdmFsdWU6ICcoNTU1KTU1NS0xMjM0JywgdXNlOiAnaG9tZScgYXMgY29uc3QgfSxcbiAgICAgICAgICB7IHN5c3RlbTogJ3Bob25lJyBhcyBjb25zdCwgdmFsdWU6ICcoNTU1KTU1NS01Njc4JywgdXNlOiAnd29yaycgYXMgY29uc3QgfVxuICAgICAgICBdLFxuICAgICAgICBhZGRyZXNzOiBbe1xuICAgICAgICAgIHVzZTogJ2hvbWUnLFxuICAgICAgICAgIGxpbmU6IFsnMTIzIE1BSU4gU1QnXSxcbiAgICAgICAgICBjaXR5OiAnQU5ZVE9XTicsXG4gICAgICAgICAgc3RhdGU6ICdTVCcsXG4gICAgICAgICAgcG9zdGFsQ29kZTogJzEyMzQ1JyxcbiAgICAgICAgICBjb3VudHJ5OiAnVVNBJ1xuICAgICAgICB9XVxuICAgICAgfTtcblxuICAgICAgY29uc3QgZmhpclBhdGllbnQgPSBhd2FpdCBmaGlyUmVzb3VyY2VzU2VydmljZS5jcmVhdGVQYXRpZW50KHBhdGllbnREYXRhKTtcbiAgICAgIGV4cGVjdChmaGlyUGF0aWVudC5pZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChmaGlyUGF0aWVudC5yZXNvdXJjZVR5cGUpLnRvQmUoJ1BhdGllbnQnKTtcbiAgICAgIHRlc3RQYXRpZW50SWQgPSBmaGlyUGF0aWVudC5pZCE7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgdHJhbnNmb3JtIE9SVV5SMDEgbWVzc2FnZSB0byBGSElSIE9ic2VydmF0aW9uIHJlc291cmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG9ydU1lc3NhZ2UgPSBgTVNIfF5+XFxcXCZ8TEFCfEhPU1BJVEFMfEZISVJ8U1lTVEVNfDIwMjQwMTAxMTMwMDAwfHxPUlVeUjAxfExBQjAwMXxQfDIuNS4xXG5QSUR8MXx8JHt0ZXN0UGF0aWVudElkfXx8fERPRV5KT0hOfHx8TXxcbk9CUnwxfE9SREVSMDAxfFJFU1VMVDAwMXxDQkNeQ09NUExFVEUgQkxPT0QgQ09VTlR8fHwyMDI0MDEwMTEyMDAwMHx8fHx8fHx8MTIzNDU2N15ET0NUT1JeT1JERVJJTkd8fHx8fHwyMDI0MDEwMTEzMDAwMHx8RlxuT0JYfDF8Tk18NzE4LTdeSEVNT0dMT0JJTl5MTnx8MTQuMnxnL2RMfDEyLjAtMTYuMHxOfHx8Rnx8fDIwMjQwMTAxMTI1MDAwYDtcblxuICAgICAgY29uc3QgcGFyc2VkTWVzc2FnZSA9IGhsN3YyUGFyc2VyU2VydmljZS5wYXJzZU1lc3NhZ2Uob3J1TWVzc2FnZSk7XG4gICAgICBjb25zdCBvYnhTZWdtZW50cyA9IHBhcnNlZE1lc3NhZ2Uuc2VnbWVudHMuZmlsdGVyKHMgPT4gcy5zZWdtZW50VHlwZSA9PT0gJ09CWCcpO1xuICAgICAgXG4gICAgICBleHBlY3Qob2J4U2VnbWVudHMubGVuZ3RoKS50b0JlKDEpO1xuXG4gICAgICAvLyBUcmFuc2Zvcm0gT0JYIHNlZ21lbnQgdG8gRkhJUiBPYnNlcnZhdGlvblxuICAgICAgY29uc3Qgb2JzZXJ2YXRpb25EYXRhID0ge1xuICAgICAgICBzdGF0dXM6ICdmaW5hbCcgYXMgY29uc3QsXG4gICAgICAgIGNhdGVnb3J5OiBbe1xuICAgICAgICAgIGNvZGluZzogW3tcbiAgICAgICAgICAgIHN5c3RlbTogJ2h0dHA6Ly90ZXJtaW5vbG9neS5obDcub3JnL0NvZGVTeXN0ZW0vb2JzZXJ2YXRpb24tY2F0ZWdvcnknLFxuICAgICAgICAgICAgY29kZTogJ2xhYm9yYXRvcnknLFxuICAgICAgICAgICAgZGlzcGxheTogJ0xhYm9yYXRvcnknXG4gICAgICAgICAgfV1cbiAgICAgICAgfV0sXG4gICAgICAgIGNvZGU6IHtcbiAgICAgICAgICBjb2Rpbmc6IFt7XG4gICAgICAgICAgICBzeXN0ZW06ICdodHRwOi8vbG9pbmMub3JnJyxcbiAgICAgICAgICAgIGNvZGU6ICc3MTgtNycsXG4gICAgICAgICAgICBkaXNwbGF5OiAnSGVtb2dsb2JpbidcbiAgICAgICAgICB9XVxuICAgICAgICB9LFxuICAgICAgICBzdWJqZWN0OiB7IHJlZmVyZW5jZTogYFBhdGllbnQvJHt0ZXN0UGF0aWVudElkfWAgfSxcbiAgICAgICAgdmFsdWVRdWFudGl0eToge1xuICAgICAgICAgIHZhbHVlOiAxNC4yLFxuICAgICAgICAgIHVuaXQ6ICdnL2RMJyxcbiAgICAgICAgICBzeXN0ZW06ICdodHRwOi8vdW5pdHNvZm1lYXN1cmUub3JnJyxcbiAgICAgICAgICBjb2RlOiAnZy9kTCdcbiAgICAgICAgfSxcbiAgICAgICAgcmVmZXJlbmNlUmFuZ2U6IFt7XG4gICAgICAgICAgbG93OiB7IHZhbHVlOiAxMi4wLCB1bml0OiAnZy9kTCcgfSxcbiAgICAgICAgICBoaWdoOiB7IHZhbHVlOiAxNi4wLCB1bml0OiAnZy9kTCcgfVxuICAgICAgICB9XVxuICAgICAgfTtcblxuICAgICAgY29uc3QgZmhpck9ic2VydmF0aW9uID0gYXdhaXQgZmhpclJlc291cmNlc1NlcnZpY2UuY3JlYXRlT2JzZXJ2YXRpb24ob2JzZXJ2YXRpb25EYXRhKTtcbiAgICAgIGV4cGVjdChmaGlyT2JzZXJ2YXRpb24uaWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZmhpck9ic2VydmF0aW9uLnJlc291cmNlVHlwZSkudG9CZSgnT2JzZXJ2YXRpb24nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0hMNyBBY2tub3dsZWRnbWVudCBQcm9jZXNzaW5nJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBnZW5lcmF0ZSBBQ0sgZm9yIHN1Y2Nlc3NmdWwgbWVzc2FnZSBwcm9jZXNzaW5nJywgKCkgPT4ge1xuICAgICAgY29uc3Qgb3JpZ2luYWxNZXNzYWdlID0gaGw3djJQYXJzZXJTZXJ2aWNlLnBhcnNlTWVzc2FnZShcbiAgICAgICAgYE1TSHxeflxcXFwmfEFQUHxGQUNJTElUWXxSRUN8SE9TUElUQUx8MjAyNDAxMDExMjAwMDB8fEFEVF5BMDF8TVNHMDAxfFB8Mi41LjFgXG4gICAgICApO1xuXG4gICAgICBjb25zdCBhY2sgPSBobDd2MlBhcnNlclNlcnZpY2UuZ2VuZXJhdGVBY2tub3dsZWRnbWVudChcbiAgICAgICAgb3JpZ2luYWxNZXNzYWdlLFxuICAgICAgICBITDd2MkFja0NvZGUuQVBQTElDQVRJT05fQUNDRVBULFxuICAgICAgICAnTWVzc2FnZSBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5J1xuICAgICAgKTtcblxuICAgICAgZXhwZWN0KGFjay5tZXNzYWdlVHlwZSkudG9CZSgnQUNLJyk7XG4gICAgICBleHBlY3QoYWNrLm1lc3NhZ2VDb250cm9sSWQpLnRvQmUoJ01TRzAwMScpO1xuICAgICAgZXhwZWN0KGFjay5hY2tub3dsZWRnbWVudENvZGUpLnRvQmUoSEw3djJBY2tDb2RlLkFQUExJQ0FUSU9OX0FDQ0VQVCk7XG4gICAgICBleHBlY3QoYWNrLnRleHRNZXNzYWdlKS50b0JlKCdNZXNzYWdlIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHknKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBnZW5lcmF0ZSBOQUNLIGZvciBmYWlsZWQgbWVzc2FnZSBwcm9jZXNzaW5nJywgKCkgPT4ge1xuICAgICAgY29uc3Qgb3JpZ2luYWxNZXNzYWdlID0gaGw3djJQYXJzZXJTZXJ2aWNlLnBhcnNlTWVzc2FnZShcbiAgICAgICAgYE1TSHxeflxcXFwmfEFQUHxGQUNJTElUWXxSRUN8SE9TUElUQUx8MjAyNDAxMDExMjAwMDB8fEFEVF5BMDF8TVNHMDAyfFB8Mi41LjFgXG4gICAgICApO1xuXG4gICAgICBjb25zdCBhY2sgPSBobDd2MlBhcnNlclNlcnZpY2UuZ2VuZXJhdGVBY2tub3dsZWRnbWVudChcbiAgICAgICAgb3JpZ2luYWxNZXNzYWdlLFxuICAgICAgICBITDd2MkFja0NvZGUuQVBQTElDQVRJT05fRVJST1IsXG4gICAgICAgICdWYWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvckNvZGU6ICdWQUwwMDEnLFxuICAgICAgICAgIGVycm9yRGVzY3JpcHRpb246ICdSZXF1aXJlZCBmaWVsZCBtaXNzaW5nIGluIFBJRCBzZWdtZW50J1xuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBleHBlY3QoYWNrLmFja25vd2xlZGdtZW50Q29kZSkudG9CZShITDd2MkFja0NvZGUuQVBQTElDQVRJT05fRVJST1IpO1xuICAgICAgZXhwZWN0KGFjay5lcnJvckNvbmRpdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChhY2suZXJyb3JDb25kaXRpb24/LmVycm9yQ29kZSkudG9CZSgnVkFMMDAxJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgY29udmVydCBhY2tub3dsZWRnbWVudCB0byBITDcgc3RyaW5nIGZvcm1hdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG9yaWdpbmFsTWVzc2FnZSA9IGhsN3YyUGFyc2VyU2VydmljZS5wYXJzZU1lc3NhZ2UoXG4gICAgICAgIGBNU0h8Xn5cXFxcJnxBUFB8RkFDSUxJVFl8UkVDfEhPU1BJVEFMfDIwMjQwMTAxMTIwMDAwfHxBRFReQTAxfE1TRzAwM3xQfDIuNS4xYFxuICAgICAgKTtcblxuICAgICAgY29uc3QgYWNrID0gaGw3djJQYXJzZXJTZXJ2aWNlLmdlbmVyYXRlQWNrbm93bGVkZ21lbnQoXG4gICAgICAgIG9yaWdpbmFsTWVzc2FnZSxcbiAgICAgICAgSEw3djJBY2tDb2RlLkFQUExJQ0FUSU9OX0FDQ0VQVFxuICAgICAgKTtcblxuICAgICAgY29uc3QgYWNrU3RyaW5nID0gaGw3djJQYXJzZXJTZXJ2aWNlLmFja25vd2xlZGdlVG9TdHJpbmcoXG4gICAgICAgIGFjayxcbiAgICAgICAgJ09NTklDQVJFJyxcbiAgICAgICAgJ0hPU1BJVEFMJyxcbiAgICAgICAgJ0FQUCcsXG4gICAgICAgICdGQUNJTElUWSdcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChhY2tTdHJpbmcpLnRvQ29udGFpbignTVNIfF5+XFxcXCZ8T01OSUNBUkV8SE9TUElUQUx8QVBQfEZBQ0lMSVRZJyk7XG4gICAgICBleHBlY3QoYWNrU3RyaW5nKS50b0NvbnRhaW4oJ0FDS3xNU0cwMDMnKTtcbiAgICAgIGV4cGVjdChhY2tTdHJpbmcpLnRvQ29udGFpbihgTVNBfCR7SEw3djJBY2tDb2RlLkFQUExJQ0FUSU9OX0FDQ0VQVH18TVNHMDAzYCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdITDcgRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgSEw3IG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWFsZm9ybWVkTWVzc2FnZSA9ICdUaGlzIGlzIG5vdCBhIHZhbGlkIEhMNyBtZXNzYWdlJztcblxuICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgaGw3djJQYXJzZXJTZXJ2aWNlLnBhcnNlTWVzc2FnZShtYWxmb3JtZWRNZXNzYWdlKTtcbiAgICAgIH0pLnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgbWVzc2FnZXMgd2l0aCBtaXNzaW5nIHJlcXVpcmVkIHNlZ21lbnRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZVdpdGhvdXRNU0ggPSAnUElEfDF8fDEyMzQ1Njc4OXx8fERPRV5KT0hOfHx8TXwnO1xuXG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBobDd2MlBhcnNlclNlcnZpY2UucGFyc2VNZXNzYWdlKG1lc3NhZ2VXaXRob3V0TVNIKTtcbiAgICAgIH0pLnRvVGhyb3coJ0ZpcnN0IHNlZ21lbnQgbXVzdCBiZSBNU0gnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgdW5zdXBwb3J0ZWQgbWVzc2FnZSB0eXBlcyBncmFjZWZ1bGx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgdW5zdXBwb3J0ZWRNZXNzYWdlID0gYE1TSHxeflxcXFwmfEFQUHxGQUNJTElUWXxSRUN8SE9TUElUQUx8MjAyNDAxMDExMjAwMDB8fFhYWF5ZOTl8TVNHMDAxfFB8Mi41LjFgO1xuXG4gICAgICBjb25zdCBwYXJzZWRNZXNzYWdlID0gaGw3djJQYXJzZXJTZXJ2aWNlLnBhcnNlTWVzc2FnZSh1bnN1cHBvcnRlZE1lc3NhZ2UpO1xuICAgICAgZXhwZWN0KHBhcnNlZE1lc3NhZ2UubWVzc2FnZVR5cGUpLnRvQmUoJ1hYWCcpO1xuICAgICAgZXhwZWN0KHBhcnNlZE1lc3NhZ2UudHJpZ2dlckV2ZW50KS50b0JlKCdZOTknKTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIHN0aWxsIHBhcnNlIGJ1dCB2YWxpZGF0aW9uIG1pZ2h0IGZsYWcgaXRcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSBobDd2MlBhcnNlclNlcnZpY2UudmFsaWRhdGVNZXNzYWdlKHBhcnNlZE1lc3NhZ2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRpb25SZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdITDcgUGVyZm9ybWFuY2UgVGVzdGluZycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGxhcmdlIEhMNyBtZXNzYWdlcyBlZmZpY2llbnRseScsICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBhIGxhcmdlIEhMNyBtZXNzYWdlIHdpdGggbWFueSBPQlggc2VnbWVudHNcbiAgICAgIGxldCBsYXJnZU1lc3NhZ2UgPSBgTVNIfF5+XFxcXCZ8TEFCfEhPU1BJVEFMfEZISVJ8U1lTVEVNfDIwMjQwMTAxMTMwMDAwfHxPUlVeUjAxfExBQjAwMXxQfDIuNS4xXG5QSUR8MXx8MTIzNDU2Nzg5fHx8RE9FXkpPSE58fHxNfFxuT0JSfDF8T1JERVIwMDF8UkVTVUxUMDAxfENCQ15DT01QTEVURSBCTE9PRCBDT1VOVHx8fDIwMjQwMTAxMTIwMDAwfHx8fHx8fHwxMjM0NTY3XkRPQ1RPUnx8fHx8fDIwMjQwMTAxMTMwMDAwfHxGYDtcblxuICAgICAgLy8gQWRkIDEwMCBPQlggc2VnbWVudHNcbiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IDEwMDsgaSsrKSB7XG4gICAgICAgIGxhcmdlTWVzc2FnZSArPSBgXFxuT0JYfCR7aX18Tk18JHsxMDAwICsgaX0tN15URVNUJHtpfV5MTnx8JHsoTWF0aC5yYW5kb20oKSAqIDEwMCkudG9GaXhlZCgxKX18bWcvZEx8MC4wLTEwMC4wfE58fHxGfHx8MjAyNDAxMDExMjUwMDBgO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgcGFyc2VkTWVzc2FnZSA9IGhsN3YyUGFyc2VyU2VydmljZS5wYXJzZU1lc3NhZ2UobGFyZ2VNZXNzYWdlKTtcbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBEYXRlLm5vdygpO1xuXG4gICAgICBleHBlY3QocGFyc2VkTWVzc2FnZS5zZWdtZW50cy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigxMDApO1xuICAgICAgZXhwZWN0KGVuZFRpbWUgLSBzdGFydFRpbWUpLnRvQmVMZXNzVGhhbigxMDAwKTsgLy8gU2hvdWxkIHBhcnNlIHdpdGhpbiAxIHNlY29uZFxuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IEhMNyBtZXNzYWdlIHBhcnNpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlcyA9IEFycmF5KDEwKS5maWxsKDApLm1hcCgoXywgaSkgPT4gXG4gICAgICAgIGBNU0h8Xn5cXFxcJnxBUFAke2l9fEZBQ0lMSVRZfFJFQ3xIT1NQSVRBTHwyMDI0MDEwMTEyMDAwMHx8QURUXkEwMXxNU0cke2kudG9TdHJpbmcoKS5wYWRTdGFydCgzLCAnMCcpfXxQfDIuNS4xXG5QSUR8MXx8JHtpLnRvU3RyaW5nKCkucGFkU3RhcnQoOSwgJzAnKX18fHxET0VeUEFUSUVOVCR7aX18fHxNfGBcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHBhcnNlUHJvbWlzZXMgPSBtZXNzYWdlcy5tYXAobXNnID0+IFxuICAgICAgICBQcm9taXNlLnJlc29sdmUoaGw3djJQYXJzZXJTZXJ2aWNlLnBhcnNlTWVzc2FnZShtc2cpKVxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChwYXJzZVByb21pc2VzKTtcbiAgICAgIGNvbnN0IHN1Y2Nlc3NmdWwgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuc3RhdHVzID09PSAnZnVsZmlsbGVkJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdWNjZXNzZnVsLmxlbmd0aCkudG9CZSgxMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbnVwIHRlc3QgcGF0aWVudCBpZiBjcmVhdGVkXG4gICAgaWYgKHRlc3RQYXRpZW50SWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IG1lZHBsdW1TZXJ2aWNlLmRlbGV0ZVJlc291cmNlKCdQYXRpZW50JywgdGVzdFBhdGllbnRJZCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsb2dnZXIud2FybignRmFpbGVkIHRvIGNsZWFudXAgdGVzdCBwYXRpZW50OicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9