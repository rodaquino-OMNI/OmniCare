16bf8e9d3f9a16eb15e84c674e974907
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const medplum_service_1 = require("../../src/services/medplum.service");
const fhir_resources_service_1 = require("../../src/services/fhir-resources.service");
const smart_fhir_service_1 = require("../../src/services/smart-fhir.service");
const fhir_validation_service_1 = require("../../src/services/integration/fhir/fhir-validation.service");
const logger_1 = __importDefault(require("../../src/utils/logger"));
/**
 * Healthcare API Integration Tests
 * Tests end-to-end FHIR API operations including CRUD, search, and validation
 */
describe('Healthcare API Integration Tests', () => {
    let testPatientId;
    let testEncounterId;
    let testPractitionerId;
    let accessToken;
    beforeAll(async () => {
        // Initialize all services
        await medplum_service_1.medplumService.initialize();
        await setupTestData();
    });
    afterAll(async () => {
        // Cleanup test data
        await cleanupTestData();
    });
    describe('FHIR Server Integration (Medplum)', () => {
        test('should connect to Medplum FHIR server', async () => {
            const healthStatus = await medplum_service_1.medplumService.getHealthStatus();
            expect(healthStatus.status).toBe('UP');
            expect(healthStatus.details.initialized).toBe(true);
        });
        test('should retrieve FHIR capability statement', async () => {
            const capabilityStatement = await medplum_service_1.medplumService.getCapabilityStatement();
            expect(capabilityStatement).toBeDefined();
            expect(capabilityStatement.resourceType).toBe('CapabilityStatement');
        });
        test('should validate FHIR server compliance', async () => {
            const capabilityStatement = await medplum_service_1.medplumService.getCapabilityStatement();
            expect(capabilityStatement.fhirVersion).toMatch(/4\.0\.\d+/);
            expect(capabilityStatement.status).toBe('active');
            expect(capabilityStatement.kind).toBe('instance');
        });
    });
    describe('Patient Data Flow Integration', () => {
        test('should create, read, update, and delete patient records', async () => {
            // CREATE
            const patientData = {
                name: [{ given: ['Integration'], family: 'Test' }],
                gender: 'male',
                birthDate: '1990-01-01',
                telecom: [
                    { system: 'phone', value: '555-0123', use: 'mobile' }
                ],
                address: [{
                        use: 'home',
                        line: ['123 Test St'],
                        city: 'Test City',
                        state: 'TS',
                        postalCode: '12345'
                    }]
            };
            const createdPatient = await fhir_resources_service_1.fhirResourcesService.createPatient(patientData);
            expect(createdPatient.id).toBeDefined();
            expect(createdPatient.resourceType).toBe('Patient');
            testPatientId = createdPatient.id;
            // READ
            const retrievedPatient = await fhir_resources_service_1.fhirResourcesService.getPatient(testPatientId);
            expect(retrievedPatient.id).toBe(testPatientId);
            expect(retrievedPatient.name?.[0]?.family).toBe('Test');
            // UPDATE
            const updatedPatientData = {
                ...retrievedPatient,
                name: [{ given: ['Integration', 'Updated'], family: 'Test' }]
            };
            const updatedPatient = await fhir_resources_service_1.fhirResourcesService.updatePatient(updatedPatientData);
            expect(updatedPatient.name?.[0]?.given).toContain('Updated');
            // SEARCH
            const searchResults = await fhir_resources_service_1.fhirResourcesService.searchPatients({
                family: 'Test',
                given: 'Integration'
            });
            expect(searchResults.total).toBeGreaterThan(0);
            expect(searchResults.entry?.length).toBeGreaterThan(0);
        });
        test('should handle patient data validation', async () => {
            const invalidPatient = {
                resourceType: 'Patient',
                // Missing required fields
            };
            const validationResult = await fhir_validation_service_1.fhirValidationService.validateResource(invalidPatient);
            expect(validationResult.valid).toBe(false);
            expect(validationResult.errors.length).toBeGreaterThan(0);
        });
        test('should retrieve patient everything bundle', async () => {
            const everythingBundle = await fhir_resources_service_1.fhirResourcesService.getPatientEverything(testPatientId);
            expect(everythingBundle.resourceType).toBe('Bundle');
            expect(everythingBundle.type).toBe('searchset');
            expect(everythingBundle.entry).toBeDefined();
        });
    });
    describe('Clinical Encounter Management', () => {
        test('should create and manage encounters', async () => {
            const encounterData = {
                status: 'planned',
                subject: { reference: `Patient/${testPatientId}` },
                period: {
                    start: new Date().toISOString(),
                    end: new Date(Date.now() + 3600000).toISOString() // 1 hour later
                },
                appointmentType: 'routine',
                chiefComplaint: 'Integration test encounter'
            };
            const createdEncounter = await fhir_resources_service_1.fhirResourcesService.createEncounter(encounterData);
            expect(createdEncounter.id).toBeDefined();
            expect(createdEncounter.status).toBe('planned');
            testEncounterId = createdEncounter.id;
        });
        test('should create vital signs observations', async () => {
            const vitals = {
                temperature: 98.6,
                bloodPressureSystolic: 120,
                bloodPressureDiastolic: 80,
                heartRate: 72,
                respiratoryRate: 16,
                oxygenSaturation: 98
            };
            const vitalObservations = await fhir_resources_service_1.fhirResourcesService.createVitalSigns(testPatientId, testEncounterId, vitals);
            expect(vitalObservations.length).toBeGreaterThan(0);
            vitalObservations.forEach(obs => {
                expect(obs.resourceType).toBe('Observation');
                expect(obs.status).toBe('final');
                expect(obs.subject?.reference).toBe(`Patient/${testPatientId}`);
                expect(obs.encounter?.reference).toBe(`Encounter/${testEncounterId}`);
            });
        });
    });
    describe('FHIR Validation Service Integration', () => {
        test('should validate FHIR resources against R4 schema', async () => {
            const validPatient = {
                resourceType: 'Patient',
                active: true,
                name: [{ given: ['Valid'], family: 'Patient' }],
                gender: 'male',
                birthDate: '1990-01-01'
            };
            const validationResult = await fhir_validation_service_1.fhirValidationService.validateResource(validPatient);
            expect(validationResult.valid).toBe(true);
            expect(validationResult.errors.length).toBe(0);
        });
        test('should detect validation errors', async () => {
            const invalidPatient = {
                resourceType: 'Patient',
                birthDate: '2030-01-01', // Future birth date - business rule violation
                gender: 'invalid-gender' // Invalid gender value
            };
            const validationResult = await fhir_validation_service_1.fhirValidationService.validateResource(invalidPatient);
            expect(validationResult.valid).toBe(false);
            expect(validationResult.errors.length).toBeGreaterThan(0);
        });
        test('should validate bundle resources', async () => {
            const bundle = {
                resourceType: 'Bundle',
                type: 'collection',
                entry: [
                    {
                        resource: {
                            resourceType: 'Patient',
                            active: true,
                            name: [{ given: ['Bundle'], family: 'Test' }],
                            gender: 'female'
                        }
                    }
                ]
            };
            const bundleValidation = await fhir_validation_service_1.fhirValidationService.validateBundle(bundle);
            expect(bundleValidation.valid).toBe(true);
        });
    });
    describe('SMART on FHIR Integration', () => {
        test('should initiate SMART authorization flow', async () => {
            const clientId = 'test-client-id';
            const redirectUri = 'http://localhost:3000/callback';
            const scopes = ['patient/Patient.read', 'patient/Observation.read'];
            const authFlow = await smart_fhir_service_1.smartFHIRService.initiateAuthorization(clientId, redirectUri, scopes);
            expect(authFlow.authorizationUrl).toBeDefined();
            expect(authFlow.state).toBeDefined();
            expect(authFlow.authorizationUrl).toContain('response_type=code');
            expect(authFlow.authorizationUrl).toContain(`client_id=${clientId}`);
        });
        test('should get SMART configuration from EHR', async () => {
            const mockFhirBaseUrl = 'https://fhir.epic.com/interconnect-fhir-oauth';
            try {
                const smartConfig = await smart_fhir_service_1.smartFHIRService.getSMARTConfiguration(mockFhirBaseUrl);
                expect(smartConfig).toBeDefined();
                expect(smartConfig.authorization_endpoint).toBeDefined();
                expect(smartConfig.token_endpoint).toBeDefined();
            }
            catch (error) {
                // Expected for mock URL - test structure is valid
                expect(error).toBeDefined();
            }
        });
        test('should validate JWT tokens', () => {
            const mockJWT = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c';
            try {
                const decoded = smart_fhir_service_1.smartFHIRService.validateJWT(mockJWT);
                expect(decoded).toBeDefined();
            }
            catch (error) {
                // Expected with mock JWT - test structure is valid
                expect(error).toBeDefined();
            }
        });
    });
    describe('Batch Operations Integration', () => {
        test('should execute FHIR batch bundle', async () => {
            const batchResources = [
                {
                    resourceType: 'Patient',
                    name: [{ given: ['Batch'], family: 'Test1' }],
                    gender: 'male'
                },
                {
                    resourceType: 'Patient',
                    name: [{ given: ['Batch'], family: 'Test2' }],
                    gender: 'female'
                }
            ];
            const batchRequest = {
                type: 'batch',
                resources: batchResources,
                timestamp: new Date().toISOString()
            };
            const batchResult = await medplum_service_1.medplumService.executeBatch(batchRequest);
            expect(batchResult.resourceType).toBe('Bundle');
            expect(batchResult.type).toBe('batch-response');
        });
        test('should handle transaction bundles', async () => {
            const transactionResources = [
                {
                    resourceType: 'Patient',
                    name: [{ given: ['Transaction'], family: 'Test' }],
                    gender: 'other'
                }
            ];
            const transactionRequest = {
                type: 'transaction',
                resources: transactionResources,
                timestamp: new Date().toISOString()
            };
            const transactionResult = await medplum_service_1.medplumService.executeBatch(transactionRequest);
            expect(transactionResult.resourceType).toBe('Bundle');
        });
    });
    describe('Error Handling and Resilience', () => {
        test('should handle FHIR server connection errors gracefully', async () => {
            // Simulate connection error by using invalid resource type
            try {
                await medplum_service_1.medplumService.readResource('InvalidResourceType', 'invalid-id');
            }
            catch (error) {
                expect(error).toBeDefined();
                expect(error.message).toContain('FHIR Error');
            }
        });
        test('should handle validation errors for malformed resources', async () => {
            const malformedResource = {
                resourceType: 'Patient',
                name: 'This should be an array, not a string'
            };
            const validationResult = await fhir_validation_service_1.fhirValidationService.validateResource(malformedResource);
            expect(validationResult.valid).toBe(false);
            expect(validationResult.errors.length).toBeGreaterThan(0);
        });
        test('should handle network timeouts gracefully', async () => {
            // Test timeout handling by using very long search
            const searchParams = {
                _count: 1000000,
                _sort: 'name'
            };
            try {
                const results = await fhir_resources_service_1.fhirResourcesService.searchPatients(searchParams);
                expect(results).toBeDefined();
            }
            catch (error) {
                // Timeout or other network error is acceptable
                expect(error).toBeDefined();
            }
        });
    });
    describe('Performance and Load Testing', () => {
        test('should handle concurrent patient creation', async () => {
            const patientPromises = Array(5).fill(0).map((_, i) => {
                const patientData = {
                    name: [{ given: ['Concurrent'], family: `Test${i}` }],
                    gender: 'unknown',
                    birthDate: '1990-01-01'
                };
                return fhir_resources_service_1.fhirResourcesService.createPatient(patientData);
            });
            const patients = await Promise.allSettled(patientPromises);
            const successfulPatients = patients.filter(p => p.status === 'fulfilled');
            expect(successfulPatients.length).toBeGreaterThan(0);
        });
        test('should handle large search result sets', async () => {
            const searchParams = {
                _count: 100,
                active: 'true'
            };
            const startTime = Date.now();
            const results = await fhir_resources_service_1.fhirResourcesService.searchPatients(searchParams);
            const endTime = Date.now();
            expect(results).toBeDefined();
            expect(endTime - startTime).toBeLessThan(10000); // Should complete within 10 seconds
        });
    });
    // Helper functions
    async function setupTestData() {
        try {
            // Create test practitioner
            const practitionerData = {
                name: [{ given: ['Test'], family: 'Practitioner' }],
                identifier: [{
                        system: 'http://hl7.org/fhir/sid/us-npi',
                        value: '1234567890'
                    }]
            };
            const practitioner = await fhir_resources_service_1.fhirResourcesService.createPractitioner(practitionerData);
            testPractitionerId = practitioner.id;
        }
        catch (error) {
            logger_1.default.warn('Failed to setup test data:', error);
        }
    }
    async function cleanupTestData() {
        try {
            // Cleanup is handled by the test environment
            // In production, you would delete test resources here
            if (testPatientId) {
                await medplum_service_1.medplumService.deleteResource('Patient', testPatientId);
            }
            if (testEncounterId) {
                await medplum_service_1.medplumService.deleteResource('Encounter', testEncounterId);
            }
            if (testPractitionerId) {
                await medplum_service_1.medplumService.deleteResource('Practitioner', testPractitionerId);
            }
        }
        catch (error) {
            logger_1.default.warn('Failed to cleanup test data:', error);
        }
    }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvdGVzdHMvaW50ZWdyYXRpb24vaGVhbHRoY2FyZS1hcGkuaW50ZWdyYXRpb24udGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUVBLHdFQUFvRTtBQUNwRSxzRkFBaUY7QUFDakYsOEVBQXlFO0FBQ3pFLHlHQUFvRztBQUlwRyxvRUFBNEM7QUFFNUM7OztHQUdHO0FBQ0gsUUFBUSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtJQUNoRCxJQUFJLGFBQXFCLENBQUM7SUFDMUIsSUFBSSxlQUF1QixDQUFDO0lBQzVCLElBQUksa0JBQTBCLENBQUM7SUFDL0IsSUFBSSxXQUFtQixDQUFDO0lBRXhCLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQiwwQkFBMEI7UUFDMUIsTUFBTSxnQ0FBYyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ2xDLE1BQU0sYUFBYSxFQUFFLENBQUM7SUFDeEIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbEIsb0JBQW9CO1FBQ3BCLE1BQU0sZUFBZSxFQUFFLENBQUM7SUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFO1FBQ2pELElBQUksQ0FBQyx1Q0FBdUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2RCxNQUFNLFlBQVksR0FBRyxNQUFNLGdDQUFjLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDNUQsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RELENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLDJDQUEyQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNELE1BQU0sbUJB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QUFNLENBQUMsSUFBSSxDQUFDLDRCQUE0QixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ25ELENBQUM7SUFDSCxDQUFDO0lBRUQsS0FBSyxVQUFVLGVBQWU7UUFDNUIsSUFBSSxDQUFDO1lBQ0gsNkNBQTZDO1lBQzdDLHNEQUFzRDtZQUN0RCxJQUFJLGFBQWEsRUFBRSxDQUFDO2dCQUNsQixNQUFNLGdDQUFjLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsQ0FBQztZQUNoRSxDQUFDO1lBQ0QsSUFBSSxlQUFlLEVBQUUsQ0FBQztnQkFDcEIsTUFBTSxnQ0FBYyxDQUFDLGNBQWMsQ0FBQyxXQUFXLEVBQUUsZUFBZSxDQUFDLENBQUM7WUFDcEUsQ0FBQztZQUNELElBQUksa0JBQWtCLEVBQUUsQ0FBQztnQkFDdkIsTUFBTSxnQ0FBYyxDQUFDLGNBQWMsQ0FBQyxjQUFjLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztZQUMxRSxDQUFDO1FBQ0gsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixnQkFBTSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNyRCxDQUFDO0lBQ0gsQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvL2NsYXVkZS1wcm9qZWN0cy9PbW5pQ2FyZS9iYWNrZW5kL3Rlc3RzL2ludGVncmF0aW9uL2hlYWx0aGNhcmUtYXBpLmludGVncmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHJlcXVlc3QgZnJvbSAnc3VwZXJ0ZXN0JztcbmltcG9ydCB7IGFwcCB9IGZyb20gJy4uLy4uL3NyYy9hcHAnO1xuaW1wb3J0IHsgbWVkcGx1bVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zcmMvc2VydmljZXMvbWVkcGx1bS5zZXJ2aWNlJztcbmltcG9ydCB7IGZoaXJSZXNvdXJjZXNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL2ZoaXItcmVzb3VyY2VzLnNlcnZpY2UnO1xuaW1wb3J0IHsgc21hcnRGSElSU2VydmljZSB9IGZyb20gJy4uLy4uL3NyYy9zZXJ2aWNlcy9zbWFydC1maGlyLnNlcnZpY2UnO1xuaW1wb3J0IHsgZmhpclZhbGlkYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL2ludGVncmF0aW9uL2ZoaXIvZmhpci12YWxpZGF0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgZGlyZWN0VHJ1c3RTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL2ludGVncmF0aW9uL2RpcmVjdC9kaXJlY3QtdHJ1c3Quc2VydmljZSc7XG5pbXBvcnQgeyBobDd2MlBhcnNlclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zcmMvc2VydmljZXMvaW50ZWdyYXRpb24vaGw3djIvaGw3djItcGFyc2VyLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGF0aWVudCwgRW5jb3VudGVyLCBPYnNlcnZhdGlvbiwgQnVuZGxlIH0gZnJvbSAnQG1lZHBsdW0vZmhpcnR5cGVzJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi4vLi4vc3JjL3V0aWxzL2xvZ2dlcic7XG5cbi8qKlxuICogSGVhbHRoY2FyZSBBUEkgSW50ZWdyYXRpb24gVGVzdHNcbiAqIFRlc3RzIGVuZC10by1lbmQgRkhJUiBBUEkgb3BlcmF0aW9ucyBpbmNsdWRpbmcgQ1JVRCwgc2VhcmNoLCBhbmQgdmFsaWRhdGlvblxuICovXG5kZXNjcmliZSgnSGVhbHRoY2FyZSBBUEkgSW50ZWdyYXRpb24gVGVzdHMnLCAoKSA9PiB7XG4gIGxldCB0ZXN0UGF0aWVudElkOiBzdHJpbmc7XG4gIGxldCB0ZXN0RW5jb3VudGVySWQ6IHN0cmluZztcbiAgbGV0IHRlc3RQcmFjdGl0aW9uZXJJZDogc3RyaW5nO1xuICBsZXQgYWNjZXNzVG9rZW46IHN0cmluZztcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIC8vIEluaXRpYWxpemUgYWxsIHNlcnZpY2VzXG4gICAgYXdhaXQgbWVkcGx1bVNlcnZpY2UuaW5pdGlhbGl6ZSgpO1xuICAgIGF3YWl0IHNldHVwVGVzdERhdGEoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAgIC8vIENsZWFudXAgdGVzdCBkYXRhXG4gICAgYXdhaXQgY2xlYW51cFRlc3REYXRhKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdGSElSIFNlcnZlciBJbnRlZ3JhdGlvbiAoTWVkcGx1bSknLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGNvbm5lY3QgdG8gTWVkcGx1bSBGSElSIHNlcnZlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGhlYWx0aFN0YXR1cyA9IGF3YWl0IG1lZHBsdW1TZXJ2aWNlLmdldEhlYWx0aFN0YXR1cygpO1xuICAgICAgZXhwZWN0KGhlYWx0aFN0YXR1cy5zdGF0dXMpLnRvQmUoJ1VQJyk7XG4gICAgICBleHBlY3QoaGVhbHRoU3RhdHVzLmRldGFpbHMuaW5pdGlhbGl6ZWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgcmV0cmlldmUgRkhJUiBjYXBhYmlsaXR5IHN0YXRlbWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNhcGFiaWxpdHlTdGF0ZW1lbnQgPSBhd2FpdCBtZWRwbHVtU2VydmljZS5nZXRDYXBhYmlsaXR5U3RhdGVtZW50KCk7XG4gICAgICBleHBlY3QoY2FwYWJpbGl0eVN0YXRlbWVudCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChjYXBhYmlsaXR5U3RhdGVtZW50LnJlc291cmNlVHlwZSkudG9CZSgnQ2FwYWJpbGl0eVN0YXRlbWVudCcpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHZhbGlkYXRlIEZISVIgc2VydmVyIGNvbXBsaWFuY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYXBhYmlsaXR5U3RhdGVtZW50ID0gYXdhaXQgbWVkcGx1bVNlcnZpY2UuZ2V0Q2FwYWJpbGl0eVN0YXRlbWVudCgpO1xuICAgICAgZXhwZWN0KGNhcGFiaWxpdHlTdGF0ZW1lbnQuZmhpclZlcnNpb24pLnRvTWF0Y2goLzRcXC4wXFwuXFxkKy8pO1xuICAgICAgZXhwZWN0KGNhcGFiaWxpdHlTdGF0ZW1lbnQuc3RhdHVzKS50b0JlKCdhY3RpdmUnKTtcbiAgICAgIGV4cGVjdChjYXBhYmlsaXR5U3RhdGVtZW50LmtpbmQpLnRvQmUoJ2luc3RhbmNlJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQYXRpZW50IERhdGEgRmxvdyBJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgY3JlYXRlLCByZWFkLCB1cGRhdGUsIGFuZCBkZWxldGUgcGF0aWVudCByZWNvcmRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ1JFQVRFXG4gICAgICBjb25zdCBwYXRpZW50RGF0YSA9IHtcbiAgICAgICAgbmFtZTogW3sgZ2l2ZW46IFsnSW50ZWdyYXRpb24nXSwgZmFtaWx5OiAnVGVzdCcgfV0sXG4gICAgICAgIGdlbmRlcjogJ21hbGUnIGFzIGNvbnN0LFxuICAgICAgICBiaXJ0aERhdGU6ICcxOTkwLTAxLTAxJyxcbiAgICAgICAgdGVsZWNvbTogW1xuICAgICAgICAgIHsgc3lzdGVtOiAncGhvbmUnIGFzIGNvbnN0LCB2YWx1ZTogJzU1NS0wMTIzJywgdXNlOiAnbW9iaWxlJyBhcyBjb25zdCB9XG4gICAgICAgIF0sXG4gICAgICAgIGFkZHJlc3M6IFt7XG4gICAgICAgICAgdXNlOiAnaG9tZScsXG4gICAgICAgICAgbGluZTogWycxMjMgVGVzdCBTdCddLFxuICAgICAgICAgIGNpdHk6ICdUZXN0IENpdHknLFxuICAgICAgICAgIHN0YXRlOiAnVFMnLFxuICAgICAgICAgIHBvc3RhbENvZGU6ICcxMjM0NSdcbiAgICAgICAgfV1cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNyZWF0ZWRQYXRpZW50ID0gYXdhaXQgZmhpclJlc291cmNlc1NlcnZpY2UuY3JlYXRlUGF0aWVudChwYXRpZW50RGF0YSk7XG4gICAgICBleHBlY3QoY3JlYXRlZFBhdGllbnQuaWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoY3JlYXRlZFBhdGllbnQucmVzb3VyY2VUeXBlKS50b0JlKCdQYXRpZW50Jyk7XG4gICAgICB0ZXN0UGF0aWVudElkID0gY3JlYXRlZFBhdGllbnQuaWQhO1xuXG4gICAgICAvLyBSRUFEXG4gICAgICBjb25zdCByZXRyaWV2ZWRQYXRpZW50ID0gYXdhaXQgZmhpclJlc291cmNlc1NlcnZpY2UuZ2V0UGF0aWVudCh0ZXN0UGF0aWVudElkKTtcbiAgICAgIGV4cGVjdChyZXRyaWV2ZWRQYXRpZW50LmlkKS50b0JlKHRlc3RQYXRpZW50SWQpO1xuICAgICAgZXhwZWN0KHJldHJpZXZlZFBhdGllbnQubmFtZT8uWzBdPy5mYW1pbHkpLnRvQmUoJ1Rlc3QnKTtcblxuICAgICAgLy8gVVBEQVRFXG4gICAgICBjb25zdCB1cGRhdGVkUGF0aWVudERhdGEgPSB7XG4gICAgICAgIC4uLnJldHJpZXZlZFBhdGllbnQsXG4gICAgICAgIG5hbWU6IFt7IGdpdmVuOiBbJ0ludGVncmF0aW9uJywgJ1VwZGF0ZWQnXSwgZmFtaWx5OiAnVGVzdCcgfV1cbiAgICAgIH07XG4gICAgICBjb25zdCB1cGRhdGVkUGF0aWVudCA9IGF3YWl0IGZoaXJSZXNvdXJjZXNTZXJ2aWNlLnVwZGF0ZVBhdGllbnQodXBkYXRlZFBhdGllbnREYXRhKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkUGF0aWVudC5uYW1lPy5bMF0/LmdpdmVuKS50b0NvbnRhaW4oJ1VwZGF0ZWQnKTtcblxuICAgICAgLy8gU0VBUkNIXG4gICAgICBjb25zdCBzZWFyY2hSZXN1bHRzID0gYXdhaXQgZmhpclJlc291cmNlc1NlcnZpY2Uuc2VhcmNoUGF0aWVudHMoe1xuICAgICAgICBmYW1pbHk6ICdUZXN0JyxcbiAgICAgICAgZ2l2ZW46ICdJbnRlZ3JhdGlvbidcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHNlYXJjaFJlc3VsdHMudG90YWwpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChzZWFyY2hSZXN1bHRzLmVudHJ5Py5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgcGF0aWVudCBkYXRhIHZhbGlkYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkUGF0aWVudCA9IHtcbiAgICAgICAgcmVzb3VyY2VUeXBlOiAnUGF0aWVudCcsXG4gICAgICAgIC8vIE1pc3NpbmcgcmVxdWlyZWQgZmllbGRzXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gYXdhaXQgZmhpclZhbGlkYXRpb25TZXJ2aWNlLnZhbGlkYXRlUmVzb3VyY2UoaW52YWxpZFBhdGllbnQpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRpb25SZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHJldHJpZXZlIHBhdGllbnQgZXZlcnl0aGluZyBidW5kbGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVyeXRoaW5nQnVuZGxlID0gYXdhaXQgZmhpclJlc291cmNlc1NlcnZpY2UuZ2V0UGF0aWVudEV2ZXJ5dGhpbmcodGVzdFBhdGllbnRJZCk7XG4gICAgICBleHBlY3QoZXZlcnl0aGluZ0J1bmRsZS5yZXNvdXJjZVR5cGUpLnRvQmUoJ0J1bmRsZScpO1xuICAgICAgZXhwZWN0KGV2ZXJ5dGhpbmdCdW5kbGUudHlwZSkudG9CZSgnc2VhcmNoc2V0Jyk7XG4gICAgICBleHBlY3QoZXZlcnl0aGluZ0J1bmRsZS5lbnRyeSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NsaW5pY2FsIEVuY291bnRlciBNYW5hZ2VtZW50JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBjcmVhdGUgYW5kIG1hbmFnZSBlbmNvdW50ZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZW5jb3VudGVyRGF0YSA9IHtcbiAgICAgICAgc3RhdHVzOiAncGxhbm5lZCcgYXMgY29uc3QsXG4gICAgICAgIHN1YmplY3Q6IHsgcmVmZXJlbmNlOiBgUGF0aWVudC8ke3Rlc3RQYXRpZW50SWR9YCB9LFxuICAgICAgICBwZXJpb2Q6IHtcbiAgICAgICAgICBzdGFydDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGVuZDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDM2MDAwMDApLnRvSVNPU3RyaW5nKCkgLy8gMSBob3VyIGxhdGVyXG4gICAgICAgIH0sXG4gICAgICAgIGFwcG9pbnRtZW50VHlwZTogJ3JvdXRpbmUnLFxuICAgICAgICBjaGllZkNvbXBsYWludDogJ0ludGVncmF0aW9uIHRlc3QgZW5jb3VudGVyJ1xuICAgICAgfTtcblxuICAgICAgY29uc3QgY3JlYXRlZEVuY291bnRlciA9IGF3YWl0IGZoaXJSZXNvdXJjZXNTZXJ2aWNlLmNyZWF0ZUVuY291bnRlcihlbmNvdW50ZXJEYXRhKTtcbiAgICAgIGV4cGVjdChjcmVhdGVkRW5jb3VudGVyLmlkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGNyZWF0ZWRFbmNvdW50ZXIuc3RhdHVzKS50b0JlKCdwbGFubmVkJyk7XG4gICAgICB0ZXN0RW5jb3VudGVySWQgPSBjcmVhdGVkRW5jb3VudGVyLmlkITtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBjcmVhdGUgdml0YWwgc2lnbnMgb2JzZXJ2YXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgdml0YWxzID0ge1xuICAgICAgICB0ZW1wZXJhdHVyZTogOTguNixcbiAgICAgICAgYmxvb2RQcmVzc3VyZVN5c3RvbGljOiAxMjAsXG4gICAgICAgIGJsb29kUHJlc3N1cmVEaWFzdG9saWM6IDgwLFxuICAgICAgICBoZWFydFJhdGU6IDcyLFxuICAgICAgICByZXNwaXJhdG9yeVJhdGU6IDE2LFxuICAgICAgICBveHlnZW5TYXR1cmF0aW9uOiA5OFxuICAgICAgfTtcblxuICAgICAgY29uc3Qgdml0YWxPYnNlcnZhdGlvbnMgPSBhd2FpdCBmaGlyUmVzb3VyY2VzU2VydmljZS5jcmVhdGVWaXRhbFNpZ25zKFxuICAgICAgICB0ZXN0UGF0aWVudElkLFxuICAgICAgICB0ZXN0RW5jb3VudGVySWQsXG4gICAgICAgIHZpdGFsc1xuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHZpdGFsT2JzZXJ2YXRpb25zLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgdml0YWxPYnNlcnZhdGlvbnMuZm9yRWFjaChvYnMgPT4ge1xuICAgICAgICBleHBlY3Qob2JzLnJlc291cmNlVHlwZSkudG9CZSgnT2JzZXJ2YXRpb24nKTtcbiAgICAgICAgZXhwZWN0KG9icy5zdGF0dXMpLnRvQmUoJ2ZpbmFsJyk7XG4gICAgICAgIGV4cGVjdChvYnMuc3ViamVjdD8ucmVmZXJlbmNlKS50b0JlKGBQYXRpZW50LyR7dGVzdFBhdGllbnRJZH1gKTtcbiAgICAgICAgZXhwZWN0KG9icy5lbmNvdW50ZXI/LnJlZmVyZW5jZSkudG9CZShgRW5jb3VudGVyLyR7dGVzdEVuY291bnRlcklkfWApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdGSElSIFZhbGlkYXRpb24gU2VydmljZSBJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgRkhJUiByZXNvdXJjZXMgYWdhaW5zdCBSNCBzY2hlbWEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZFBhdGllbnQ6IFBhdGllbnQgPSB7XG4gICAgICAgIHJlc291cmNlVHlwZTogJ1BhdGllbnQnLFxuICAgICAgICBhY3RpdmU6IHRydWUsXG4gICAgICAgIG5hbWU6IFt7IGdpdmVuOiBbJ1ZhbGlkJ10sIGZhbWlseTogJ1BhdGllbnQnIH1dLFxuICAgICAgICBnZW5kZXI6ICdtYWxlJyxcbiAgICAgICAgYmlydGhEYXRlOiAnMTk5MC0wMS0wMSdcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSBhd2FpdCBmaGlyVmFsaWRhdGlvblNlcnZpY2UudmFsaWRhdGVSZXNvdXJjZSh2YWxpZFBhdGllbnQpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRpb25SZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGlvblJlc3VsdC5lcnJvcnMubGVuZ3RoKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGRldGVjdCB2YWxpZGF0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRQYXRpZW50ID0ge1xuICAgICAgICByZXNvdXJjZVR5cGU6ICdQYXRpZW50JyxcbiAgICAgICAgYmlydGhEYXRlOiAnMjAzMC0wMS0wMScsIC8vIEZ1dHVyZSBiaXJ0aCBkYXRlIC0gYnVzaW5lc3MgcnVsZSB2aW9sYXRpb25cbiAgICAgICAgZ2VuZGVyOiAnaW52YWxpZC1nZW5kZXInIC8vIEludmFsaWQgZ2VuZGVyIHZhbHVlXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gYXdhaXQgZmhpclZhbGlkYXRpb25TZXJ2aWNlLnZhbGlkYXRlUmVzb3VyY2UoaW52YWxpZFBhdGllbnQpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRpb25SZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHZhbGlkYXRlIGJ1bmRsZSByZXNvdXJjZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBidW5kbGU6IEJ1bmRsZSA9IHtcbiAgICAgICAgcmVzb3VyY2VUeXBlOiAnQnVuZGxlJyxcbiAgICAgICAgdHlwZTogJ2NvbGxlY3Rpb24nLFxuICAgICAgICBlbnRyeTogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJlc291cmNlOiB7XG4gICAgICAgICAgICAgIHJlc291cmNlVHlwZTogJ1BhdGllbnQnLFxuICAgICAgICAgICAgICBhY3RpdmU6IHRydWUsXG4gICAgICAgICAgICAgIG5hbWU6IFt7IGdpdmVuOiBbJ0J1bmRsZSddLCBmYW1pbHk6ICdUZXN0JyB9XSxcbiAgICAgICAgICAgICAgZ2VuZGVyOiAnZmVtYWxlJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfTtcblxuICAgICAgY29uc3QgYnVuZGxlVmFsaWRhdGlvbiA9IGF3YWl0IGZoaXJWYWxpZGF0aW9uU2VydmljZS52YWxpZGF0ZUJ1bmRsZShidW5kbGUpO1xuICAgICAgZXhwZWN0KGJ1bmRsZVZhbGlkYXRpb24udmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTTUFSVCBvbiBGSElSIEludGVncmF0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBpbml0aWF0ZSBTTUFSVCBhdXRob3JpemF0aW9uIGZsb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjbGllbnRJZCA9ICd0ZXN0LWNsaWVudC1pZCc7XG4gICAgICBjb25zdCByZWRpcmVjdFVyaSA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvY2FsbGJhY2snO1xuICAgICAgY29uc3Qgc2NvcGVzID0gWydwYXRpZW50L1BhdGllbnQucmVhZCcsICdwYXRpZW50L09ic2VydmF0aW9uLnJlYWQnXTtcblxuICAgICAgY29uc3QgYXV0aEZsb3cgPSBhd2FpdCBzbWFydEZISVJTZXJ2aWNlLmluaXRpYXRlQXV0aG9yaXphdGlvbihcbiAgICAgICAgY2xpZW50SWQsXG4gICAgICAgIHJlZGlyZWN0VXJpLFxuICAgICAgICBzY29wZXNcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChhdXRoRmxvdy5hdXRob3JpemF0aW9uVXJsKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGF1dGhGbG93LnN0YXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGF1dGhGbG93LmF1dGhvcml6YXRpb25VcmwpLnRvQ29udGFpbigncmVzcG9uc2VfdHlwZT1jb2RlJyk7XG4gICAgICBleHBlY3QoYXV0aEZsb3cuYXV0aG9yaXphdGlvblVybCkudG9Db250YWluKGBjbGllbnRfaWQ9JHtjbGllbnRJZH1gKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBnZXQgU01BUlQgY29uZmlndXJhdGlvbiBmcm9tIEVIUicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGaGlyQmFzZVVybCA9ICdodHRwczovL2ZoaXIuZXBpYy5jb20vaW50ZXJjb25uZWN0LWZoaXItb2F1dGgnO1xuICAgICAgXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBzbWFydENvbmZpZyA9IGF3YWl0IHNtYXJ0RkhJUlNlcnZpY2UuZ2V0U01BUlRDb25maWd1cmF0aW9uKG1vY2tGaGlyQmFzZVVybCk7XG4gICAgICAgIGV4cGVjdChzbWFydENvbmZpZykudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHNtYXJ0Q29uZmlnLmF1dGhvcml6YXRpb25fZW5kcG9pbnQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChzbWFydENvbmZpZy50b2tlbl9lbmRwb2ludCkudG9CZURlZmluZWQoKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIEV4cGVjdGVkIGZvciBtb2NrIFVSTCAtIHRlc3Qgc3RydWN0dXJlIGlzIHZhbGlkXG4gICAgICAgIGV4cGVjdChlcnJvcikudG9CZURlZmluZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCB2YWxpZGF0ZSBKV1QgdG9rZW5zJywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0pXVCA9ICdleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKemRXSWlPaUl4TWpNME5UWTNPRGt3SWl3aWJtRnRaU0k2SWtwdmFHNGdSRzlsSWl3aWFXRjBJam94TlRFMk1qTTVNREl5ZlEuU2ZsS3h3UkpTTWVLS0YyUVQ0ZndwTWVKZjM2UE9rNnlKVl9hZFFzc3c1Yyc7XG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRlY29kZWQgPSBzbWFydEZISVJTZXJ2aWNlLnZhbGlkYXRlSldUKG1vY2tKV1QpO1xuICAgICAgICBleHBlY3QoZGVjb2RlZCkudG9CZURlZmluZWQoKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIEV4cGVjdGVkIHdpdGggbW9jayBKV1QgLSB0ZXN0IHN0cnVjdHVyZSBpcyB2YWxpZFxuICAgICAgICBleHBlY3QoZXJyb3IpLnRvQmVEZWZpbmVkKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdCYXRjaCBPcGVyYXRpb25zIEludGVncmF0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBleGVjdXRlIEZISVIgYmF0Y2ggYnVuZGxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYmF0Y2hSZXNvdXJjZXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICByZXNvdXJjZVR5cGU6ICdQYXRpZW50JyxcbiAgICAgICAgICBuYW1lOiBbeyBnaXZlbjogWydCYXRjaCddLCBmYW1pbHk6ICdUZXN0MScgfV0sXG4gICAgICAgICAgZ2VuZGVyOiAnbWFsZSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHJlc291cmNlVHlwZTogJ1BhdGllbnQnLFxuICAgICAgICAgIG5hbWU6IFt7IGdpdmVuOiBbJ0JhdGNoJ10sIGZhbWlseTogJ1Rlc3QyJyB9XSxcbiAgICAgICAgICBnZW5kZXI6ICdmZW1hbGUnXG4gICAgICAgIH1cbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IGJhdGNoUmVxdWVzdCA9IHtcbiAgICAgICAgdHlwZTogJ2JhdGNoJyBhcyBjb25zdCxcbiAgICAgICAgcmVzb3VyY2VzOiBiYXRjaFJlc291cmNlcyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGJhdGNoUmVzdWx0ID0gYXdhaXQgbWVkcGx1bVNlcnZpY2UuZXhlY3V0ZUJhdGNoKGJhdGNoUmVxdWVzdCk7XG4gICAgICBleHBlY3QoYmF0Y2hSZXN1bHQucmVzb3VyY2VUeXBlKS50b0JlKCdCdW5kbGUnKTtcbiAgICAgIGV4cGVjdChiYXRjaFJlc3VsdC50eXBlKS50b0JlKCdiYXRjaC1yZXNwb25zZScpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSB0cmFuc2FjdGlvbiBidW5kbGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdHJhbnNhY3Rpb25SZXNvdXJjZXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICByZXNvdXJjZVR5cGU6ICdQYXRpZW50JyxcbiAgICAgICAgICBuYW1lOiBbeyBnaXZlbjogWydUcmFuc2FjdGlvbiddLCBmYW1pbHk6ICdUZXN0JyB9XSxcbiAgICAgICAgICBnZW5kZXI6ICdvdGhlcidcbiAgICAgICAgfVxuICAgICAgXTtcblxuICAgICAgY29uc3QgdHJhbnNhY3Rpb25SZXF1ZXN0ID0ge1xuICAgICAgICB0eXBlOiAndHJhbnNhY3Rpb24nIGFzIGNvbnN0LFxuICAgICAgICByZXNvdXJjZXM6IHRyYW5zYWN0aW9uUmVzb3VyY2VzLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfTtcblxuICAgICAgY29uc3QgdHJhbnNhY3Rpb25SZXN1bHQgPSBhd2FpdCBtZWRwbHVtU2VydmljZS5leGVjdXRlQmF0Y2godHJhbnNhY3Rpb25SZXF1ZXN0KTtcbiAgICAgIGV4cGVjdCh0cmFuc2FjdGlvblJlc3VsdC5yZXNvdXJjZVR5cGUpLnRvQmUoJ0J1bmRsZScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcgYW5kIFJlc2lsaWVuY2UnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBGSElSIHNlcnZlciBjb25uZWN0aW9uIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2ltdWxhdGUgY29ubmVjdGlvbiBlcnJvciBieSB1c2luZyBpbnZhbGlkIHJlc291cmNlIHR5cGVcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IG1lZHBsdW1TZXJ2aWNlLnJlYWRSZXNvdXJjZSgnSW52YWxpZFJlc291cmNlVHlwZScgYXMgYW55LCAnaW52YWxpZC1pZCcpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZXhwZWN0KGVycm9yKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9Db250YWluKCdGSElSIEVycm9yJyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIHZhbGlkYXRpb24gZXJyb3JzIGZvciBtYWxmb3JtZWQgcmVzb3VyY2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbWFsZm9ybWVkUmVzb3VyY2UgPSB7XG4gICAgICAgIHJlc291cmNlVHlwZTogJ1BhdGllbnQnLFxuICAgICAgICBuYW1lOiAnVGhpcyBzaG91bGQgYmUgYW4gYXJyYXksIG5vdCBhIHN0cmluZydcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSBhd2FpdCBmaGlyVmFsaWRhdGlvblNlcnZpY2UudmFsaWRhdGVSZXNvdXJjZShtYWxmb3JtZWRSZXNvdXJjZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGlvblJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGlvblJlc3VsdC5lcnJvcnMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIG5ldHdvcmsgdGltZW91dHMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3QgdGltZW91dCBoYW5kbGluZyBieSB1c2luZyB2ZXJ5IGxvbmcgc2VhcmNoXG4gICAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSB7XG4gICAgICAgIF9jb3VudDogMTAwMDAwMCxcbiAgICAgICAgX3NvcnQ6ICduYW1lJ1xuICAgICAgfTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGZoaXJSZXNvdXJjZXNTZXJ2aWNlLnNlYXJjaFBhdGllbnRzKHNlYXJjaFBhcmFtcyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHRzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gVGltZW91dCBvciBvdGhlciBuZXR3b3JrIGVycm9yIGlzIGFjY2VwdGFibGVcbiAgICAgICAgZXhwZWN0KGVycm9yKS50b0JlRGVmaW5lZCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2UgYW5kIExvYWQgVGVzdGluZycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgcGF0aWVudCBjcmVhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhdGllbnRQcm9taXNlcyA9IEFycmF5KDUpLmZpbGwoMCkubWFwKChfLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHBhdGllbnREYXRhID0ge1xuICAgICAgICAgIG5hbWU6IFt7IGdpdmVuOiBbJ0NvbmN1cnJlbnQnXSwgZmFtaWx5OiBgVGVzdCR7aX1gIH1dLFxuICAgICAgICAgIGdlbmRlcjogJ3Vua25vd24nIGFzIGNvbnN0LFxuICAgICAgICAgIGJpcnRoRGF0ZTogJzE5OTAtMDEtMDEnXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBmaGlyUmVzb3VyY2VzU2VydmljZS5jcmVhdGVQYXRpZW50KHBhdGllbnREYXRhKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBwYXRpZW50cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChwYXRpZW50UHJvbWlzZXMpO1xuICAgICAgY29uc3Qgc3VjY2Vzc2Z1bFBhdGllbnRzID0gcGF0aWVudHMuZmlsdGVyKHAgPT4gcC5zdGF0dXMgPT09ICdmdWxmaWxsZWQnKTtcbiAgICAgIGV4cGVjdChzdWNjZXNzZnVsUGF0aWVudHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGxhcmdlIHNlYXJjaCByZXN1bHQgc2V0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlYXJjaFBhcmFtcyA9IHtcbiAgICAgICAgX2NvdW50OiAxMDAsXG4gICAgICAgIGFjdGl2ZTogJ3RydWUnXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGZoaXJSZXNvdXJjZXNTZXJ2aWNlLnNlYXJjaFBhdGllbnRzKHNlYXJjaFBhcmFtcyk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdHMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZW5kVGltZSAtIHN0YXJ0VGltZSkudG9CZUxlc3NUaGFuKDEwMDAwKTsgLy8gU2hvdWxkIGNvbXBsZXRlIHdpdGhpbiAxMCBzZWNvbmRzXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIEhlbHBlciBmdW5jdGlvbnNcbiAgYXN5bmMgZnVuY3Rpb24gc2V0dXBUZXN0RGF0YSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ3JlYXRlIHRlc3QgcHJhY3RpdGlvbmVyXG4gICAgICBjb25zdCBwcmFjdGl0aW9uZXJEYXRhID0ge1xuICAgICAgICBuYW1lOiBbeyBnaXZlbjogWydUZXN0J10sIGZhbWlseTogJ1ByYWN0aXRpb25lcicgfV0sXG4gICAgICAgIGlkZW50aWZpZXI6IFt7XG4gICAgICAgICAgc3lzdGVtOiAnaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvdXMtbnBpJyxcbiAgICAgICAgICB2YWx1ZTogJzEyMzQ1Njc4OTAnXG4gICAgICAgIH1dXG4gICAgICB9O1xuICAgICAgY29uc3QgcHJhY3RpdGlvbmVyID0gYXdhaXQgZmhpclJlc291cmNlc1NlcnZpY2UuY3JlYXRlUHJhY3RpdGlvbmVyKHByYWN0aXRpb25lckRhdGEpO1xuICAgICAgdGVzdFByYWN0aXRpb25lcklkID0gcHJhY3RpdGlvbmVyLmlkITtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ0ZhaWxlZCB0byBzZXR1cCB0ZXN0IGRhdGE6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZ1bmN0aW9uIGNsZWFudXBUZXN0RGF0YSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2xlYW51cCBpcyBoYW5kbGVkIGJ5IHRoZSB0ZXN0IGVudmlyb25tZW50XG4gICAgICAvLyBJbiBwcm9kdWN0aW9uLCB5b3Ugd291bGQgZGVsZXRlIHRlc3QgcmVzb3VyY2VzIGhlcmVcbiAgICAgIGlmICh0ZXN0UGF0aWVudElkKSB7XG4gICAgICAgIGF3YWl0IG1lZHBsdW1TZXJ2aWNlLmRlbGV0ZVJlc291cmNlKCdQYXRpZW50JywgdGVzdFBhdGllbnRJZCk7XG4gICAgICB9XG4gICAgICBpZiAodGVzdEVuY291bnRlcklkKSB7XG4gICAgICAgIGF3YWl0IG1lZHBsdW1TZXJ2aWNlLmRlbGV0ZVJlc291cmNlKCdFbmNvdW50ZXInLCB0ZXN0RW5jb3VudGVySWQpO1xuICAgICAgfVxuICAgICAgaWYgKHRlc3RQcmFjdGl0aW9uZXJJZCkge1xuICAgICAgICBhd2FpdCBtZWRwbHVtU2VydmljZS5kZWxldGVSZXNvdXJjZSgnUHJhY3RpdGlvbmVyJywgdGVzdFByYWN0aXRpb25lcklkKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ0ZhaWxlZCB0byBjbGVhbnVwIHRlc3QgZGF0YTonLCBlcnJvcik7XG4gICAgfVxuICB9XG59KTsiXSwidmVyc2lvbiI6M30=