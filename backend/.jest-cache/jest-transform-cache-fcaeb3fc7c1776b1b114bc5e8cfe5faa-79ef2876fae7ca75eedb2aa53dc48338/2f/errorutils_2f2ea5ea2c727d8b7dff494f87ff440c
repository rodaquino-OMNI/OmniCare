24f1e1f371794da2bd5a38b7e032ca69
"use strict";
/**
 * Error handling utilities for TypeScript
 * Provides type-safe error handling with proper type guards
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.isError = isError;
exports.hasMessage = hasMessage;
exports.hasCode = hasCode;
exports.getErrorMessage = getErrorMessage;
exports.getErrorCode = getErrorCode;
exports.getErrorStack = getErrorStack;
exports.normalizeError = normalizeError;
exports.isErrorType = isErrorType;
exports.isFHIRError = isFHIRError;
exports.getFHIRErrorMessage = getFHIRErrorMessage;
exports.withErrorHandling = withErrorHandling;
/**
 * Type guard to check if a value is an Error instance
 * @param value - The value to check
 * @returns True if the value is an Error instance
 */
function isError(value) {
    return (value instanceof Error ||
        (typeof value === 'object' &&
            value !== null &&
            'message' in value &&
            'name' in value &&
            typeof value.message === 'string' &&
            typeof value.name === 'string'));
}
/**
 * Type guard to check if a value has a message property
 * @param value - The value to check
 * @returns True if the value has a message property
 */
function hasMessage(value) {
    return (typeof value === 'object' &&
        value !== null &&
        'message' in value &&
        typeof value.message === 'string');
}
/**
 * Type guard to check if a value has a code property
 * @param value - The value to check
 * @returns True if the value has a code property
 */
function hasCode(value) {
    return (typeof value === 'object' &&
        value !== null &&
        'code' in value &&
        typeof value.code === 'string');
}
/**
 * Safely extract error message from unknown error type
 * @param error - The error to extract message from
 * @returns A string error message
 */
function getErrorMessage(error) {
    if (isError(error)) {
        return error.message;
    }
    if (hasMessage(error)) {
        return error.message;
    }
    if (typeof error === 'string') {
        return error;
    }
    return String(error);
}
/**
 * Safely extract error code from unknown error type
 * @param error - The error to extract code from
 * @returns The error code if available, undefined otherwise
 */
function getErrorCode(error) {
    if (hasCode(error)) {
        return error.code;
    }
    if (isError(error) && 'code' in error) {
        return error.code;
    }
    return undefined;
}
/**
 * Safely extract stack trace from unknown error type
 * @param error - The error to extract stack from
 * @returns The stack trace if available, undefined otherwise
 */
function getErrorStack(error) {
    if (isError(error)) {
        return error.stack;
    }
    if (typeof error === 'object' && error !== null && 'stack' in error && typeof error.stack === 'string') {
        return error.stack;
    }
    return undefined;
}
/**
 * Create a normalized error object from unknown error type
 * @param error - The error to normalize
 * @param context - Optional context to add to the error
 * @returns A normalized error object
 */
function normalizeError(error, context) {
    return {
        message: getErrorMessage(error),
        code: getErrorCode(error),
        stack: getErrorStack(error),
        context
    };
}
/**
 * Check if an error is a specific type of error
 * @param error - The error to check
 * @param errorType - The error constructor to check against
 * @returns True if the error is of the specified type
 */
function isErrorType(error, errorType) {
    return error instanceof errorType;
}
/**
 * Check if an error is a FHIR error
 * @param error - The error to check
 * @returns True if the error is a FHIR error
 */
function isFHIRError(error) {
    if (typeof error !== 'object' || error === null) {
        return false;
    }
    const err = error;
    return ((err.outcome && Array.isArray(err.outcome.issue)) ||
        (err.response?.data?.resourceType === 'OperationOutcome'));
}
/**
 * Extract error message from FHIR error
 * @param error - The FHIR error
 * @returns The error message
 */
function getFHIRErrorMessage(error) {
    if (error.outcome?.issue?.[0]) {
        const issue = error.outcome.issue[0];
        return issue.diagnostics || issue.details?.text || 'FHIR operation failed';
    }
    if (error.response?.data?.issue?.[0]) {
        const issue = error.response.data.issue[0];
        return issue.diagnostics || issue.details?.text || 'FHIR operation failed';
    }
    return 'FHIR operation failed';
}
/**
 * Handle errors in async functions with proper typing
 * @param fn - The async function to wrap
 * @returns A wrapped function that handles errors
 */
function withErrorHandling(fn, errorHandler) {
    return (async (...args) => {
        try {
            return await fn(...args);
        }
        catch (error) {
            if (errorHandler) {
                errorHandler(error);
            }
            throw error;
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvc3JjL3V0aWxzL2Vycm9yLnV0aWxzLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBT0gsMEJBWUM7QUFPRCxnQ0FPQztBQU9ELDBCQU9DO0FBT0QsMENBY0M7QUFPRCxvQ0FVQztBQU9ELHNDQVVDO0FBUUQsd0NBWUM7QUFRRCxrQ0FLQztBQWdDRCxrQ0FVQztBQU9ELGtEQVlDO0FBT0QsOENBY0M7QUF2TkQ7Ozs7R0FJRztBQUNILFNBQWdCLE9BQU8sQ0FBQyxLQUFjO0lBQ3BDLE9BQU8sQ0FDTCxLQUFLLFlBQVksS0FBSztRQUN0QixDQUNFLE9BQU8sS0FBSyxLQUFLLFFBQVE7WUFDekIsS0FBSyxLQUFLLElBQUk7WUFDZCxTQUFTLElBQUksS0FBSztZQUNsQixNQUFNLElBQUksS0FBSztZQUNmLE9BQVEsS0FBYSxDQUFDLE9BQU8sS0FBSyxRQUFRO1lBQzFDLE9BQVEsS0FBYSxDQUFDLElBQUksS0FBSyxRQUFRLENBQ3hDLENBQ0YsQ0FBQztBQUNKLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsU0FBZ0IsVUFBVSxDQUFDLEtBQWM7SUFDdkMsT0FBTyxDQUNMLE9BQU8sS0FBSyxLQUFLLFFBQVE7UUFDekIsS0FBSyxLQUFLLElBQUk7UUFDZCxTQUFTLElBQUksS0FBSztRQUNsQixPQUFRLEtBQWEsQ0FBQyxPQUFPLEtBQUssUUFBUSxDQUMzQyxDQUFDO0FBQ0osQ0FBQztBQUVEOzs7O0dBSUc7QUFDSCxTQUFnQixPQUFPLENBQUMsS0FBYztJQUNwQyxPQUFPLENBQ0wsT0FBTyxLQUFLLEtBQUssUUFBUTtRQUN6QixLQUFLLEtBQUssSUFBSTtRQUNkLE1BQU0sSUFBSSxLQUFLO1FBQ2YsT0FBUSxLQUFhLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FDeEMsQ0FBQztBQUNKLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsU0FBZ0IsZUFBZSxDQUFDLEtBQWM7SUFDNUMsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUNuQixPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUM7SUFDdkIsQ0FBQztJQUVELElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDdEIsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQzlCLE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVELE9BQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3ZCLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsU0FBZ0IsWUFBWSxDQUFDLEtBQWM7SUFDekMsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUNuQixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUM7SUFDcEIsQ0FBQztJQUVELElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLE1BQU0sSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUN0QyxPQUFRLEtBQWEsQ0FBQyxJQUFJLENBQUM7SUFDN0IsQ0FBQztJQUVELE9BQU8sU0FBUyxDQUFDO0FBQ25CLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsU0FBZ0IsYUFBYSxDQUFDLEtBQWM7SUFDMUMsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUNuQixPQUFPLEtBQUssQ0FBQyxLQUFLLENBQUM7SUFDckIsQ0FBQztJQUVELElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxJQUFJLEtBQUssS0FBSyxJQUFJLElBQUksT0FBTyxJQUFJLEtBQUssSUFBSSxPQUFRLEtBQWEsQ0FBQyxLQUFLLEtBQUssUUFBUSxFQUFFLENBQUM7UUFDaEgsT0FBUSxLQUFhLENBQUMsS0FBSyxDQUFDO0lBQzlCLENBQUM7SUFFRCxPQUFPLFNBQVMsQ0FBQztBQUNuQixDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSCxTQUFnQixjQUFjLENBQUMsS0FBYyxFQUFFLE9BQWdCO0lBTTdELE9BQU87UUFDTCxPQUFPLEVBQUUsZUFBZSxDQUFDLEtBQUssQ0FBQztRQUMvQixJQUFJLEVBQUUsWUFBWSxDQUFDLEtBQUssQ0FBQztRQUN6QixLQUFLLEVBQUUsYUFBYSxDQUFDLEtBQUssQ0FBQztRQUMzQixPQUFPO0tBQ1IsQ0FBQztBQUNKLENBQUM7QUFFRDs7Ozs7R0FLRztBQUNILFNBQWdCLFdBQVcsQ0FDekIsS0FBYyxFQUNkLFNBQW9DO0lBRXBDLE9BQU8sS0FBSyxZQUFZLFNBQVMsQ0FBQztBQUNwQyxDQUFDO0FBMkJEOzs7O0dBSUc7QUFDSCxTQUFnQixXQUFXLENBQUMsS0FBYztJQUN4QyxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsSUFBSSxLQUFLLEtBQUssSUFBSSxFQUFFLENBQUM7UUFDaEQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsTUFBTSxHQUFHLEdBQUcsS0FBWSxDQUFDO0lBQ3pCLE9BQU8sQ0FDTCxDQUFDLEdBQUcsQ0FBQyxPQUFPLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2pELENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsWUFBWSxLQUFLLGtCQUFrQixDQUFDLENBQzFELENBQUM7QUFDSixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILFNBQWdCLG1CQUFtQixDQUFDLEtBQWdCO0lBQ2xELElBQUksS0FBSyxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQzlCLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JDLE9BQU8sS0FBSyxDQUFDLFdBQVcsSUFBSSxLQUFLLENBQUMsT0FBTyxFQUFFLElBQUksSUFBSSx1QkFBdUIsQ0FBQztJQUM3RSxDQUFDO0lBRUQsSUFBSSxLQUFLLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ3JDLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQyxPQUFPLEtBQUssQ0FBQyxXQUFXLElBQUksS0FBSyxDQUFDLE9BQU8sRUFBRSxJQUFJLElBQUksdUJBQXVCLENBQUM7SUFDN0UsQ0FBQztJQUVELE9BQU8sdUJBQXVCLENBQUM7QUFDakMsQ0FBQztBQUVEOzs7O0dBSUc7QUFDSCxTQUFnQixpQkFBaUIsQ0FDL0IsRUFBSyxFQUNMLFlBQXVDO0lBRXZDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsR0FBRyxJQUFtQixFQUFFLEVBQUU7UUFDdkMsSUFBSSxDQUFDO1lBQ0gsT0FBTyxNQUFNLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQzNCLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxZQUFZLEVBQUUsQ0FBQztnQkFDakIsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3RCLENBQUM7WUFDRCxNQUFNLEtBQUssQ0FBQztRQUNkLENBQUM7SUFDSCxDQUFDLENBQU0sQ0FBQztBQUNWLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvc3JjL3V0aWxzL2Vycm9yLnV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRXJyb3IgaGFuZGxpbmcgdXRpbGl0aWVzIGZvciBUeXBlU2NyaXB0XG4gKiBQcm92aWRlcyB0eXBlLXNhZmUgZXJyb3IgaGFuZGxpbmcgd2l0aCBwcm9wZXIgdHlwZSBndWFyZHNcbiAqL1xuXG4vKipcbiAqIFR5cGUgZ3VhcmQgdG8gY2hlY2sgaWYgYSB2YWx1ZSBpcyBhbiBFcnJvciBpbnN0YW5jZVxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHRvIGNoZWNrXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB2YWx1ZSBpcyBhbiBFcnJvciBpbnN0YW5jZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNFcnJvcih2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIEVycm9yIHtcbiAgcmV0dXJuIChcbiAgICB2YWx1ZSBpbnN0YW5jZW9mIEVycm9yIHx8XG4gICAgKFxuICAgICAgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJlxuICAgICAgdmFsdWUgIT09IG51bGwgJiZcbiAgICAgICdtZXNzYWdlJyBpbiB2YWx1ZSAmJlxuICAgICAgJ25hbWUnIGluIHZhbHVlICYmXG4gICAgICB0eXBlb2YgKHZhbHVlIGFzIGFueSkubWVzc2FnZSA9PT0gJ3N0cmluZycgJiZcbiAgICAgIHR5cGVvZiAodmFsdWUgYXMgYW55KS5uYW1lID09PSAnc3RyaW5nJ1xuICAgIClcbiAgKTtcbn1cblxuLyoqXG4gKiBUeXBlIGd1YXJkIHRvIGNoZWNrIGlmIGEgdmFsdWUgaGFzIGEgbWVzc2FnZSBwcm9wZXJ0eVxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHRvIGNoZWNrXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB2YWx1ZSBoYXMgYSBtZXNzYWdlIHByb3BlcnR5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoYXNNZXNzYWdlKHZhbHVlOiB1bmtub3duKTogdmFsdWUgaXMgeyBtZXNzYWdlOiBzdHJpbmcgfSB7XG4gIHJldHVybiAoXG4gICAgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJlxuICAgIHZhbHVlICE9PSBudWxsICYmXG4gICAgJ21lc3NhZ2UnIGluIHZhbHVlICYmXG4gICAgdHlwZW9mICh2YWx1ZSBhcyBhbnkpLm1lc3NhZ2UgPT09ICdzdHJpbmcnXG4gICk7XG59XG5cbi8qKlxuICogVHlwZSBndWFyZCB0byBjaGVjayBpZiBhIHZhbHVlIGhhcyBhIGNvZGUgcHJvcGVydHlcbiAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBjaGVja1xuICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgdmFsdWUgaGFzIGEgY29kZSBwcm9wZXJ0eVxuICovXG5leHBvcnQgZnVuY3Rpb24gaGFzQ29kZSh2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIHsgY29kZTogc3RyaW5nIH0ge1xuICByZXR1cm4gKFxuICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiZcbiAgICB2YWx1ZSAhPT0gbnVsbCAmJlxuICAgICdjb2RlJyBpbiB2YWx1ZSAmJlxuICAgIHR5cGVvZiAodmFsdWUgYXMgYW55KS5jb2RlID09PSAnc3RyaW5nJ1xuICApO1xufVxuXG4vKipcbiAqIFNhZmVseSBleHRyYWN0IGVycm9yIG1lc3NhZ2UgZnJvbSB1bmtub3duIGVycm9yIHR5cGVcbiAqIEBwYXJhbSBlcnJvciAtIFRoZSBlcnJvciB0byBleHRyYWN0IG1lc3NhZ2UgZnJvbVxuICogQHJldHVybnMgQSBzdHJpbmcgZXJyb3IgbWVzc2FnZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RXJyb3JNZXNzYWdlKGVycm9yOiB1bmtub3duKTogc3RyaW5nIHtcbiAgaWYgKGlzRXJyb3IoZXJyb3IpKSB7XG4gICAgcmV0dXJuIGVycm9yLm1lc3NhZ2U7XG4gIH1cbiAgXG4gIGlmIChoYXNNZXNzYWdlKGVycm9yKSkge1xuICAgIHJldHVybiBlcnJvci5tZXNzYWdlO1xuICB9XG4gIFxuICBpZiAodHlwZW9mIGVycm9yID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBlcnJvcjtcbiAgfVxuICBcbiAgcmV0dXJuIFN0cmluZyhlcnJvcik7XG59XG5cbi8qKlxuICogU2FmZWx5IGV4dHJhY3QgZXJyb3IgY29kZSBmcm9tIHVua25vd24gZXJyb3IgdHlwZVxuICogQHBhcmFtIGVycm9yIC0gVGhlIGVycm9yIHRvIGV4dHJhY3QgY29kZSBmcm9tXG4gKiBAcmV0dXJucyBUaGUgZXJyb3IgY29kZSBpZiBhdmFpbGFibGUsIHVuZGVmaW5lZCBvdGhlcndpc2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEVycm9yQ29kZShlcnJvcjogdW5rbm93bik6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gIGlmIChoYXNDb2RlKGVycm9yKSkge1xuICAgIHJldHVybiBlcnJvci5jb2RlO1xuICB9XG4gIFxuICBpZiAoaXNFcnJvcihlcnJvcikgJiYgJ2NvZGUnIGluIGVycm9yKSB7XG4gICAgcmV0dXJuIChlcnJvciBhcyBhbnkpLmNvZGU7XG4gIH1cbiAgXG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogU2FmZWx5IGV4dHJhY3Qgc3RhY2sgdHJhY2UgZnJvbSB1bmtub3duIGVycm9yIHR5cGVcbiAqIEBwYXJhbSBlcnJvciAtIFRoZSBlcnJvciB0byBleHRyYWN0IHN0YWNrIGZyb21cbiAqIEByZXR1cm5zIFRoZSBzdGFjayB0cmFjZSBpZiBhdmFpbGFibGUsIHVuZGVmaW5lZCBvdGhlcndpc2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEVycm9yU3RhY2soZXJyb3I6IHVua25vd24pOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICBpZiAoaXNFcnJvcihlcnJvcikpIHtcbiAgICByZXR1cm4gZXJyb3Iuc3RhY2s7XG4gIH1cbiAgXG4gIGlmICh0eXBlb2YgZXJyb3IgPT09ICdvYmplY3QnICYmIGVycm9yICE9PSBudWxsICYmICdzdGFjaycgaW4gZXJyb3IgJiYgdHlwZW9mIChlcnJvciBhcyBhbnkpLnN0YWNrID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiAoZXJyb3IgYXMgYW55KS5zdGFjaztcbiAgfVxuICBcbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBub3JtYWxpemVkIGVycm9yIG9iamVjdCBmcm9tIHVua25vd24gZXJyb3IgdHlwZVxuICogQHBhcmFtIGVycm9yIC0gVGhlIGVycm9yIHRvIG5vcm1hbGl6ZVxuICogQHBhcmFtIGNvbnRleHQgLSBPcHRpb25hbCBjb250ZXh0IHRvIGFkZCB0byB0aGUgZXJyb3JcbiAqIEByZXR1cm5zIEEgbm9ybWFsaXplZCBlcnJvciBvYmplY3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUVycm9yKGVycm9yOiB1bmtub3duLCBjb250ZXh0Pzogc3RyaW5nKToge1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGNvZGU/OiBzdHJpbmc7XG4gIHN0YWNrPzogc3RyaW5nO1xuICBjb250ZXh0Pzogc3RyaW5nO1xufSB7XG4gIHJldHVybiB7XG4gICAgbWVzc2FnZTogZ2V0RXJyb3JNZXNzYWdlKGVycm9yKSxcbiAgICBjb2RlOiBnZXRFcnJvckNvZGUoZXJyb3IpLFxuICAgIHN0YWNrOiBnZXRFcnJvclN0YWNrKGVycm9yKSxcbiAgICBjb250ZXh0XG4gIH07XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYW4gZXJyb3IgaXMgYSBzcGVjaWZpYyB0eXBlIG9mIGVycm9yXG4gKiBAcGFyYW0gZXJyb3IgLSBUaGUgZXJyb3IgdG8gY2hlY2tcbiAqIEBwYXJhbSBlcnJvclR5cGUgLSBUaGUgZXJyb3IgY29uc3RydWN0b3IgdG8gY2hlY2sgYWdhaW5zdFxuICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgZXJyb3IgaXMgb2YgdGhlIHNwZWNpZmllZCB0eXBlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0Vycm9yVHlwZTxUIGV4dGVuZHMgRXJyb3I+KFxuICBlcnJvcjogdW5rbm93biwgXG4gIGVycm9yVHlwZTogbmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gVFxuKTogZXJyb3IgaXMgVCB7XG4gIHJldHVybiBlcnJvciBpbnN0YW5jZW9mIGVycm9yVHlwZTtcbn1cblxuLyoqXG4gKiBGSElSLXNwZWNpZmljIGVycm9yIGhhbmRsaW5nXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRkhJUkVycm9yIHtcbiAgb3V0Y29tZT86IHtcbiAgICBpc3N1ZT86IEFycmF5PHtcbiAgICAgIGRpYWdub3N0aWNzPzogc3RyaW5nO1xuICAgICAgZGV0YWlscz86IHtcbiAgICAgICAgdGV4dD86IHN0cmluZztcbiAgICAgIH07XG4gICAgfT47XG4gIH07XG4gIHJlc3BvbnNlPzoge1xuICAgIGRhdGE/OiB7XG4gICAgICByZXNvdXJjZVR5cGU/OiBzdHJpbmc7XG4gICAgICBpc3N1ZT86IEFycmF5PHtcbiAgICAgICAgZGlhZ25vc3RpY3M/OiBzdHJpbmc7XG4gICAgICAgIGRldGFpbHM/OiB7XG4gICAgICAgICAgdGV4dD86IHN0cmluZztcbiAgICAgICAgfTtcbiAgICAgIH0+O1xuICAgIH07XG4gIH07XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYW4gZXJyb3IgaXMgYSBGSElSIGVycm9yXG4gKiBAcGFyYW0gZXJyb3IgLSBUaGUgZXJyb3IgdG8gY2hlY2tcbiAqIEByZXR1cm5zIFRydWUgaWYgdGhlIGVycm9yIGlzIGEgRkhJUiBlcnJvclxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNGSElSRXJyb3IoZXJyb3I6IHVua25vd24pOiBlcnJvciBpcyBGSElSRXJyb3Ige1xuICBpZiAodHlwZW9mIGVycm9yICE9PSAnb2JqZWN0JyB8fCBlcnJvciA9PT0gbnVsbCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgY29uc3QgZXJyID0gZXJyb3IgYXMgYW55O1xuICByZXR1cm4gKFxuICAgIChlcnIub3V0Y29tZSAmJiBBcnJheS5pc0FycmF5KGVyci5vdXRjb21lLmlzc3VlKSkgfHxcbiAgICAoZXJyLnJlc3BvbnNlPy5kYXRhPy5yZXNvdXJjZVR5cGUgPT09ICdPcGVyYXRpb25PdXRjb21lJylcbiAgKTtcbn1cblxuLyoqXG4gKiBFeHRyYWN0IGVycm9yIG1lc3NhZ2UgZnJvbSBGSElSIGVycm9yXG4gKiBAcGFyYW0gZXJyb3IgLSBUaGUgRkhJUiBlcnJvclxuICogQHJldHVybnMgVGhlIGVycm9yIG1lc3NhZ2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEZISVJFcnJvck1lc3NhZ2UoZXJyb3I6IEZISVJFcnJvcik6IHN0cmluZyB7XG4gIGlmIChlcnJvci5vdXRjb21lPy5pc3N1ZT8uWzBdKSB7XG4gICAgY29uc3QgaXNzdWUgPSBlcnJvci5vdXRjb21lLmlzc3VlWzBdO1xuICAgIHJldHVybiBpc3N1ZS5kaWFnbm9zdGljcyB8fCBpc3N1ZS5kZXRhaWxzPy50ZXh0IHx8ICdGSElSIG9wZXJhdGlvbiBmYWlsZWQnO1xuICB9XG4gIFxuICBpZiAoZXJyb3IucmVzcG9uc2U/LmRhdGE/Lmlzc3VlPy5bMF0pIHtcbiAgICBjb25zdCBpc3N1ZSA9IGVycm9yLnJlc3BvbnNlLmRhdGEuaXNzdWVbMF07XG4gICAgcmV0dXJuIGlzc3VlLmRpYWdub3N0aWNzIHx8IGlzc3VlLmRldGFpbHM/LnRleHQgfHwgJ0ZISVIgb3BlcmF0aW9uIGZhaWxlZCc7XG4gIH1cbiAgXG4gIHJldHVybiAnRkhJUiBvcGVyYXRpb24gZmFpbGVkJztcbn1cblxuLyoqXG4gKiBIYW5kbGUgZXJyb3JzIGluIGFzeW5jIGZ1bmN0aW9ucyB3aXRoIHByb3BlciB0eXBpbmdcbiAqIEBwYXJhbSBmbiAtIFRoZSBhc3luYyBmdW5jdGlvbiB0byB3cmFwXG4gKiBAcmV0dXJucyBBIHdyYXBwZWQgZnVuY3Rpb24gdGhhdCBoYW5kbGVzIGVycm9yc1xuICovXG5leHBvcnQgZnVuY3Rpb24gd2l0aEVycm9ySGFuZGxpbmc8VCBleHRlbmRzICguLi5hcmdzOiBhbnlbXSkgPT4gUHJvbWlzZTxhbnk+PihcbiAgZm46IFQsXG4gIGVycm9ySGFuZGxlcj86IChlcnJvcjogdW5rbm93bikgPT4gdm9pZFxuKTogVCB7XG4gIHJldHVybiAoYXN5bmMgKC4uLmFyZ3M6IFBhcmFtZXRlcnM8VD4pID0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGZuKC4uLmFyZ3MpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3JIYW5kbGVyKSB7XG4gICAgICAgIGVycm9ySGFuZGxlcihlcnJvcik7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH0pIGFzIFQ7XG59Il0sInZlcnNpb24iOjN9