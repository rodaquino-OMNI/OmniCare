3f1504eb5a99c089d4994f0870d4e095
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = __importDefault(require("path"));
const winston_1 = __importDefault(require("winston"));
const config_1 = __importDefault(require("../config"));
// Custom format for structured logging
const customFormat = winston_1.default.format.combine(winston_1.default.format.timestamp({
    format: 'YYYY-MM-DD HH:mm:ss',
}), winston_1.default.format.errors({ stack: true }), winston_1.default.format.json(), winston_1.default.format.printf(({ level, message, timestamp, stack, ...meta }) => {
    let logMessage = `${timestamp} [${level.toUpperCase()}]: ${message}`;
    if (Object.keys(meta).length > 0) {
        logMessage += ` ${JSON.stringify(meta)}`;
    }
    if (stack) {
        logMessage += `\n${stack}`;
    }
    return logMessage;
}));
// Console format for development
const consoleFormat = winston_1.default.format.combine(winston_1.default.format.timestamp({
    format: 'HH:mm:ss',
}), winston_1.default.format.colorize(), winston_1.default.format.printf(({ level, message, timestamp, ...meta }) => {
    let logMessage = `${timestamp} ${level}: ${message}`;
    if (Object.keys(meta).length > 0) {
        logMessage += ` ${JSON.stringify(meta, null, 2)}`;
    }
    return logMessage;
}));
// Create transports array
const transports = [];
// Console transport for all environments
transports.push(new winston_1.default.transports.Console({
    level: config_1.default.server.env === 'development' ? 'debug' : 'info',
    format: config_1.default.server.env === 'development' ? consoleFormat : customFormat,
    handleExceptions: true,
    handleRejections: true,
}));
// File transport for production
if (config_1.default.server.env === 'production') {
    // Ensure logs directory exists
    const logDir = path_1.default.dirname(config_1.default.logging.file);
    transports.push(
    // General log file
    new winston_1.default.transports.File({
        filename: config_1.default.logging.file,
        level: config_1.default.logging.level,
        format: customFormat,
        maxsize: 10 * 1024 * 1024, // 10MB
        maxFiles: 5,
        tailable: true,
        handleExceptions: true,
        handleRejections: true,
    }), 
    // Error log file
    new winston_1.default.transports.File({
        filename: path_1.default.join(logDir, 'error.log'),
        level: 'error',
        format: customFormat,
        maxsize: 10 * 1024 * 1024, // 10MB
        maxFiles: 5,
        tailable: true,
        handleExceptions: true,
        handleRejections: true,
    }));
}
// Create the logger instance
const logger = winston_1.default.createLogger({
    level: config_1.default.logging.level,
    format: customFormat,
    transports,
    exitOnError: false,
});
// Extend logger with custom methods
const customLogger = logger;
customLogger.fhir = (message, meta) => {
    logger.info(message, { context: 'FHIR', ...meta });
};
customLogger.security = (message, meta) => {
    logger.warn(message, { context: 'SECURITY', ...meta });
};
customLogger.performance = (message, meta) => {
    logger.info(message, { context: 'PERFORMANCE', ...meta });
};
customLogger.audit = (message, meta) => {
    logger.info(message, { context: 'AUDIT', ...meta });
};
customLogger.integration = (message, meta) => {
    logger.info(message, { context: 'INTEGRATION', ...meta });
};
// Handle uncaught exceptions and rejections
process.on('uncaughtException', (error) => {
    logger.error('Uncaught Exception:', error);
    process.exit(1);
});
process.on('unhandledRejection', (reason, promise) => {
    logger.error('Unhandled Rejection at:', promise, 'reason:', reason);
    process.exit(1);
});
exports.default = customLogger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvc3JjL3V0aWxzL2xvZ2dlci50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLGdEQUF3QjtBQUV4QixzREFBOEI7QUFFOUIsdURBQStCO0FBRS9CLHVDQUF1QztBQUN2QyxNQUFNLFlBQVksR0FBRyxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQ3pDLGlCQUFPLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUN2QixNQUFNLEVBQUUscUJBQXFCO0NBQzlCLENBQUMsRUFDRixpQkFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFDdEMsaUJBQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQ3JCLGlCQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLEdBQUcsSUFBSSxFQUFFLEVBQUUsRUFBRTtJQUN0RSxJQUFJLFVBQVUsR0FBRyxHQUFHLFNBQVMsS0FBSyxLQUFLLENBQUMsV0FBVyxFQUFFLE1BQU0sT0FBTyxFQUFFLENBQUM7SUFFckUsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUNqQyxVQUFVLElBQUksSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7SUFDM0MsQ0FBQztJQUVELElBQUksS0FBSyxFQUFFLENBQUM7UUFDVixVQUFVLElBQUksS0FBSyxLQUFLLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRUQsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQyxDQUFDLENBQ0gsQ0FBQztBQUVGLGlDQUFpQztBQUNqQyxNQUFNLGFBQWEsR0FBRyxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQzFDLGlCQUFPLENBQUMsTUFBTSxDQUFD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TSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUMzQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2xCLENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLEVBQUUsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsRUFBRTtJQUNuRCxNQUFNLENBQUMsS0FBSyxDQUFDLHlCQUF5QixFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDcEUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNsQixDQUFDLENBQUMsQ0FBQztBQUVILGtCQUFlLFlBQVksQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnby9jbGF1ZGUtcHJvamVjdHMvT21uaUNhcmUvYmFja2VuZC9zcmMvdXRpbHMvbG9nZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5pbXBvcnQgd2luc3RvbiBmcm9tICd3aW5zdG9uJztcblxuaW1wb3J0IGNvbmZpZyBmcm9tICcuLi9jb25maWcnO1xuXG4vLyBDdXN0b20gZm9ybWF0IGZvciBzdHJ1Y3R1cmVkIGxvZ2dpbmdcbmNvbnN0IGN1c3RvbUZvcm1hdCA9IHdpbnN0b24uZm9ybWF0LmNvbWJpbmUoXG4gIHdpbnN0b24uZm9ybWF0LnRpbWVzdGFtcCh7XG4gICAgZm9ybWF0OiAnWVlZWS1NTS1ERCBISDptbTpzcycsXG4gIH0pLFxuICB3aW5zdG9uLmZvcm1hdC5lcnJvcnMoeyBzdGFjazogdHJ1ZSB9KSxcbiAgd2luc3Rvbi5mb3JtYXQuanNvbigpLFxuICB3aW5zdG9uLmZvcm1hdC5wcmludGYoKHsgbGV2ZWwsIG1lc3NhZ2UsIHRpbWVzdGFtcCwgc3RhY2ssIC4uLm1ldGEgfSkgPT4ge1xuICAgIGxldCBsb2dNZXNzYWdlID0gYCR7dGltZXN0YW1wfSBbJHtsZXZlbC50b1VwcGVyQ2FzZSgpfV06ICR7bWVzc2FnZX1gO1xuICAgIFxuICAgIGlmIChPYmplY3Qua2V5cyhtZXRhKS5sZW5ndGggPiAwKSB7XG4gICAgICBsb2dNZXNzYWdlICs9IGAgJHtKU09OLnN0cmluZ2lmeShtZXRhKX1gO1xuICAgIH1cbiAgICBcbiAgICBpZiAoc3RhY2spIHtcbiAgICAgIGxvZ01lc3NhZ2UgKz0gYFxcbiR7c3RhY2t9YDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGxvZ01lc3NhZ2U7XG4gIH0pXG4pO1xuXG4vLyBDb25zb2xlIGZvcm1hdCBmb3IgZGV2ZWxvcG1lbnRcbmNvbnN0IGNvbnNvbGVGb3JtYXQgPSB3aW5zdG9uLmZvcm1hdC5jb21iaW5lKFxuICB3aW5zdG9uLmZvcm1hdC50aW1lc3RhbXAoe1xuICAgIGZvcm1hdDogJ0hIOm1tOnNzJyxcbiAgfSksXG4gIHdpbnN0b24uZm9ybWF0LmNvbG9yaXplKCksXG4gIHdpbnN0b24uZm9ybWF0LnByaW50ZigoeyBsZXZlbCwgbWVzc2FnZSwgdGltZXN0YW1wLCAuLi5tZXRhIH0pID0+IHtcbiAgICBsZXQgbG9nTWVzc2FnZSA9IGAke3RpbWVzdGFtcH0gJHtsZXZlbH06ICR7bWVzc2FnZX1gO1xuICAgIFxuICAgIGlmIChPYmplY3Qua2V5cyhtZXRhKS5sZW5ndGggPiAwKSB7XG4gICAgICBsb2dNZXNzYWdlICs9IGAgJHtKU09OLnN0cmluZ2lmeShtZXRhLCBudWxsLCAyKX1gO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gbG9nTWVzc2FnZTtcbiAgfSlcbik7XG5cbi8vIENyZWF0ZSB0cmFuc3BvcnRzIGFycmF5XG5jb25zdCB0cmFuc3BvcnRzOiB3aW5zdG9uLnRyYW5zcG9ydFtdID0gW107XG5cbi8vIENvbnNvbGUgdHJhbnNwb3J0IGZvciBhbGwgZW52aXJvbm1lbnRzXG50cmFuc3BvcnRzLnB1c2goXG4gIG5ldyB3aW5zdG9uLnRyYW5zcG9ydHMuQ29uc29sZSh7XG4gICAgbGV2ZWw6IGNvbmZpZy5zZXJ2ZXIuZW52ID09PSAnZGV2ZWxvcG1lbnQnID8gJ2RlYnVnJyA6ICdpbmZvJyxcbiAgICBmb3JtYXQ6IGNvbmZpZy5zZXJ2ZXIuZW52ID09PSAnZGV2ZWxvcG1lbnQnID8gY29uc29sZUZvcm1hdCA6IGN1c3RvbUZvcm1hdCxcbiAgICBoYW5kbGVFeGNlcHRpb25zOiB0cnVlLFxuICAgIGhhbmRsZVJlamVjdGlvbnM6IHRydWUsXG4gIH0pXG4pO1xuXG4vLyBGaWxlIHRyYW5zcG9ydCBmb3IgcHJvZHVjdGlvblxuaWYgKGNvbmZpZy5zZXJ2ZXIuZW52ID09PSAncHJvZHVjdGlvbicpIHtcbiAgLy8gRW5zdXJlIGxvZ3MgZGlyZWN0b3J5IGV4aXN0c1xuICBjb25zdCBsb2dEaXIgPSBwYXRoLmRpcm5hbWUoY29uZmlnLmxvZ2dpbmcuZmlsZSk7XG4gIFxuICB0cmFuc3BvcnRzLnB1c2goXG4gICAgLy8gR2VuZXJhbCBsb2cgZmlsZVxuICAgIG5ldyB3aW5zdG9uLnRyYW5zcG9ydHMuRmlsZSh7XG4gICAgICBmaWxlbmFtZTogY29uZmlnLmxvZ2dpbmcuZmlsZSxcbiAgICAgIGxldmVsOiBjb25maWcubG9nZ2luZy5sZXZlbCxcbiAgICAgIGZvcm1hdDogY3VzdG9tRm9ybWF0LFxuICAgICAgbWF4c2l6ZTogMTAgKiAxMDI0ICogMTAyNCwgLy8gMTBNQlxuICAgICAgbWF4RmlsZXM6IDUsXG4gICAgICB0YWlsYWJsZTogdHJ1ZSxcbiAgICAgIGhhbmRsZUV4Y2VwdGlvbnM6IHRydWUsXG4gICAgICBoYW5kbGVSZWplY3Rpb25zOiB0cnVlLFxuICAgIH0pLFxuICAgIFxuICAgIC8vIEVycm9yIGxvZyBmaWxlXG4gICAgbmV3IHdpbnN0b24udHJhbnNwb3J0cy5GaWxlKHtcbiAgICAgIGZpbGVuYW1lOiBwYXRoLmpvaW4obG9nRGlyLCAnZXJyb3IubG9nJyksXG4gICAgICBsZXZlbDogJ2Vycm9yJyxcbiAgICAgIGZvcm1hdDogY3VzdG9tRm9ybWF0LFxuICAgICAgbWF4c2l6ZTogMTAgKiAxMDI0ICogMTAyNCwgLy8gMTBNQlxuICAgICAgbWF4RmlsZXM6IDUsXG4gICAgICB0YWlsYWJsZTogdHJ1ZSxcbiAgICAgIGhhbmRsZUV4Y2VwdGlvbnM6IHRydWUsXG4gICAgICBoYW5kbGVSZWplY3Rpb25zOiB0cnVlLFxuICAgIH0pXG4gICk7XG59XG5cbi8vIENyZWF0ZSB0aGUgbG9nZ2VyIGluc3RhbmNlXG5jb25zdCBsb2dnZXIgPSB3aW5zdG9uLmNyZWF0ZUxvZ2dlcih7XG4gIGxldmVsOiBjb25maWcubG9nZ2luZy5sZXZlbCxcbiAgZm9ybWF0OiBjdXN0b21Gb3JtYXQsXG4gIHRyYW5zcG9ydHMsXG4gIGV4aXRPbkVycm9yOiBmYWxzZSxcbn0pO1xuXG4vLyBBZGQgY3VzdG9tIGxvZ2dpbmcgbWV0aG9kcyBmb3IgZGlmZmVyZW50IGNvbnRleHRzXG5pbnRlcmZhY2UgQ3VzdG9tTG9nZ2VyIGV4dGVuZHMgd2luc3Rvbi5Mb2dnZXIge1xuICBmaGlyOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB2b2lkO1xuICBzZWN1cml0eTogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4gdm9pZDtcbiAgcGVyZm9ybWFuY2U6IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHZvaWQ7XG4gIGF1ZGl0OiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB2b2lkO1xuICBpbnRlZ3JhdGlvbjogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4gdm9pZDtcbn1cblxuLy8gRXh0ZW5kIGxvZ2dlciB3aXRoIGN1c3RvbSBtZXRob2RzXG5jb25zdCBjdXN0b21Mb2dnZXIgPSBsb2dnZXIgYXMgQ3VzdG9tTG9nZ2VyO1xuXG5jdXN0b21Mb2dnZXIuZmhpciA9IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHtcbiAgbG9nZ2VyLmluZm8obWVzc2FnZSwgeyBjb250ZXh0OiAnRkhJUicsIC4uLm1ldGEgfSk7XG59O1xuXG5jdXN0b21Mb2dnZXIuc2VjdXJpdHkgPSAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB7XG4gIGxvZ2dlci53YXJuKG1lc3NhZ2UsIHsgY29udGV4dDogJ1NFQ1VSSVRZJywgLi4ubWV0YSB9KTtcbn07XG5cbmN1c3RvbUxvZ2dlci5wZXJmb3JtYW5jZSA9IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHtcbiAgbG9nZ2VyLmluZm8obWVzc2FnZSwgeyBjb250ZXh0OiAnUEVSRk9STUFOQ0UnLCAuLi5tZXRhIH0pO1xufTtcblxuY3VzdG9tTG9nZ2VyLmF1ZGl0ID0gKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4ge1xuICBsb2dnZXIuaW5mbyhtZXNzYWdlLCB7IGNvbnRleHQ6ICdBVURJVCcsIC4uLm1ldGEgfSk7XG59O1xuXG5jdXN0b21Mb2dnZXIuaW50ZWdyYXRpb24gPSAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB7XG4gIGxvZ2dlci5pbmZvKG1lc3NhZ2UsIHsgY29udGV4dDogJ0lOVEVHUkFUSU9OJywgLi4ubWV0YSB9KTtcbn07XG5cbi8vIEhhbmRsZSB1bmNhdWdodCBleGNlcHRpb25zIGFuZCByZWplY3Rpb25zXG5wcm9jZXNzLm9uKCd1bmNhdWdodEV4Y2VwdGlvbicsIChlcnJvcikgPT4ge1xuICBsb2dnZXIuZXJyb3IoJ1VuY2F1Z2h0IEV4Y2VwdGlvbjonLCBlcnJvcik7XG4gIHByb2Nlc3MuZXhpdCgxKTtcbn0pO1xuXG5wcm9jZXNzLm9uKCd1bmhhbmRsZWRSZWplY3Rpb24nLCAocmVhc29uLCBwcm9taXNlKSA9PiB7XG4gIGxvZ2dlci5lcnJvcignVW5oYW5kbGVkIFJlamVjdGlvbiBhdDonLCBwcm9taXNlLCAncmVhc29uOicsIHJlYXNvbik7XG4gIHByb2Nlc3MuZXhpdCgxKTtcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBjdXN0b21Mb2dnZXI7Il0sInZlcnNpb24iOjN9