87ac6c88c46e616774779c7401b498ed
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = __importDefault(require("path"));
const winston_1 = __importDefault(require("winston"));
// Import config with fallback for tests
let config;
try {
    const configModule = require('../config');
    config = configModule.default || configModule;
    // Ensure config is properly structured
    if (!config || !config.server) {
        throw new Error('Invalid config structure');
    }
}
catch (error) {
    // Mock config for tests
    config = {
        server: { env: process.env.NODE_ENV || 'test' },
        logging: { level: 'info', file: '/tmp/test.log' }
    };
}
// Custom format for structured logging
const customFormat = winston_1.default.format.combine(winston_1.default.format.timestamp({
    format: 'YYYY-MM-DD HH:mm:ss',
}), winston_1.default.format.errors({ stack: true }), winston_1.default.format.json());
// Console format for development
const consoleFormat = winston_1.default.format.combine(winston_1.default.format.timestamp({
    format: 'HH:mm:ss',
}), winston_1.default.format.colorize(), winston_1.default.format.printf(({ timestamp, level, message, ...meta }) => {
    return `${timestamp} [${level}]: ${message} ${Object.keys(meta).length ? JSON.stringify(meta, null, 2) : ''}`;
}));
// Create transports array
const transports = [];
// Console transport for all environments
transports.push(new winston_1.default.transports.Console({
    level: config.server.env === 'development' ? 'debug' : 'info',
    format: config.server.env === 'development' ? consoleFormat : customFormat,
    handleExceptions: true,
    handleRejections: true,
}));
// File transport for production
if (config.server.env === 'production') {
    // Ensure logs directory exists
    const logDir = path_1.default.dirname(config.logging.file);
    transports.push(
    // General log file
    new winston_1.default.transports.File({
        filename: config.logging.file,
        level: config.logging.level,
        format: customFormat,
        maxsize: 10 * 1024 * 1024, // 10MB
        maxFiles: 5,
        tailable: true,
        handleExceptions: true,
        handleRejections: true,
    }), 
    // Error log file
    new winston_1.default.transports.File({
        filename: path_1.default.join(logDir, 'error.log'),
        level: 'error',
        format: customFormat,
        maxsize: 10 * 1024 * 1024, // 10MB
        maxFiles: 5,
        tailable: true,
        handleExceptions: true,
        handleRejections: true,
    }));
}
// Create the logger instance
const logger = winston_1.default.createLogger({
    level: config.logging.level,
    format: customFormat,
    transports,
    exitOnError: false,
});
// Extend logger with custom methods
const customLogger = logger;
customLogger.fhir = (message, meta) => {
    logger.info(message, { context: 'FHIR', ...meta });
};
customLogger.security = (message, meta) => {
    logger.warn(message, { context: 'SECURITY', ...meta });
};
customLogger.performance = (message, meta) => {
    logger.info(message, { context: 'PERFORMANCE', ...meta });
};
customLogger.audit = (message, meta) => {
    logger.info(message, { context: 'AUDIT', ...meta });
};
customLogger.integration = (message, meta) => {
    logger.info(message, { context: 'INTEGRATION', ...meta });
};
// Handle uncaught exceptions and rejections
process.on('uncaughtException', (error) => {
    logger.error('Uncaught Exception:', error);
    process.exit(1);
});
process.on('unhandledRejection', (reason, promise) => {
    logger.error('Unhandled Rejection at:', promise, 'reason:', reason);
    process.exit(1);
});
exports.default = customLogger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvc3JjL3V0aWxzL2xvZ2dlci50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLGdEQUF3QjtBQUV4QixzREFBOEI7QUFFOUIsd0NBQXdDO0FBQ3hDLElBQUksTUFBVyxDQUFDO0FBQ2hCLElBQUksQ0FBQztJQUNILE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUMxQyxNQUFNLEdBQUcsWUFBWSxDQUFDLE9BQU8sSUFBSSxZQUFZLENBQUM7SUFDOUMsdUNBQXVDO0lBQ3ZDLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDOUIsTUFBTSxJQUFJLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7QUFDSCxDQUFDO0FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztJQUNmLHdCQUF3QjtJQUN4QixNQUFNLEdBQUc7UUFDUCxNQUFNLEVBQUUsRUFBRSxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLElBQUksTUFBTSxFQUFFO1FBQy9DLE9BQU8sRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRTtLQUNsRCxDQUFDO0FBQ0osQ0FBQztBQUVELHVDQUF1QztBQUN2QyxNQUFNLFlBQVksR0FBRyxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQ3pDLGlCQUFPLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUN2QixNQUFNLEVBQUUscUJBQXFCO0NBQzlCLENBQUMsRUFDRixpQkFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFDdEMsaUJBQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQ3RCLENBQUM7QUFFRixpQ0FBaUM7QUFDakMsTUFBTSxhQUFhLEdBQUcsaUJBQU8sQ0FBQyxNQUFNLENBQUMsT0FB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QztJQUMzQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2xCLENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLEVBQUUsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsRUFBRTtJQUNuRCxNQUFNLENBQUMsS0FBSyxDQUFDLHlCQUF5QixFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDcEUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNsQixDQUFDLENBQUMsQ0FBQztBQUVILGtCQUFlLFlBQVksQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvcm9kcmlnby9jbGF1ZGUtcHJvamVjdHMvT21uaUNhcmUvYmFja2VuZC9zcmMvdXRpbHMvbG9nZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5pbXBvcnQgd2luc3RvbiBmcm9tICd3aW5zdG9uJztcblxuLy8gSW1wb3J0IGNvbmZpZyB3aXRoIGZhbGxiYWNrIGZvciB0ZXN0c1xubGV0IGNvbmZpZzogYW55O1xudHJ5IHtcbiAgY29uc3QgY29uZmlnTW9kdWxlID0gcmVxdWlyZSgnLi4vY29uZmlnJyk7XG4gIGNvbmZpZyA9IGNvbmZpZ01vZHVsZS5kZWZhdWx0IHx8IGNvbmZpZ01vZHVsZTtcbiAgLy8gRW5zdXJlIGNvbmZpZyBpcyBwcm9wZXJseSBzdHJ1Y3R1cmVkXG4gIGlmICghY29uZmlnIHx8ICFjb25maWcuc2VydmVyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGNvbmZpZyBzdHJ1Y3R1cmUnKTtcbiAgfVxufSBjYXRjaCAoZXJyb3IpIHtcbiAgLy8gTW9jayBjb25maWcgZm9yIHRlc3RzXG4gIGNvbmZpZyA9IHtcbiAgICBzZXJ2ZXI6IHsgZW52OiBwcm9jZXNzLmVudi5OT0RFX0VOViB8fCAndGVzdCcgfSxcbiAgICBsb2dnaW5nOiB7IGxldmVsOiAnaW5mbycsIGZpbGU6ICcvdG1wL3Rlc3QubG9nJyB9XG4gIH07XG59XG5cbi8vIEN1c3RvbSBmb3JtYXQgZm9yIHN0cnVjdHVyZWQgbG9nZ2luZ1xuY29uc3QgY3VzdG9tRm9ybWF0ID0gd2luc3Rvbi5mb3JtYXQuY29tYmluZShcbiAgd2luc3Rvbi5mb3JtYXQudGltZXN0YW1wKHtcbiAgICBmb3JtYXQ6ICdZWVlZLU1NLUREIEhIOm1tOnNzJyxcbiAgfSksXG4gIHdpbnN0b24uZm9ybWF0LmVycm9ycyh7IHN0YWNrOiB0cnVlIH0pLFxuICB3aW5zdG9uLmZvcm1hdC5qc29uKClcbik7XG5cbi8vIENvbnNvbGUgZm9ybWF0IGZvciBkZXZlbG9wbWVudFxuY29uc3QgY29uc29sZUZvcm1hdCA9IHdpbnN0b24uZm9ybWF0LmNvbWJpbmUoXG4gIHdpbnN0b24uZm9ybWF0LnRpbWVzdGFtcCh7XG4gICAgZm9ybWF0OiAnSEg6bW06c3MnLFxuICB9KSxcbiAgd2luc3Rvbi5mb3JtYXQuY29sb3JpemUoKSxcbiAgd2luc3Rvbi5mb3JtYXQucHJpbnRmKCh7IHRpbWVzdGFtcCwgbGV2ZWwsIG1lc3NhZ2UsIC4uLm1ldGEgfSkgPT4ge1xuICAgIHJldHVybiBgJHt0aW1lc3RhbXB9IFske2xldmVsfV06ICR7bWVzc2FnZX0gJHtPYmplY3Qua2V5cyhtZXRhKS5sZW5ndGggPyBKU09OLnN0cmluZ2lmeShtZXRhLCBudWxsLCAyKSA6ICcnfWA7XG4gIH0pXG4pO1xuXG4vLyBDcmVhdGUgdHJhbnNwb3J0cyBhcnJheVxuY29uc3QgdHJhbnNwb3J0czogd2luc3Rvbi50cmFuc3BvcnRbXSA9IFtdO1xuXG4vLyBDb25zb2xlIHRyYW5zcG9ydCBmb3IgYWxsIGVudmlyb25tZW50c1xudHJhbnNwb3J0cy5wdXNoKFxuICBuZXcgd2luc3Rvbi50cmFuc3BvcnRzLkNvbnNvbGUoe1xuICAgIGxldmVsOiBjb25maWcuc2VydmVyLmVudiA9PT0gJ2RldmVsb3BtZW50JyA/ICdkZWJ1ZycgOiAnaW5mbycsXG4gICAgZm9ybWF0OiBjb25maWcuc2VydmVyLmVudiA9PT0gJ2RldmVsb3BtZW50JyA/IGNvbnNvbGVGb3JtYXQgOiBjdXN0b21Gb3JtYXQsXG4gICAgaGFuZGxlRXhjZXB0aW9uczogdHJ1ZSxcbiAgICBoYW5kbGVSZWplY3Rpb25zOiB0cnVlLFxuICB9KVxuKTtcblxuLy8gRmlsZSB0cmFuc3BvcnQgZm9yIHByb2R1Y3Rpb25cbmlmIChjb25maWcuc2VydmVyLmVudiA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gIC8vIEVuc3VyZSBsb2dzIGRpcmVjdG9yeSBleGlzdHNcbiAgY29uc3QgbG9nRGlyID0gcGF0aC5kaXJuYW1lKGNvbmZpZy5sb2dnaW5nLmZpbGUpO1xuICBcbiAgdHJhbnNwb3J0cy5wdXNoKFxuICAgIC8vIEdlbmVyYWwgbG9nIGZpbGVcbiAgICBuZXcgd2luc3Rvbi50cmFuc3BvcnRzLkZpbGUoe1xuICAgICAgZmlsZW5hbWU6IGNvbmZpZy5sb2dnaW5nLmZpbGUsXG4gICAgICBsZXZlbDogY29uZmlnLmxvZ2dpbmcubGV2ZWwsXG4gICAgICBmb3JtYXQ6IGN1c3RvbUZvcm1hdCxcbiAgICAgIG1heHNpemU6IDEwICogMTAyNCAqIDEwMjQsIC8vIDEwTUJcbiAgICAgIG1heEZpbGVzOiA1LFxuICAgICAgdGFpbGFibGU6IHRydWUsXG4gICAgICBoYW5kbGVFeGNlcHRpb25zOiB0cnVlLFxuICAgICAgaGFuZGxlUmVqZWN0aW9uczogdHJ1ZSxcbiAgICB9KSxcbiAgICBcbiAgICAvLyBFcnJvciBsb2cgZmlsZVxuICAgIG5ldyB3aW5zdG9uLnRyYW5zcG9ydHMuRmlsZSh7XG4gICAgICBmaWxlbmFtZTogcGF0aC5qb2luKGxvZ0RpciwgJ2Vycm9yLmxvZycpLFxuICAgICAgbGV2ZWw6ICdlcnJvcicsXG4gICAgICBmb3JtYXQ6IGN1c3RvbUZvcm1hdCxcbiAgICAgIG1heHNpemU6IDEwICogMTAyNCAqIDEwMjQsIC8vIDEwTUJcbiAgICAgIG1heEZpbGVzOiA1LFxuICAgICAgdGFpbGFibGU6IHRydWUsXG4gICAgICBoYW5kbGVFeGNlcHRpb25zOiB0cnVlLFxuICAgICAgaGFuZGxlUmVqZWN0aW9uczogdHJ1ZSxcbiAgICB9KVxuICApO1xufVxuXG4vLyBDcmVhdGUgdGhlIGxvZ2dlciBpbnN0YW5jZVxuY29uc3QgbG9nZ2VyID0gd2luc3Rvbi5jcmVhdGVMb2dnZXIoe1xuICBsZXZlbDogY29uZmlnLmxvZ2dpbmcubGV2ZWwsXG4gIGZvcm1hdDogY3VzdG9tRm9ybWF0LFxuICB0cmFuc3BvcnRzLFxuICBleGl0T25FcnJvcjogZmFsc2UsXG59KTtcblxuLy8gQWRkIGN1c3RvbSBsb2dnaW5nIG1ldGhvZHMgZm9yIGRpZmZlcmVudCBjb250ZXh0c1xuaW50ZXJmYWNlIEN1c3RvbUxvZ2dlciBleHRlbmRzIHdpbnN0b24uTG9nZ2VyIHtcbiAgZmhpcjogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4gdm9pZDtcbiAgc2VjdXJpdHk6IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHZvaWQ7XG4gIHBlcmZvcm1hbmNlOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB2b2lkO1xuICBhdWRpdDogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4gdm9pZDtcbiAgaW50ZWdyYXRpb246IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHZvaWQ7XG59XG5cbi8vIEV4dGVuZCBsb2dnZXIgd2l0aCBjdXN0b20gbWV0aG9kc1xuY29uc3QgY3VzdG9tTG9nZ2VyID0gbG9nZ2VyIGFzIEN1c3RvbUxvZ2dlcjtcblxuY3VzdG9tTG9nZ2VyLmZoaXIgPSAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB7XG4gIGxvZ2dlci5pbmZvKG1lc3NhZ2UsIHsgY29udGV4dDogJ0ZISVInLCAuLi5tZXRhIH0pO1xufTtcblxuY3VzdG9tTG9nZ2VyLnNlY3VyaXR5ID0gKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4ge1xuICBsb2dnZXIud2FybihtZXNzYWdlLCB7IGNvbnRleHQ6ICdTRUNVUklUWScsIC4uLm1ldGEgfSk7XG59O1xuXG5jdXN0b21Mb2dnZXIucGVyZm9ybWFuY2UgPSAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB7XG4gIGxvZ2dlci5pbmZvKG1lc3NhZ2UsIHsgY29udGV4dDogJ1BFUkZPUk1BTkNFJywgLi4ubWV0YSB9KTtcbn07XG5cbmN1c3RvbUxvZ2dlci5hdWRpdCA9IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHtcbiAgbG9nZ2VyLmluZm8obWVzc2FnZSwgeyBjb250ZXh0OiAnQVVESVQnLCAuLi5tZXRhIH0pO1xufTtcblxuY3VzdG9tTG9nZ2VyLmludGVncmF0aW9uID0gKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4ge1xuICBsb2dnZXIuaW5mbyhtZXNzYWdlLCB7IGNvbnRleHQ6ICdJTlRFR1JBVElPTicsIC4uLm1ldGEgfSk7XG59O1xuXG4vLyBIYW5kbGUgdW5jYXVnaHQgZXhjZXB0aW9ucyBhbmQgcmVqZWN0aW9uc1xucHJvY2Vzcy5vbigndW5jYXVnaHRFeGNlcHRpb24nLCAoZXJyb3IpID0+IHtcbiAgbG9nZ2VyLmVycm9yKCdVbmNhdWdodCBFeGNlcHRpb246JywgZXJyb3IpO1xuICBwcm9jZXNzLmV4aXQoMSk7XG59KTtcblxucHJvY2Vzcy5vbigndW5oYW5kbGVkUmVqZWN0aW9uJywgKHJlYXNvbiwgcHJvbWlzZSkgPT4ge1xuICBsb2dnZXIuZXJyb3IoJ1VuaGFuZGxlZCBSZWplY3Rpb24gYXQ6JywgcHJvbWlzZSwgJ3JlYXNvbjonLCByZWFzb24pO1xuICBwcm9jZXNzLmV4aXQoMSk7XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgY3VzdG9tTG9nZ2VyOyJdLCJ2ZXJzaW9uIjozfQ==