ebd638f6790dfa055a8708e5670aa6da
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = __importDefault(require("path"));
const dotenv_1 = __importDefault(require("dotenv"));
// Load environment variables
dotenv_1.default.config({ path: path_1.default.join(__dirname, '../../.env') });
const config = {
    server: {
        port: parseInt(process.env.PORT || '8080', 10),
        host: process.env.HOST || 'localhost',
        env: process.env.NODE_ENV || 'development',
    },
    database: {
        url: process.env.DATABASE_URL || 'postgresql://localhost:5432/omnicare_fhir',
        connectionPoolSize: parseInt(process.env.CONNECTION_POOL_SIZE || '10', 10),
    },
    redis: {
        url: process.env.REDIS_URL || 'redis://localhost:6379',
    },
    medplum: {
        baseUrl: process.env.MEDPLUM_BASE_URL || 'https://api.medplum.com/',
        clientId: process.env.MEDPLUM_CLIENT_ID || '',
        clientSecret: process.env.MEDPLUM_CLIENT_SECRET || '',
        projectId: process.env.MEDPLUM_PROJECT_ID || '',
        selfHosted: process.env.MEDPLUM_SELF_HOSTED === 'true',
        selfHostedUrl: process.env.MEDPLUM_SELF_HOSTED_URL,
    },
    jwt: {
        secret: process.env.JWT_SECRET || 'fallback-secret-change-in-production',
        expiresIn: process.env.JWT_EXPIRES_IN || '24h',
        refreshExpiresIn: process.env.JWT_REFRESH_EXPIRES_IN || '7d',
    },
    fhir: {
        version: process.env.FHIR_VERSION || '4.0.1',
        baseUrl: process.env.FHIR_BASE_URL || 'http://localhost:8080/fhir/R4',
    },
    smart: {
        authorizationUrl: process.env.SMART_AUTHORIZATION_URL || 'http://localhost:8080/auth/authorize',
        tokenUrl: process.env.SMART_TOKEN_URL || 'http://localhost:8080/auth/token',
        introspectionUrl: process.env.SMART_INTROSPECTION_URL || 'http://localhost:8080/auth/introspect',
        scopes: (process.env.SMART_SCOPES || 'openid profile fhirUser patient/*.read patient/*.write user/*.read user/*.write launch').split(' '),
    },
    cdsHooks: {
        discoveryUrl: process.env.CDS_HOOKS_DISCOVERY_URL || 'http://localhost:8080/cds-services',
        baseUrl: process.env.CDS_HOOKS_BASE_URL || 'http://localhost:8080/cds-services',
    },
    ehr: {
        integrationEnabled: process.env.EHR_INTEGRATION_ENABLED === 'true',
        systems: (process.env.EHR_SYSTEMS || 'epic,cerner,allscripts').split(','),
        epic: {
            clientId: process.env.EPIC_CLIENT_ID || '',
            privateKeyPath: process.env.EPIC_PRIVATE_KEY_PATH || './certs/epic-private-key.pem',
            fhirBaseUrl: process.env.EPIC_FHIR_BASE_URL || 'https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4',
        },
        cerner: {
            clientId: process.env.CERNER_CLIENT_ID || '',
            clientSecret: process.env.CERNER_CLIENT_SECRET || '',
            fhirBaseUrl: process.env.CERNER_FHIR_BASE_URL || 'https://fhir-open.cerner.com/r4',
        },
    },
    hl7v2: {
        enabled: process.env.HL7_V2_ENABLED === 'true',
        port: parseInt(process.env.HL7_V2_PORT || '2575', 10),
        host: process.env.HL7_V2_HOST || '0.0.0.0',
    },
    logging: {
        level: process.env.LOG_LEVEL || 'info',
        file: process.env.LOG_FILE || 'logs/omnicare.log',
    },
    rateLimit: {
        windowMs: parseInt(process.env.RATE_LIMIT_WINDOW_MS || '900000', 10),
        maxRequests: parseInt(process.env.RATE_LIMIT_MAX_REQUESTS || '100', 10),
    },
    subscriptions: {
        websocketPort: parseInt(process.env.WEBSOCKET_PORT || '8081', 10),
        maxConnections: parseInt(process.env.SUBSCRIPTION_MAX_CONNECTIONS || '1000', 10),
    },
    performance: {
        cacheTtl: parseInt(process.env.CACHE_TTL || '3600', 10),
        maxRequestSize: process.env.MAX_REQUEST_SIZE || '10mb',
    },
};
// Validation
const validateConfig = () => {
    const requiredFields = [
        'server.port',
        'database.url',
        'jwt.secret',
    ];
    const missingFields = requiredFields.filter(field => {
        const keys = field.split('.');
        let value = config;
        for (const key of keys) {
            value = value[key];
            if (value === undefined || value === '') {
                return true;
            }
        }
        return false;
    });
    if (missingFields.length > 0) {
        throw new Error(`Missing required configuration fields: ${missingFields.join(', ')}`);
    }
};
// Validate configuration on startup
if (process.env.NODE_ENV !== 'test') {
    validateConfig();
}
exports.default = config;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvc3JjL2NvbmZpZy9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLGdEQUF3QjtBQUV4QixvREFBNEI7QUFFNUIsNkJBQTZCO0FBQzdCLGdCQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxFQUFFLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztBQXlHNUQsTUFBTSxNQUFNLEdBQVc7SUFDckIsTUFBTSxFQUFFO1FBQ04sSUFBSSxFQUFFLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxNQUFNLEVBQUUsRUFBRSxDQUFDO1FBQzlDLElBQUksRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxXQUFXO1FBQ3JDLEdBQUcsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsSUFBSSxhQUFhO0tBQzNDO0lBRUQsUUFBUSxFQUFFO1FBQ1IsR0FBRyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxJQUFJLDJDQUEyQztRQUM1RSxrQkFBa0IsRUFBRSxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsSUFBSSxJQUFJLEVBQUUsRUFBRSxDQUFDO0tBQzNFO0lBRUQsS0FBSyxFQUFFO1FBQ0wsR0FBRyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxJQUFJLHdCQUF3QjtLQUN2RDtJQUVELE9BQU8sRUFBRTtRQUNQLE9BQU8sRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixJQUFJLDBCQUEwQjtRQUNuRSxRQUFRLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsSUFBSSxFQUFFO1FBQzdDLFlBQVksRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixJQUFJLEVBQUU7UUFDckQsU0FBUyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLElBQUks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LENBQUMsMENBQTBDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3hGLENBQUM7QUFDSCxDQUFDLENBQUM7QUFFRixvQ0FBb0M7QUFDcEMsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxNQUFNLEVBQUUsQ0FBQztJQUNwQyxjQUFjLEVBQUUsQ0FBQztBQUNuQixDQUFDO0FBRUQsa0JBQWUsTUFBTSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2RyaWdvL2NsYXVkZS1wcm9qZWN0cy9PbW5pQ2FyZS9iYWNrZW5kL3NyYy9jb25maWcvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmltcG9ydCBkb3RlbnYgZnJvbSAnZG90ZW52JztcblxuLy8gTG9hZCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbmRvdGVudi5jb25maWcoeyBwYXRoOiBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLmVudicpIH0pO1xuXG5pbnRlcmZhY2UgQ29uZmlnIHtcbiAgLy8gU2VydmVyIENvbmZpZ3VyYXRpb25cbiAgc2VydmVyOiB7XG4gICAgcG9ydDogbnVtYmVyO1xuICAgIGhvc3Q6IHN0cmluZztcbiAgICBlbnY6IHN0cmluZztcbiAgfTtcblxuICAvLyBEYXRhYmFzZSBDb25maWd1cmF0aW9uXG4gIGRhdGFiYXNlOiB7XG4gICAgdXJsOiBzdHJpbmc7XG4gICAgY29ubmVjdGlvblBvb2xTaXplOiBudW1iZXI7XG4gIH07XG5cbiAgcmVkaXM6IHtcbiAgICB1cmw6IHN0cmluZztcbiAgfTtcblxuICAvLyBNZWRwbHVtIENvbmZpZ3VyYXRpb25cbiAgbWVkcGx1bToge1xuICAgIGJhc2VVcmw6IHN0cmluZztcbiAgICBjbGllbnRJZDogc3RyaW5nO1xuICAgIGNsaWVudFNlY3JldDogc3RyaW5nO1xuICAgIHByb2plY3RJZDogc3RyaW5nO1xuICAgIHNlbGZIb3N0ZWQ6IGJvb2xlYW47XG4gICAgc2VsZkhvc3RlZFVybD86IHN0cmluZztcbiAgfTtcblxuICAvLyBKV1QgQ29uZmlndXJhdGlvblxuICBqd3Q6IHtcbiAgICBzZWNyZXQ6IHN0cmluZztcbiAgICBleHBpcmVzSW46IHN0cmluZztcbiAgICByZWZyZXNoRXhwaXJlc0luOiBzdHJpbmc7XG4gIH07XG5cbiAgLy8gRkhJUiBDb25maWd1cmF0aW9uXG4gIGZoaXI6IHtcbiAgICB2ZXJzaW9uOiBzdHJpbmc7XG4gICAgYmFzZVVybDogc3RyaW5nO1xuICB9O1xuXG4gIC8vIFNNQVJUIG9uIEZISVIgQ29uZmlndXJhdGlvblxuICBzbWFydDoge1xuICAgIGF1dGhvcml6YXRpb25Vcmw6IHN0cmluZztcbiAgICB0b2tlblVybDogc3RyaW5nO1xuICAgIGludHJvc3BlY3Rpb25Vcmw6IHN0cmluZztcbiAgICBzY29wZXM6IHN0cmluZ1tdO1xuICB9O1xuXG4gIC8vIENsaW5pY2FsIERlY2lzaW9uIFN1cHBvcnQgSG9va3NcbiAgY2RzSG9va3M6IHtcbiAgICBkaXNjb3ZlcnlVcmw6IHN0cmluZztcbiAgICBiYXNlVXJsOiBzdHJpbmc7XG4gIH07XG5cbiAgLy8gRXh0ZXJuYWwgRUhSIEludGVncmF0aW9uXG4gIGVocjoge1xuICAgIGludGVncmF0aW9uRW5hYmxlZDogYm9vbGVhbjtcbiAgICBzeXN0ZW1zOiBzdHJpbmdbXTtcbiAgICBlcGljOiB7XG4gICAgICBjbGllbnRJZDogc3RyaW5nO1xuICAgICAgcHJpdmF0ZUtleVBhdGg6IHN0cmluZztcbiAgICAgIGZoaXJCYXNlVXJsOiBzdHJpbmc7XG4gICAgfTtcbiAgICBjZXJuZXI6IHtcbiAgICAgIGNsaWVudElkOiBzdHJpbmc7XG4gICAgICBjbGllbnRTZWNyZXQ6IHN0cmluZztcbiAgICAgIGZoaXJCYXNlVXJsOiBzdHJpbmc7XG4gICAgfTtcbiAgfTtcblxuICAvLyBITDcgdjIgSW50ZXJmYWNlXG4gIGhsN3YyOiB7XG4gICAgZW5hYmxlZDogYm9vbGVhbjtcbiAgICBwb3J0OiBudW1iZXI7XG4gICAgaG9zdDogc3RyaW5nO1xuICB9O1xuXG4gIC8vIExvZ2dpbmdcbiAgbG9nZ2luZzoge1xuICAgIGxldmVsOiBzdHJpbmc7XG4gICAgZmlsZTogc3RyaW5nO1xuICB9O1xuXG4gIC8vIFJhdGUgTGltaXRpbmdcbiAgcmF0ZUxpbWl0OiB7XG4gICAgd2luZG93TXM6IG51bWJlcjtcbiAgICBtYXhSZXF1ZXN0czogbnVtYmVyO1xuICB9O1xuXG4gIC8vIFN1YnNjcmlwdGlvbiBDb25maWd1cmF0aW9uXG4gIHN1YnNjcmlwdGlvbnM6IHtcbiAgICB3ZWJzb2NrZXRQb3J0OiBudW1iZXI7XG4gICAgbWF4Q29ubmVjdGlvbnM6IG51bWJlcjtcbiAgfTtcblxuICAvLyBQZXJmb3JtYW5jZVxuICBwZXJmb3JtYW5jZToge1xuICAgIGNhY2hlVHRsOiBudW1iZXI7XG4gICAgbWF4UmVxdWVzdFNpemU6IHN0cmluZztcbiAgfTtcbn1cblxuY29uc3QgY29uZmlnOiBDb25maWcgPSB7XG4gIHNlcnZlcjoge1xuICAgIHBvcnQ6IHBhcnNlSW50KHByb2Nlc3MuZW52LlBPUlQgfHwgJzgwODAnLCAxMCksXG4gICAgaG9zdDogcHJvY2Vzcy5lbnYuSE9TVCB8fCAnbG9jYWxob3N0JyxcbiAgICBlbnY6IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICdkZXZlbG9wbWVudCcsXG4gIH0sXG5cbiAgZGF0YWJhc2U6IHtcbiAgICB1cmw6IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCB8fCAncG9zdGdyZXNxbDovL2xvY2FsaG9zdDo1NDMyL29tbmljYXJlX2ZoaXInLFxuICAgIGNvbm5lY3Rpb25Qb29sU2l6ZTogcGFyc2VJbnQocHJvY2Vzcy5lbnYuQ09OTkVDVElPTl9QT09MX1NJWkUgfHwgJzEwJywgMTApLFxuICB9LFxuXG4gIHJlZGlzOiB7XG4gICAgdXJsOiBwcm9jZXNzLmVudi5SRURJU19VUkwgfHwgJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzknLFxuICB9LFxuXG4gIG1lZHBsdW06IHtcbiAgICBiYXNlVXJsOiBwcm9jZXNzLmVudi5NRURQTFVNX0JBU0VfVVJMIHx8ICdodHRwczovL2FwaS5tZWRwbHVtLmNvbS8nLFxuICAgIGNsaWVudElkOiBwcm9jZXNzLmVudi5NRURQTFVNX0NMSUVOVF9JRCB8fCAnJyxcbiAgICBjbGllbnRTZWNyZXQ6IHByb2Nlc3MuZW52Lk1FRFBMVU1fQ0xJRU5UX1NFQ1JFVCB8fCAnJyxcbiAgICBwcm9qZWN0SWQ6IHByb2Nlc3MuZW52Lk1FRFBMVU1fUFJPSkVDVF9JRCB8fCAnJyxcbiAgICBzZWxmSG9zdGVkOiBwcm9jZXNzLmVudi5NRURQTFVNX1NFTEZfSE9TVEVEID09PSAndHJ1ZScsXG4gICAgc2VsZkhvc3RlZFVybDogcHJvY2Vzcy5lbnYuTUVEUExVTV9TRUxGX0hPU1RFRF9VUkwsXG4gIH0sXG5cbiAgand0OiB7XG4gICAgc2VjcmV0OiBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICdmYWxsYmFjay1zZWNyZXQtY2hhbmdlLWluLXByb2R1Y3Rpb24nLFxuICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4gfHwgJzI0aCcsXG4gICAgcmVmcmVzaEV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX1JFRlJFU0hfRVhQSVJFU19JTiB8fCAnN2QnLFxuICB9LFxuXG4gIGZoaXI6IHtcbiAgICB2ZXJzaW9uOiBwcm9jZXNzLmVudi5GSElSX1ZFUlNJT04gfHwgJzQuMC4xJyxcbiAgICBiYXNlVXJsOiBwcm9jZXNzLmVudi5GSElSX0JBU0VfVVJMIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwODAvZmhpci9SNCcsXG4gIH0sXG5cbiAgc21hcnQ6IHtcbiAgICBhdXRob3JpemF0aW9uVXJsOiBwcm9jZXNzLmVudi5TTUFSVF9BVVRIT1JJWkFUSU9OX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDgwL2F1dGgvYXV0aG9yaXplJyxcbiAgICB0b2tlblVybDogcHJvY2Vzcy5lbnYuU01BUlRfVE9LRU5fVVJMIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwODAvYXV0aC90b2tlbicsXG4gICAgaW50cm9zcGVjdGlvblVybDogcHJvY2Vzcy5lbnYuU01BUlRfSU5UUk9TUEVDVElPTl9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9hdXRoL2ludHJvc3BlY3QnLFxuICAgIHNjb3BlczogKHByb2Nlc3MuZW52LlNNQVJUX1NDT1BFUyB8fCAnb3BlbmlkIHByb2ZpbGUgZmhpclVzZXIgcGF0aWVudC8qLnJlYWQgcGF0aWVudC8qLndyaXRlIHVzZXIvKi5yZWFkIHVzZXIvKi53cml0ZSBsYXVuY2gnKS5zcGxpdCgnICcpLFxuICB9LFxuXG4gIGNkc0hvb2tzOiB7XG4gICAgZGlzY292ZXJ5VXJsOiBwcm9jZXNzLmVudi5DRFNfSE9PS1NfRElTQ09WRVJZX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDgwL2Nkcy1zZXJ2aWNlcycsXG4gICAgYmFzZVVybDogcHJvY2Vzcy5lbnYuQ0RTX0hPT0tTX0JBU0VfVVJMIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwODAvY2RzLXNlcnZpY2VzJyxcbiAgfSxcblxuICBlaHI6IHtcbiAgICBpbnRlZ3JhdGlvbkVuYWJsZWQ6IHByb2Nlc3MuZW52LkVIUl9JTlRFR1JBVElPTl9FTkFCTEVEID09PSAndHJ1ZScsXG4gICAgc3lzdGVtczogKHByb2Nlc3MuZW52LkVIUl9TWVNURU1TIHx8ICdlcGljLGNlcm5lcixhbGxzY3JpcHRzJykuc3BsaXQoJywnKSxcbiAgICBlcGljOiB7XG4gICAgICBjbGllbnRJZDogcHJvY2Vzcy5lbnYuRVBJQ19DTElFTlRfSUQgfHwgJycsXG4gICAgICBwcml2YXRlS2V5UGF0aDogcHJvY2Vzcy5lbnYuRVBJQ19QUklWQVRFX0tFWV9QQVRIIHx8ICcuL2NlcnRzL2VwaWMtcHJpdmF0ZS1rZXkucGVtJyxcbiAgICAgIGZoaXJCYXNlVXJsOiBwcm9jZXNzLmVudi5FUElDX0ZISVJfQkFTRV9VUkwgfHwgJ2h0dHBzOi8vZmhpci5lcGljLmNvbS9pbnRlcmNvbm5lY3QtZmhpci1vYXV0aC9hcGkvRkhJUi9SNCcsXG4gICAgfSxcbiAgICBjZXJuZXI6IHtcbiAgICAgIGNsaWVudElkOiBwcm9jZXNzLmVudi5DRVJORVJfQ0xJRU5UX0lEIHx8ICcnLFxuICAgICAgY2xpZW50U2VjcmV0OiBwcm9jZXNzLmVudi5DRVJORVJfQ0xJRU5UX1NFQ1JFVCB8fCAnJyxcbiAgICAgIGZoaXJCYXNlVXJsOiBwcm9jZXNzLmVudi5DRVJORVJfRkhJUl9CQVNFX1VSTCB8fCAnaHR0cHM6Ly9maGlyLW9wZW4uY2VybmVyLmNvbS9yNCcsXG4gICAgfSxcbiAgfSxcblxuICBobDd2Mjoge1xuICAgIGVuYWJsZWQ6IHByb2Nlc3MuZW52LkhMN19WMl9FTkFCTEVEID09PSAndHJ1ZScsXG4gICAgcG9ydDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuSEw3X1YyX1BPUlQgfHwgJzI1NzUnLCAxMCksXG4gICAgaG9zdDogcHJvY2Vzcy5lbnYuSEw3X1YyX0hPU1QgfHwgJzAuMC4wLjAnLFxuICB9LFxuXG4gIGxvZ2dpbmc6IHtcbiAgICBsZXZlbDogcHJvY2Vzcy5lbnYuTE9HX0xFVkVMIHx8ICdpbmZvJyxcbiAgICBmaWxlOiBwcm9jZXNzLmVudi5MT0dfRklMRSB8fCAnbG9ncy9vbW5pY2FyZS5sb2cnLFxuICB9LFxuXG4gIHJhdGVMaW1pdDoge1xuICAgIHdpbmRvd01zOiBwYXJzZUludChwcm9jZXNzLmVudi5SQVRFX0xJTUlUX1dJTkRPV19NUyB8fCAnOTAwMDAwJywgMTApLFxuICAgIG1heFJlcXVlc3RzOiBwYXJzZUludChwcm9jZXNzLmVudi5SQVRFX0xJTUlUX01BWF9SRVFVRVNUUyB8fCAnMTAwJywgMTApLFxuICB9LFxuXG4gIHN1YnNjcmlwdGlvbnM6IHtcbiAgICB3ZWJzb2NrZXRQb3J0OiBwYXJzZUludChwcm9jZXNzLmVudi5XRUJTT0NLRVRfUE9SVCB8fCAnODA4MScsIDEwKSxcbiAgICBtYXhDb25uZWN0aW9uczogcGFyc2VJbnQocHJvY2Vzcy5lbnYuU1VCU0NSSVBUSU9OX01BWF9DT05ORUNUSU9OUyB8fCAnMTAwMCcsIDEwKSxcbiAgfSxcblxuICBwZXJmb3JtYW5jZToge1xuICAgIGNhY2hlVHRsOiBwYXJzZUludChwcm9jZXNzLmVudi5DQUNIRV9UVEwgfHwgJzM2MDAnLCAxMCksXG4gICAgbWF4UmVxdWVzdFNpemU6IHByb2Nlc3MuZW52Lk1BWF9SRVFVRVNUX1NJWkUgfHwgJzEwbWInLFxuICB9LFxufTtcblxuLy8gVmFsaWRhdGlvblxuY29uc3QgdmFsaWRhdGVDb25maWcgPSAoKTogdm9pZCA9PiB7XG4gIGNvbnN0IHJlcXVpcmVkRmllbGRzID0gW1xuICAgICdzZXJ2ZXIucG9ydCcsXG4gICAgJ2RhdGFiYXNlLnVybCcsXG4gICAgJ2p3dC5zZWNyZXQnLFxuICBdO1xuXG4gIGNvbnN0IG1pc3NpbmdGaWVsZHMgPSByZXF1aXJlZEZpZWxkcy5maWx0ZXIoZmllbGQgPT4ge1xuICAgIGNvbnN0IGtleXMgPSBmaWVsZC5zcGxpdCgnLicpO1xuICAgIGxldCB2YWx1ZTogYW55ID0gY29uZmlnO1xuICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICAgIHZhbHVlID0gdmFsdWVba2V5XTtcbiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAnJykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9KTtcblxuICBpZiAobWlzc2luZ0ZpZWxkcy5sZW5ndGggPiAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIHJlcXVpcmVkIGNvbmZpZ3VyYXRpb24gZmllbGRzOiAke21pc3NpbmdGaWVsZHMuam9pbignLCAnKX1gKTtcbiAgfVxufTtcblxuLy8gVmFsaWRhdGUgY29uZmlndXJhdGlvbiBvbiBzdGFydHVwXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICd0ZXN0Jykge1xuICB2YWxpZGF0ZUNvbmZpZygpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjb25maWc7Il0sInZlcnNpb24iOjN9