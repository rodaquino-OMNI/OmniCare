d1b56249d55e6464de7ae3d797279baa
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Mock external dependencies
globals_1.jest.mock('@medplum/core', () => ({
    createReference: globals_1.jest.fn((resource) => ({
        reference: `${resource.resourceType}/${resource.id}`,
    })),
    getReferenceString: globals_1.jest.fn((ref) => ref.reference),
    normalizeOperationOutcome: globals_1.jest.fn((outcome) => outcome),
}));
// Note: @medplum/client package doesn't exist, using @medplum/core for client functionality
// Mock Redis
globals_1.jest.mock('redis', () => ({
    createClient: globals_1.jest.fn(() => ({
        connect: globals_1.jest.fn(),
        disconnect: globals_1.jest.fn(),
        get: globals_1.jest.fn(),
        set: globals_1.jest.fn(),
        del: globals_1.jest.fn(),
        flushall: globals_1.jest.fn(),
        on: globals_1.jest.fn(),
    })),
}));
// Mock PostgreSQL
globals_1.jest.mock('pg', () => ({
    Pool: globals_1.jest.fn(() => ({
        connect: globals_1.jest.fn(),
        query: globals_1.jest.fn(),
        end: globals_1.jest.fn(),
    })),
    Client: globals_1.jest.fn(() => ({
        connect: globals_1.jest.fn(),
        query: globals_1.jest.fn(),
        end: globals_1.jest.fn(),
    })),
}));
// Mock Winston logger
globals_1.jest.mock('winston', () => ({
    createLogger: globals_1.jest.fn(() => ({
        info: globals_1.jest.fn(),
        warn: globals_1.jest.fn(),
        error: globals_1.jest.fn(),
        debug: globals_1.jest.fn(),
    })),
    format: {
        combine: globals_1.jest.fn(),
        timestamp: globals_1.jest.fn(),
        errors: globals_1.jest.fn(),
        json: globals_1.jest.fn(),
        colorize: globals_1.jest.fn(),
        simple: globals_1.jest.fn(),
    },
    transports: {
        Console: globals_1.jest.fn(),
        File: globals_1.jest.fn(),
    },
}));
const dotenv_1 = __importDefault(require("dotenv"));
// Load test environment variables
dotenv_1.default.config({ path: '.env.test' });
// Mock console methods for cleaner test output
global.console = {
    ...console,
    log: globals_1.jest.fn(),
    warn: globals_1.jest.fn(),
    error: globals_1.jest.fn(),
};
// Set up test database connection
process.env.NODE_ENV = 'test';
process.env.DB_HOST = 'localhost';
process.env.DB_PORT = '5432';
process.env.DB_NAME = 'omnicare_test';
process.env.DB_USER = 'test_user';
process.env.DB_PASSWORD = 'test_password';
process.env.REDIS_URL = 'redis://localhost:6379/1';
process.env.JWT_SECRET = 'test_jwt_secret_key_for_testing_only';
process.env.MEDPLUM_CLIENT_ID = 'test_client_id';
process.env.MEDPLUM_CLIENT_SECRET = 'test_client_secret';
// Global test helpers
global.mockConsole = {
    log: globals_1.jest.fn(),
    warn: globals_1.jest.fn(),
    error: globals_1.jest.fn(),
};
// Test data factories
global.createMockPatient = () => ({
    resourceType: 'Patient',
    id: 'test-patient-1',
    identifier: [
        {
            system: 'http://hospital.smarthealthit.org',
            value: 'MRN123456',
        },
    ],
    name: [
        {
            family: 'Doe',
            given: ['John'],
        },
    ],
    gender: 'male',
    birthDate: '1990-01-01',
    telecom: [
        {
            system: 'phone',
            value: '555-0123',
            use: 'mobile',
        },
        {
            system: 'email',
            value: 'john.doe@example.com',
            use: 'home',
        },
    ],
    address: [
        {
            use: 'home',
            line: ['123 Main St'],
            city: 'Anytown',
            state: 'NY',
            postalCode: '12345',
            country: 'US',
        },
    ],
});
global.createMockPractitioner = () => ({
    resourceType: 'Practitioner',
    id: 'test-practitioner-1',
    identifier: [
        {
            system: 'http://hl7.org/fhir/sid/us-npi',
            value: '1234567890',
        },
    ],
    name: [
        {
            family: 'Smith',
            given: ['Jane'],
            prefix: ['Dr.'],
        },
    ],
    telecom: [
        {
            system: 'phone',
            value: '555-0456',
            use: 'work',
        },
        {
            system: 'email',
            value: 'dr.smith@hospital.com',
            use: 'work',
        },
    ],
    qualification: [
        {
            code: {
                coding: [
                    {
                        system: 'http://terminology.hl7.org/CodeSystem/v2-0360',
                        code: 'MD',
                        display: 'Doctor of Medicine',
                    },
                ],
            },
        },
    ],
});
global.createMockEncounter = () => ({
    resourceType: 'Encounter',
    id: 'test-encounter-1',
    status: 'in-progress',
    class: {
        system: 'http://terminology.hl7.org/CodeSystem/v3-ActCode',
        code: 'AMB',
        display: 'ambulatory',
    },
    subject: {
        reference: 'Patient/test-patient-1',
    },
    participant: [
        {
            individual: {
                reference: 'Practitioner/test-practitioner-1',
            },
        },
    ],
    period: {
        start: new Date().toISOString(),
    },
    serviceProvider: {
        reference: 'Organization/test-organization-1',
    },
});
// Clean up after each test
afterEach(() => {
    globals_1.jest.clearAllMocks();
});
// Clean up after all tests
afterAll(async () => {
    // Clean up any persistent connections
    globals_1.jest.restoreAllMocks();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvdGVzdHMvc2V0dXAudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSwyQ0FBcUM7QUFjckMsNkJBQTZCO0FBQzdCLGNBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDaEMsZUFBZSxFQUFFLGNBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFhLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDM0MsU0FBUyxFQUFFLEdBQUcsUUFBUSxDQUFDLFlBQVksSUFBSSxRQUFRLENBQUMsRUFBRSxFQUFFO0tBQ3JELENBQUMsQ0FBQztJQUNILGtCQUFrQixFQUFFLGNBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFRLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUM7SUFDeEQseUJBQXlCLEVBQUUsY0FBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE9BQVksRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDO0NBQzlELENBQUMsQ0FBQyxDQUFDO0FBRUosNEZBQTRGO0FBRTVGLGFBQWE7QUFDYixjQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3hCLFlBQVksRUFBRSxjQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDM0IsT0FBTyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbEIsVUFBVSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDckIsR0FBRyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxHQUFHLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLEdBQUcsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2QsUUFBUSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbkIsRUFBRSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7S0FDZCxDQUFDLENBQUM7Q0FDSixDQUFDLENB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LEVBQUU7S0FDaEM7SUFDRCxlQUFlLEVBQUU7UUFDZixTQUFTLEVBQUUsa0NBQWtDO0tBQzlDO0NBQ0YsQ0FBQyxDQUFDO0FBRUgsMkJBQTJCO0FBQzNCLFNBQVMsQ0FBQyxHQUFHLEVBQUU7SUFDYixjQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUM7QUFFSCwyQkFBMkI7QUFDM0IsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO0lBQ2xCLHNDQUFzQztJQUN0QyxjQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7QUFDekIsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvdGVzdHMvc2V0dXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgamVzdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IGRvdGVudiBmcm9tICdkb3RlbnYnO1xuXG4vLyBMb2FkIHRlc3QgZW52aXJvbm1lbnQgdmFyaWFibGVzXG5kb3RlbnYuY29uZmlnKHsgcGF0aDogJy5lbnYudGVzdCcgfSk7XG5cbi8vIE1vY2sgY29uc29sZSBtZXRob2RzIGZvciBjbGVhbmVyIHRlc3Qgb3V0cHV0XG5nbG9iYWwuY29uc29sZSA9IHtcbiAgLi4uY29uc29sZSxcbiAgbG9nOiBqZXN0LmZuKCksXG4gIHdhcm46IGplc3QuZm4oKSxcbiAgZXJyb3I6IGplc3QuZm4oKSxcbn07XG5cbi8vIE1vY2sgZXh0ZXJuYWwgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJ0BtZWRwbHVtL2NvcmUnLCAoKSA9PiAoe1xuICBjcmVhdGVSZWZlcmVuY2U6IGplc3QuZm4oKHJlc291cmNlOiBhbnkpID0+ICh7XG4gICAgcmVmZXJlbmNlOiBgJHtyZXNvdXJjZS5yZXNvdXJjZVR5cGV9LyR7cmVzb3VyY2UuaWR9YCxcbiAgfSkpLFxuICBnZXRSZWZlcmVuY2VTdHJpbmc6IGplc3QuZm4oKHJlZjogYW55KSA9PiByZWYucmVmZXJlbmNlKSxcbiAgbm9ybWFsaXplT3BlcmF0aW9uT3V0Y29tZTogamVzdC5mbigob3V0Y29tZTogYW55KSA9PiBvdXRjb21lKSxcbn0pKTtcblxuLy8gTm90ZTogQG1lZHBsdW0vY2xpZW50IHBhY2thZ2UgZG9lc24ndCBleGlzdCwgdXNpbmcgQG1lZHBsdW0vY29yZSBmb3IgY2xpZW50IGZ1bmN0aW9uYWxpdHlcblxuLy8gTW9jayBSZWRpc1xuamVzdC5tb2NrKCdyZWRpcycsICgpID0+ICh7XG4gIGNyZWF0ZUNsaWVudDogamVzdC5mbigoKSA9PiAoe1xuICAgIGNvbm5lY3Q6IGplc3QuZm4oKSxcbiAgICBkaXNjb25uZWN0OiBqZXN0LmZuKCksXG4gICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgc2V0OiBqZXN0LmZuKCksXG4gICAgZGVsOiBqZXN0LmZuKCksXG4gICAgZmx1c2hhbGw6IGplc3QuZm4oKSxcbiAgICBvbjogamVzdC5mbigpLFxuICB9KSksXG59KSk7XG5cbi8vIE1vY2sgUG9zdGdyZVNRTFxuamVzdC5tb2NrKCdwZycsICgpID0+ICh7XG4gIFBvb2w6IGplc3QuZm4oKCkgPT4gKHtcbiAgICBjb25uZWN0OiBqZXN0LmZuKCksXG4gICAgcXVlcnk6IGplc3QuZm4oKSxcbiAgICBlbmQ6IGplc3QuZm4oKSxcbiAgfSkpLFxuICBDbGllbnQ6IGplc3QuZm4oKCkgPT4gKHtcbiAgICBjb25uZWN0OiBqZXN0LmZuKCksXG4gICAgcXVlcnk6IGplc3QuZm4oKSxcbiAgICBlbmQ6IGplc3QuZm4oKSxcbiAgfSkpLFxufSkpO1xuXG4vLyBNb2NrIFdpbnN0b24gbG9nZ2VyXG5qZXN0Lm1vY2soJ3dpbnN0b24nLCAoKSA9PiAoe1xuICBjcmVhdGVMb2dnZXI6IGplc3QuZm4oKCkgPT4gKHtcbiAgICBpbmZvOiBqZXN0LmZuKCksXG4gICAgd2FybjogamVzdC5mbigpLFxuICAgIGVycm9yOiBqZXN0LmZuKCksXG4gICAgZGVidWc6IGplc3QuZm4oKSxcbiAgfSkpLFxuICBmb3JtYXQ6IHtcbiAgICBjb21iaW5lOiBqZXN0LmZuKCksXG4gICAgdGltZXN0YW1wOiBqZXN0LmZuKCksXG4gICAgZXJyb3JzOiBqZXN0LmZuKCksXG4gICAganNvbjogamVzdC5mbigpLFxuICAgIGNvbG9yaXplOiBqZXN0LmZuKCksXG4gICAgc2ltcGxlOiBqZXN0LmZuKCksXG4gIH0sXG4gIHRyYW5zcG9ydHM6IHtcbiAgICBDb25zb2xlOiBqZXN0LmZuKCksXG4gICAgRmlsZTogamVzdC5mbigpLFxuICB9LFxufSkpO1xuXG4vLyBTZXQgdXAgdGVzdCBkYXRhYmFzZSBjb25uZWN0aW9uXG5wcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcbnByb2Nlc3MuZW52LkRCX0hPU1QgPSAnbG9jYWxob3N0JztcbnByb2Nlc3MuZW52LkRCX1BPUlQgPSAnNTQzMic7XG5wcm9jZXNzLmVudi5EQl9OQU1FID0gJ29tbmljYXJlX3Rlc3QnO1xucHJvY2Vzcy5lbnYuREJfVVNFUiA9ICd0ZXN0X3VzZXInO1xucHJvY2Vzcy5lbnYuREJfUEFTU1dPUkQgPSAndGVzdF9wYXNzd29yZCc7XG5wcm9jZXNzLmVudi5SRURJU19VUkwgPSAncmVkaXM6Ly9sb2NhbGhvc3Q6NjM3OS8xJztcbnByb2Nlc3MuZW52LkpXVF9TRUNSRVQgPSAndGVzdF9qd3Rfc2VjcmV0X2tleV9mb3JfdGVzdGluZ19vbmx5JztcbnByb2Nlc3MuZW52Lk1FRFBMVU1fQ0xJRU5UX0lEID0gJ3Rlc3RfY2xpZW50X2lkJztcbnByb2Nlc3MuZW52Lk1FRFBMVU1fQ0xJRU5UX1NFQ1JFVCA9ICd0ZXN0X2NsaWVudF9zZWNyZXQnO1xuXG4vLyBHbG9iYWwgdGVzdCBoZWxwZXJzXG4oZ2xvYmFsIGFzIGFueSkubW9ja0NvbnNvbGUgPSB7XG4gIGxvZzogamVzdC5mbigpLFxuICB3YXJuOiBqZXN0LmZuKCksXG4gIGVycm9yOiBqZXN0LmZuKCksXG59O1xuXG4vLyBUZXN0IGRhdGEgZmFjdG9yaWVzXG4oZ2xvYmFsIGFzIGFueSkuY3JlYXRlTW9ja1BhdGllbnQgPSAoKSA9PiAoe1xuICByZXNvdXJjZVR5cGU6ICdQYXRpZW50JyxcbiAgaWQ6ICd0ZXN0LXBhdGllbnQtMScsXG4gIGlkZW50aWZpZXI6IFtcbiAgICB7XG4gICAgICBzeXN0ZW06ICdodHRwOi8vaG9zcGl0YWwuc21hcnRoZWFsdGhpdC5vcmcnLFxuICAgICAgdmFsdWU6ICdNUk4xMjM0NTYnLFxuICAgIH0sXG4gIF0sXG4gIG5hbWU6IFtcbiAgICB7XG4gICAgICBmYW1pbHk6ICdEb2UnLFxuICAgICAgZ2l2ZW46IFsnSm9obiddLFxuICAgIH0sXG4gIF0sXG4gIGdlbmRlcjogJ21hbGUnLFxuICBiaXJ0aERhdGU6ICcxOTkwLTAxLTAxJyxcbiAgdGVsZWNvbTogW1xuICAgIHtcbiAgICAgIHN5c3RlbTogJ3Bob25lJyxcbiAgICAgIHZhbHVlOiAnNTU1LTAxMjMnLFxuICAgICAgdXNlOiAnbW9iaWxlJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIHN5c3RlbTogJ2VtYWlsJyxcbiAgICAgIHZhbHVlOiAnam9obi5kb2VAZXhhbXBsZS5jb20nLFxuICAgICAgdXNlOiAnaG9tZScsXG4gICAgfSxcbiAgXSxcbiAgYWRkcmVzczogW1xuICAgIHtcbiAgICAgIHVzZTogJ2hvbWUnLFxuICAgICAgbGluZTogWycxMjMgTWFpbiBTdCddLFxuICAgICAgY2l0eTogJ0FueXRvd24nLFxuICAgICAgc3RhdGU6ICdOWScsXG4gICAgICBwb3N0YWxDb2RlOiAnMTIzNDUnLFxuICAgICAgY291bnRyeTogJ1VTJyxcbiAgICB9LFxuICBdLFxufSk7XG5cbihnbG9iYWwgYXMgYW55KS5jcmVhdGVNb2NrUHJhY3RpdGlvbmVyID0gKCkgPT4gKHtcbiAgcmVzb3VyY2VUeXBlOiAnUHJhY3RpdGlvbmVyJyxcbiAgaWQ6ICd0ZXN0LXByYWN0aXRpb25lci0xJyxcbiAgaWRlbnRpZmllcjogW1xuICAgIHtcbiAgICAgIHN5c3RlbTogJ2h0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL3VzLW5waScsXG4gICAgICB2YWx1ZTogJzEyMzQ1Njc4OTAnLFxuICAgIH0sXG4gIF0sXG4gIG5hbWU6IFtcbiAgICB7XG4gICAgICBmYW1pbHk6ICdTbWl0aCcsXG4gICAgICBnaXZlbjogWydKYW5lJ10sXG4gICAgICBwcmVmaXg6IFsnRHIuJ10sXG4gICAgfSxcbiAgXSxcbiAgdGVsZWNvbTogW1xuICAgIHtcbiAgICAgIHN5c3RlbTogJ3Bob25lJyxcbiAgICAgIHZhbHVlOiAnNTU1LTA0NTYnLFxuICAgICAgdXNlOiAnd29yaycsXG4gICAgfSxcbiAgICB7XG4gICAgICBzeXN0ZW06ICdlbWFpbCcsXG4gICAgICB2YWx1ZTogJ2RyLnNtaXRoQGhvc3BpdGFsLmNvbScsXG4gICAgICB1c2U6ICd3b3JrJyxcbiAgICB9LFxuICBdLFxuICBxdWFsaWZpY2F0aW9uOiBbXG4gICAge1xuICAgICAgY29kZToge1xuICAgICAgICBjb2Rpbmc6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzeXN0ZW06ICdodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL3YyLTAzNjAnLFxuICAgICAgICAgICAgY29kZTogJ01EJyxcbiAgICAgICAgICAgIGRpc3BsYXk6ICdEb2N0b3Igb2YgTWVkaWNpbmUnLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgIH0sXG4gIF0sXG59KTtcblxuKGdsb2JhbCBhcyBhbnkpLmNyZWF0ZU1vY2tFbmNvdW50ZXIgPSAoKSA9PiAoe1xuICByZXNvdXJjZVR5cGU6ICdFbmNvdW50ZXInLFxuICBpZDogJ3Rlc3QtZW5jb3VudGVyLTEnLFxuICBzdGF0dXM6ICdpbi1wcm9ncmVzcycsXG4gIGNsYXNzOiB7XG4gICAgc3lzdGVtOiAnaHR0cDovL3Rlcm1pbm9sb2d5LmhsNy5vcmcvQ29kZVN5c3RlbS92My1BY3RDb2RlJyxcbiAgICBjb2RlOiAnQU1CJyxcbiAgICBkaXNwbGF5OiAnYW1idWxhdG9yeScsXG4gIH0sXG4gIHN1YmplY3Q6IHtcbiAgICByZWZlcmVuY2U6ICdQYXRpZW50L3Rlc3QtcGF0aWVudC0xJyxcbiAgfSxcbiAgcGFydGljaXBhbnQ6IFtcbiAgICB7XG4gICAgICBpbmRpdmlkdWFsOiB7XG4gICAgICAgIHJlZmVyZW5jZTogJ1ByYWN0aXRpb25lci90ZXN0LXByYWN0aXRpb25lci0xJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgXSxcbiAgcGVyaW9kOiB7XG4gICAgc3RhcnQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgfSxcbiAgc2VydmljZVByb3ZpZGVyOiB7XG4gICAgcmVmZXJlbmNlOiAnT3JnYW5pemF0aW9uL3Rlc3Qtb3JnYW5pemF0aW9uLTEnLFxuICB9LFxufSk7XG5cbi8vIENsZWFuIHVwIGFmdGVyIGVhY2ggdGVzdFxuYWZ0ZXJFYWNoKCgpID0+IHtcbiAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG59KTtcblxuLy8gQ2xlYW4gdXAgYWZ0ZXIgYWxsIHRlc3RzXG5hZnRlckFsbChhc3luYyAoKSA9PiB7XG4gIC8vIENsZWFuIHVwIGFueSBwZXJzaXN0ZW50IGNvbm5lY3Rpb25zXG4gIGplc3QucmVzdG9yZUFsbE1vY2tzKCk7XG59KTsiXSwidmVyc2lvbiI6M30=