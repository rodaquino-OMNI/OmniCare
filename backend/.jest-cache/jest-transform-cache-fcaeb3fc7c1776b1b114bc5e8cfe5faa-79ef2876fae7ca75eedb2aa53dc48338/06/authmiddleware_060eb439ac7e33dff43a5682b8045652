ae88167a28881a2a88c7975b43ba9ab8
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.requireScope = exports.auditLog = exports.requireAdmin = exports.requireResourceAccess = exports.requirePatientAccess = exports.requireMinimumRole = exports.requireRole = exports.requirePermissions = exports.requirePermission = exports.optionalAuthenticate = exports.smartAuthenticate = exports.authenticateToken = exports.authMiddleware = exports.authenticate = exports.AuthMiddleware = void 0;
const jwt_service_1 = require("@/auth/jwt.service");
const role_permissions_1 = require("@/auth/role-permissions");
const audit_service_1 = require("@/services/audit.service");
const session_service_1 = require("@/services/session.service");
const smart_fhir_service_1 = require("@/services/smart-fhir.service");
const auth_types_1 = require("@/types/auth.types");
const logger_1 = __importDefault(require("@/utils/logger"));
const error_utils_1 = require("@/utils/error.utils");
/**
 * Authentication middleware for SMART on FHIR and OmniCare JWT authentication
 */
class AuthMiddleware {
    static jwtService = new jwt_service_1.JWTAuthService();
    static sessionManager = new session_service_1.SessionManager();
    static auditService = new audit_service_1.AuditService();
    /**
     * OmniCare JWT Authentication middleware
     */
    static async authenticate(req, res, next) {
        try {
            const authHeader = req.headers.authorization;
            if (!authHeader) {
                await AuthMiddleware.auditService.logSecurityEvent({
                    type: 'LOGIN_FAILURE',
                    severity: 'LOW',
                    description: 'Missing authorization header',
                    metadata: {
                        path: req.path,
                        method: req.method,
                        ip: req.ip,
                    }
                });
                res.status(401).json({
                    success: false,
                    error: 'MISSING_AUTHORIZATION',
                    message: 'Authorization header is required'
                });
                return;
            }
            const token = AuthMiddleware.jwtService.extractTokenFromHeader(authHeader);
            if (!token) {
                res.status(401).json({
                    success: false,
                    error: 'INVALID_TOKEN_FORMAT',
                    message: 'Invalid authorization header format. Expected: Bearer <token>'
                });
                return;
            }
            req.token = token;
            // Verify JWT token
            const tokenPayload = await AuthMiddleware.jwtService.verifyAccessToken(token);
            // Get and validate session
            const session = await AuthMiddleware.sessionManager.getSession(tokenPayload.sessionId);
            if (!session) {
                res.status(401).json({
                    success: false,
                    error: 'SESSION_EXPIRED',
                    message: 'Your session has expired. Please log in again.'
                });
                return;
            }
            // Validate session security
            const securityValidation = await AuthMiddleware.sessionManager.validateSessionSecurity(session, req.ip || 'unknown', req.get('User-Agent') || 'unknown');
            if (!securityValidation.isValid) {
                await AuthMiddleware.auditService.logSecurityEvent({
                    type: 'UNAUTHORIZED_ACCESS',
                    userId: session.userId,
                    severity: 'HIGH',
                    description: 'Session security validation failed',
                    metadata: {
                        sessionId: session.sessionId,
                        securityIssues: securityValidation.securityIssues,
                        ipAddress: req.ip,
                        userAgent: req.get('User-Agent')
                    }
                });
                // Destroy compromised session
                await AuthMiddleware.sessionManager.destroySession(session.sessionId);
                res.status(401).json({
                    success: false,
                    error: 'SECURITY_VIOLATION',
                    message: 'Session security validation failed. Please log in again.'
                });
                return;
            }
            // Update session activity
            const updatedSession = await AuthMiddleware.sessionManager.updateSessionActivity(session.sessionId);
            if (updatedSession) {
                req.session = updatedSession;
            }
            // Mock user lookup - replace with actual database query
            const user = await AuthMiddleware.getUserById(tokenPayload.userId);
            if (!user || !user.isActive) {
                res.status(401).json({
                    success: false,
                    error: 'USER_INACTIVE',
                    message: 'User account is not active'
                });
                return;
            }
            req.user = user;
            // Log successful authentication
            await AuthMiddleware.auditService.logUserAction(user.id, 'authenticate', req.path, undefined, req.ip || 'unknown', req.get('User-Agent') || 'unknown', true);
            next();
        }
        catch (error) {
            await AuthMiddleware.auditService.logSecurityEvent({
                type: 'LOGIN_FAILURE',
                severity: 'MEDIUM',
                description: 'Authentication failed',
                metadata: {
                    error: (0, error_utils_1.getErrorMessage)(error),
                    ipAddress: req.ip,
                    userAgent: req.get('User-Agent'),
                    path: req.path
                }
            });
            res.status(401).json({
                success: false,
                error: 'AUTHENTICATION_FAILED',
                message: 'Invalid or expired authentication token'
            });
        }
    }
    /**
     * SMART on FHIR Authentication (for external systems)
     */
    static async smartAuthenticate(req, res, next) {
        try {
            const authHeader = req.headers.authorization;
            if (!authHeader) {
                res.status(401).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'login',
                            diagnostics: 'Authorization header is required',
                        }],
                });
                return;
            }
            const parts = authHeader.split(' ');
            if (parts.length !== 2 || parts[0] !== 'Bearer') {
                res.status(401).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'login',
                            diagnostics: 'Invalid authorization header format. Expected: Bearer <token>',
                        }],
                });
                return;
            }
            const token = parts[1];
            if (!token) {
                res.status(401).json({
                    success: false,
                    error: 'MISSING_TOKEN',
                    message: 'No token provided'
                });
                return;
            }
            req.token = token;
            // Try SMART token introspection
            const introspectionResult = await smart_fhir_service_1.smartFHIRService.introspectToken(token);
            if (!introspectionResult.active) {
                res.status(401).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'login',
                            diagnostics: 'Token is not active',
                        }],
                });
                return;
            }
            req.smartAuth = {
                id: introspectionResult.sub || introspectionResult.patient,
                sub: introspectionResult.sub,
                scope: introspectionResult.scope ? introspectionResult.scope.split(' ') : [],
                patient: introspectionResult.patient,
                encounter: introspectionResult.encounter,
                fhirUser: introspectionResult.fhirUser,
                iss: introspectionResult.iss,
                aud: introspectionResult.aud,
                clientId: introspectionResult.client_id,
                tokenType: 'smart',
            };
            logger_1.default.security('SMART token authentication successful', {
                userId: req.smartAuth.id,
                clientId: req.smartAuth.clientId,
                path: req.path,
                method: req.method,
            });
            next();
        }
        catch (error) {
            logger_1.default.error('SMART authentication failed:', error);
            res.status(401).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'login',
                        diagnostics: 'Invalid or expired token',
                    }],
            });
        }
    }
    /**
     * Optional authentication - allows both authenticated and unauthenticated requests
     */
    static async optionalAuthenticate(req, res, next) {
        const authHeader = req.headers.authorization;
        if (!authHeader) {
            // No authentication provided, continue without user context
            next();
            return;
        }
        // Authentication provided, validate it
        await AuthMiddleware.authenticate(req, res, next);
    }
    /**
     * Permission-based authorization middleware
     */
    static requirePermission(...requiredPermissions) {
        return async (req, res, next) => {
            if (!req.user) {
                res.status(401).json({
                    success: false,
                    error: 'AUTHENTICATION_REQUIRED',
                    message: 'Authentication required'
                });
                return;
            }
            const { user } = req;
            // Check if user has all required permissions
            const hasAllPermissions = requiredPermissions.every(permission => (0, role_permissions_1.hasPermission)(user.role, permission));
            if (!hasAllPermissions) {
                await AuthMiddleware.auditService.logUserAction(user.id, 'unauthorized_access_attempt', req.path, undefined, req.ip || 'unknown', req.get('User-Agent') || 'unknown', false, `Missing required permissions: ${requiredPermissions.join(', ')}`);
                res.status(403).json({
                    success: false,
                    error: 'INSUFFICIENT_PERMISSIONS',
                    message: 'You do not have permission to access this resource'
                });
                return;
            }
            next();
        };
    }
    /**
     * Role-based authorization middleware
     */
    static requireRole(...allowedRoles) {
        return async (req, res, next) => {
            if (!req.user) {
                res.status(401).json({
                    success: false,
                    error: 'AUTHENTICATION_REQUIRED',
                    message: 'Authentication required'
                });
                return;
            }
            const { user } = req;
            if (!allowedRoles.includes(user.role)) {
                await AuthMiddleware.auditService.logUserAction(user.id, 'unauthorized_role_access', req.path, undefined, req.ip || 'unknown', req.get('User-Agent') || 'unknown', false, `User role ${user.role} not in allowed roles: ${allowedRoles.join(', ')}`);
                res.status(403).json({
                    success: false,
                    error: 'INSUFFICIENT_PRIVILEGES',
                    message: 'Your role does not have access to this resource'
                });
                return;
            }
            next();
        };
    }
    /**
     * Hierarchical role authorization (user must have higher or equal role)
     */
    static requireMinimumRole(minimumRole) {
        return async (req, res, next) => {
            if (!req.user) {
                res.status(401).json({
                    success: false,
                    error: 'AUTHENTICATION_REQUIRED',
                    message: 'Authentication required'
                });
                return;
            }
            const { user } = req;
            if (!(0, role_permissions_1.hasHigherRole)(user.role, minimumRole) && user.role !== minimumRole) {
                await AuthMiddleware.auditService.logUserAction(user.id, 'insufficient_role_level', req.path, undefined, req.ip || 'unknown', req.get('User-Agent') || 'unknown', false, `User role ${user.role} below minimum required role: ${minimumRole}`);
                res.status(403).json({
                    success: false,
                    error: 'INSUFFICIENT_ROLE_LEVEL',
                    message: 'Your role level is insufficient for this resource'
                });
                return;
            }
            next();
        };
    }
    /**
     * Patient-specific authorization - ensure user can access specific patient data
     */
    static requirePatientAccess(req, res, next) {
        if (!req.user) {
            res.status(401).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'login',
                        diagnostics: 'Authentication required',
                    }],
            });
            return;
        }
        const requestedPatientId = req.params.patientId || req.params.id;
        const authorizedPatientId = req.user.patient;
        // Check if user has system-level access
        const hasSystemAccess = req.user.scope?.some(scope => scope.includes('system/') || scope === '*');
        if (hasSystemAccess) {
            // System-level access allows access to any patient
            next();
            return;
        }
        // For patient-level access, verify patient ID matches
        if (!authorizedPatientId) {
            logger_1.default.security('Patient access denied - no patient context', {
                userId: req.user.id,
                requestedPatientId,
                path: req.path,
                method: req.method,
            });
            res.status(403).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'forbidden',
                        diagnostics: 'No patient context available',
                    }],
            });
            return;
        }
        if (requestedPatientId && authorizedPatientId !== requestedPatientId) {
            logger_1.default.security('Patient access denied - patient ID mismatch', {
                userId: req.user.id,
                authorizedPatientId,
                requestedPatientId,
                path: req.path,
                method: req.method,
            });
            res.status(403).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'forbidden',
                        diagnostics: 'Access denied to requested patient',
                    }],
            });
            return;
        }
        next();
    }
    /**
     * Resource-specific authorization middleware
     */
    static requireResourceAccess(resourceType, operation) {
        return (req, res, next) => {
            if (!req.user) {
                res.status(401).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'login',
                            diagnostics: 'Authentication required',
                        }],
                });
                return;
            }
            const userScopes = req.user.scope || [];
            // Check for specific resource access
            const resourceScopes = [
                `system/${resourceType}.${operation}`,
                `system/${resourceType}.*`,
                `user/${resourceType}.${operation}`,
                `user/${resourceType}.*`,
                `patient/${resourceType}.${operation}`,
                `patient/${resourceType}.*`,
                operation === 'read' ? `system/${resourceType}.read` : null,
                operation === 'write' ? `system/${resourceType}.write` : null,
                '*',
            ].filter(Boolean);
            const hasAccess = resourceScopes.some(scope => userScopes.includes(scope));
            if (!hasAccess) {
                logger_1.default.security('Resource access denied', {
                    userId: req.user.id,
                    resourceType,
                    operation,
                    userScopes,
                    path: req.path,
                    method: req.method,
                });
                res.status(403).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'forbidden',
                            diagnostics: `Insufficient permissions for ${resourceType} ${operation}`,
                        }],
                });
                return;
            }
            next();
        };
    }
    /**
     * SMART on FHIR scope authorization middleware
     */
    static requireScope(requiredScopes) {
        return (req, res, next) => {
            if (!req.user && !req.smartAuth) {
                res.status(401).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'login',
                            diagnostics: 'Authentication required',
                        }],
                });
                return;
            }
            const userScopes = req.user?.scope || req.smartAuth?.scope || [];
            // Check if user has any of the required scopes
            const hasRequiredScope = requiredScopes.some(requiredScope => {
                // Check for exact match
                if (userScopes.includes(requiredScope)) {
                    return true;
                }
                // Check for wildcard matches
                if (userScopes.includes('*')) {
                    return true;
                }
                // Check for partial wildcard matches (e.g., system/* matches system/*.read)
                const scopeParts = requiredScope.split('/');
                const resourcePart = scopeParts[0];
                const permissionPart = scopeParts[1];
                return userScopes.some(userScope => {
                    if (userScope === `${resourcePart}/*`) {
                        return true;
                    }
                    if (permissionPart && userScope === `${resourcePart}/${permissionPart.split('.')[0]}.*`) {
                        return true;
                    }
                    return false;
                });
            });
            if (!hasRequiredScope) {
                logger_1.default.security('Scope access denied', {
                    userId: req.user?.id || req.smartAuth?.id,
                    requiredScopes,
                    userScopes,
                    path: req.path,
                    method: req.method,
                });
                res.status(403).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'forbidden',
                            diagnostics: `Insufficient scopes. Required: ${requiredScopes.join(' or ')}`,
                        }],
                });
                return;
            }
            next();
        };
    }
    /**
     * Admin role authorization
     */
    static requireAdmin(req, res, next) {
        if (!req.user) {
            res.status(401).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'login',
                        diagnostics: 'Authentication required',
                    }],
            });
            return;
        }
        const isAdmin = req.user.scope?.includes('admin') ||
            req.user.scope?.includes('*') ||
            req.user.scope?.includes('system/*.*');
        if (!isAdmin) {
            logger_1.default.security('Admin access denied', {
                userId: req.user.id,
                userScopes: req.user.scope,
                path: req.path,
                method: req.method,
            });
            res.status(403).json({
                resourceType: 'OperationOutcome',
                issue: [{
                        severity: 'error',
                        code: 'forbidden',
                        diagnostics: 'Administrator privileges required',
                    }],
            });
            return;
        }
        next();
    }
    /**
     * Mock user lookup - replace with actual database query
     */
    static async getUserById(userId) {
        try {
            // Mock implementation - replace with actual database query
            const mockUsers = {
                'user-1': {
                    id: 'user-1',
                    username: 'admin@omnicare.com',
                    email: 'admin@omnicare.com',
                    firstName: 'System',
                    lastName: 'Administrator',
                    role: auth_types_1.UserRoles.SYSTEM_ADMINISTRATOR,
                    department: 'IT',
                    isActive: true,
                    isMfaEnabled: true,
                    passwordChangedAt: new Date(),
                    failedLoginAttempts: 0,
                    createdAt: new Date(),
                    updatedAt: new Date()
                },
                'user-2': {
                    id: 'user-2',
                    username: 'doctor@omnicare.com',
                    email: 'doctor@omnicare.com',
                    firstName: 'Dr. Jane',
                    lastName: 'Smith',
                    role: auth_types_1.UserRoles.PHYSICIAN,
                    department: 'Cardiology',
                    licenseNumber: 'MD123456',
                    npiNumber: '1234567890',
                    isActive: true,
                    isMfaEnabled: true,
                    passwordChangedAt: new Date(),
                    failedLoginAttempts: 0,
                    createdAt: new Date(),
                    updatedAt: new Date()
                },
                'user-3': {
                    id: 'user-3',
                    username: 'nurse@omnicare.com',
                    email: 'nurse@omnicare.com',
                    firstName: 'Sarah',
                    lastName: 'Johnson',
                    role: auth_types_1.UserRoles.NURSING_STAFF,
                    department: 'Emergency',
                    licenseNumber: 'RN789012',
                    isActive: true,
                    isMfaEnabled: false,
                    passwordChangedAt: new Date(),
                    failedLoginAttempts: 0,
                    createdAt: new Date(),
                    updatedAt: new Date()
                }
            };
            return mockUsers[userId] || null;
        }
        catch (error) {
            logger_1.default.error('Get user by ID failed:', error);
            return null;
        }
    }
    /**
     * Rate limiting based on user or client
     */
    static createRateLimiter(windowMs = 15 * 60 * 1000, max = 100) {
        const rateLimitStore = new Map();
        return (req, res, next) => {
            const key = req.user?.id || req.user?.clientId || req.ip || 'unknown';
            const now = Date.now();
            const userLimit = rateLimitStore.get(key);
            if (!userLimit || now > userLimit.resetTime) {
                // Reset or create new limit
                rateLimitStore.set(key, {
                    count: 1,
                    resetTime: now + windowMs,
                });
                res.setHeader('X-RateLimit-Limit', max);
                res.setHeader('X-RateLimit-Remaining', max - 1);
                res.setHeader('X-RateLimit-Reset', new Date(now + windowMs).toISOString());
                next();
                return;
            }
            if (userLimit.count >= max) {
                logger_1.default.security('Rate limit exceeded', {
                    key,
                    userId: req.user?.id,
                    clientId: req.user?.clientId,
                    path: req.path,
                    method: req.method,
                    count: userLimit.count,
                    limit: max,
                });
                res.status(429).json({
                    resourceType: 'OperationOutcome',
                    issue: [{
                            severity: 'error',
                            code: 'throttled',
                            diagnostics: 'Rate limit exceeded. Please try again later.',
                        }],
                });
                return;
            }
            userLimit.count++;
            rateLimitStore.set(key, userLimit);
            res.setHeader('X-RateLimit-Limit', max);
            res.setHeader('X-RateLimit-Remaining', max - userLimit.count);
            res.setHeader('X-RateLimit-Reset', new Date(userLimit.resetTime).toISOString());
            next();
        };
    }
    /**
     * Audit logging middleware
     */
    static auditLog(req, res, next) {
        const startTime = Date.now();
        // Log request
        logger_1.default.audit('API request initiated', {
            userId: req.user?.id,
            clientId: req.user?.clientId,
            method: req.method,
            path: req.path,
            query: req.query,
            userAgent: req.get('User-Agent'),
            ip: req.ip,
            timestamp: new Date().toISOString(),
        });
        // Override res.json to log response
        const originalJson = res.json;
        res.json = function (body) {
            const duration = Date.now() - startTime;
            logger_1.default.audit('API request completed', {
                userId: req.user?.id,
                clientId: req.user?.clientId,
                method: req.method,
                path: req.path,
                statusCode: res.statusCode,
                duration: `${duration}ms`,
                timestamp: new Date().toISOString(),
            });
            return originalJson.call(this, body);
        };
        next();
    }
}
exports.AuthMiddleware = AuthMiddleware;
// Convenience exports for OmniCare authentication
exports.authenticate = AuthMiddleware.authenticate;
exports.authMiddleware = AuthMiddleware.authenticate; // Alias for test compatibility
exports.authenticateToken = AuthMiddleware.authenticate; // Alias for backward compatibility
exports.smartAuthenticate = AuthMiddleware.smartAuthenticate;
exports.optionalAuthenticate = AuthMiddleware.optionalAuthenticate;
exports.requirePermission = AuthMiddleware.requirePermission;
exports.requirePermissions = AuthMiddleware.requirePermission; // Alias for test compatibility
exports.requireRole = AuthMiddleware.requireRole;
exports.requireMinimumRole = AuthMiddleware.requireMinimumRole;
exports.requirePatientAccess = AuthMiddleware.requirePatientAccess;
exports.requireResourceAccess = AuthMiddleware.requireResourceAccess;
exports.requireAdmin = AuthMiddleware.requireAdmin;
exports.auditLog = AuthMiddleware.auditLog;
exports.requireScope = AuthMiddleware.requireScope;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvc3JjL21pZGRsZXdhcmUvYXV0aC5taWRkbGV3YXJlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUdBLG9EQUFvRDtBQUNwRCw4REFBdUU7QUFFdkUsNERBQXdEO0FBQ3hELGdFQUE0RDtBQUM1RCxzRUFBaUU7QUFDakUsbURBQXdGO0FBQ3hGLDREQUFvQztBQUNwQyxxREFBc0Q7QUEwQnREOztHQUVHO0FBQ0gsTUFBYSxjQUFjO0lBQ2pCLE1BQU0sQ0FBQyxVQUFVLEdBQUcsSUFBSSw0QkFBYyxFQUFFLENBQUM7SUFDekMsTUFBTSxDQUFDLGNBQWMsR0FBRyxJQUFJLGdDQUFjLEVBQUUsQ0FBQztJQUM3QyxNQUFNLENBQUMsWUFBWSxHQUFHLElBQUksNEJBQVksRUFBRSxDQUFDO0lBRWpEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBWSxFQUFFLEdBQWEsRUFBRSxJQUFrQjtRQUN2RSxJQUFJLENBQUM7WUFDSCxNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQztZQUM3QyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQ2hCLE1BQU0sY0FBYyxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQztvQkFDakQsSUFBSSxFQUFFLGVBQWU7b0JBQ3JCLFFBQVEsRUFBRSxLQUFLO29CQUNmLFdBQVcsRUFBRSw4QkFBOEI7b0JBQzNDLFFBQVEsRUFBRTt3QkFDUixJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUk7d0JBQ2QsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNO3dCQUNsQixFQUFFLEVBQUUsR0FBRyxDQUFDLEVBQUU7cUJBQ1g7aUJBQ0YsQ0FBQyxDQUFDO2dCQUVILEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUNuQixPQUFPLEVBQUUsS0FBSztvQkFDZCxLQUFLLEVBQUUsdUJBQXVCO29CQUM5QixP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LENBQUMsWUFBWSxDQUFDO0FBQzNDLFFBQUEsY0FBYyxHQUFHLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQywrQkFBK0I7QUFDN0UsUUFBQSxpQkFBaUIsR0FBRyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUMsbUNBQW1DO0FBQ3BGLFFBQUEsaUJBQWlCLEdBQUcsY0FBYyxDQUFDLGlCQUFpQixDQUFDO0FBQ3JELFFBQUEsb0JBQW9CLEdBQUcsY0FBYyxDQUFDLG9CQUFvQixDQUFDO0FBQzNELFFBQUEsaUJBQWlCLEdBQUcsY0FBYyxDQUFDLGlCQUFpQixDQUFDO0FBQ3JELFFBQUEsa0JBQWtCLEdBQUcsY0FBYyxDQUFDLGlCQUFpQixDQUFDLENBQUMsK0JBQStCO0FBQ3RGLFFBQUEsV0FBVyxHQUFHLGNBQWMsQ0FBQyxXQUFXLENBQUM7QUFDekMsUUFBQSxrQkFBa0IsR0FBRyxjQUFjLENBQUMsa0JBQWtCLENBQUM7QUFDdkQsUUFBQSxvQkFBb0IsR0FBRyxjQUFjLENBQUMsb0JBQW9CLENBQUM7QUFDM0QsUUFBQSxxQkFBcUIsR0FBRyxjQUFjLENBQUMscUJBQXFCLENBQUM7QUFDN0QsUUFBQSxZQUFZLEdBQUcsY0FBYyxDQUFDLFlBQVksQ0FBQztBQUMzQyxRQUFBLFFBQVEsR0FBRyxjQUFjLENBQUMsUUFBUSxDQUFDO0FBQ25DLFFBQUEsWUFBWSxHQUFHLGNBQWMsQ0FBQyxZQUFZLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3JvZHJpZ28vY2xhdWRlLXByb2plY3RzL09tbmlDYXJlL2JhY2tlbmQvc3JjL21pZGRsZXdhcmUvYXV0aC5taWRkbGV3YXJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlLCBOZXh0RnVuY3Rpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcblxuaW1wb3J0IHsgSldUQXV0aFNlcnZpY2UgfSBmcm9tICdAL2F1dGgvand0LnNlcnZpY2UnO1xuaW1wb3J0IHsgaGFzUGVybWlzc2lvbiwgaGFzSGlnaGVyUm9sZSB9IGZyb20gJ0AvYXV0aC9yb2xlLXBlcm1pc3Npb25zJztcbmltcG9ydCBjb25maWcgZnJvbSAnQC9jb25maWcnO1xuaW1wb3J0IHsgQXVkaXRTZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9hdWRpdC5zZXJ2aWNlJztcbmltcG9ydCB7IFNlc3Npb25NYW5hZ2VyIH0gZnJvbSAnQC9zZXJ2aWNlcy9zZXNzaW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgc21hcnRGSElSU2VydmljZSB9IGZyb20gJ0Avc2VydmljZXMvc21hcnQtZmhpci5zZXJ2aWNlJztcbmltcG9ydCB7IFVzZXIsIFVzZXJSb2xlLCBVc2VyUm9sZXMsIFBlcm1pc3Npb24sIFNlc3Npb25JbmZvIH0gZnJvbSAnQC90eXBlcy9hdXRoLnR5cGVzJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnQC91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZ2V0RXJyb3JNZXNzYWdlIH0gZnJvbSAnQC91dGlscy9lcnJvci51dGlscyc7XG5cbi8vIEV4dGVuZGVkIFJlcXVlc3QgaW50ZXJmYWNlIHRvIGluY2x1ZGUgYXV0aGVudGljYXRpb24gZGF0YVxuZGVjbGFyZSBnbG9iYWwge1xuICBuYW1lc3BhY2UgRXhwcmVzcyB7XG4gICAgaW50ZXJmYWNlIFJlcXVlc3Qge1xuICAgICAgdXNlcj86IFVzZXI7XG4gICAgICBzZXNzaW9uPzogU2Vzc2lvbkluZm87XG4gICAgICB0b2tlbj86IHN0cmluZztcbiAgICAgIHJlcXVlc3RJZD86IHN0cmluZztcbiAgICAgIHNtYXJ0QXV0aD86IHtcbiAgICAgICAgaWQ6IHN0cmluZztcbiAgICAgICAgc3ViOiBzdHJpbmc7XG4gICAgICAgIHNjb3BlOiBzdHJpbmdbXTtcbiAgICAgICAgcGF0aWVudD86IHN0cmluZztcbiAgICAgICAgZW5jb3VudGVyPzogc3RyaW5nO1xuICAgICAgICBmaGlyVXNlcj86IHN0cmluZztcbiAgICAgICAgaXNzPzogc3RyaW5nO1xuICAgICAgICBhdWQ/OiBzdHJpbmc7XG4gICAgICAgIGNsaWVudElkPzogc3RyaW5nO1xuICAgICAgICB0b2tlblR5cGU/OiBzdHJpbmc7XG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEF1dGhlbnRpY2F0aW9uIG1pZGRsZXdhcmUgZm9yIFNNQVJUIG9uIEZISVIgYW5kIE9tbmlDYXJlIEpXVCBhdXRoZW50aWNhdGlvblxuICovXG5leHBvcnQgY2xhc3MgQXV0aE1pZGRsZXdhcmUge1xuICBwcml2YXRlIHN0YXRpYyBqd3RTZXJ2aWNlID0gbmV3IEpXVEF1dGhTZXJ2aWNlKCk7XG4gIHByaXZhdGUgc3RhdGljIHNlc3Npb25NYW5hZ2VyID0gbmV3IFNlc3Npb25NYW5hZ2VyKCk7XG4gIHByaXZhdGUgc3RhdGljIGF1ZGl0U2VydmljZSA9IG5ldyBBdWRpdFNlcnZpY2UoKTtcblxuICAvKipcbiAgICogT21uaUNhcmUgSldUIEF1dGhlbnRpY2F0aW9uIG1pZGRsZXdhcmVcbiAgICovXG4gIHN0YXRpYyBhc3luYyBhdXRoZW50aWNhdGUocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XG4gICAgICBpZiAoIWF1dGhIZWFkZXIpIHtcbiAgICAgICAgYXdhaXQgQXV0aE1pZGRsZXdhcmUuYXVkaXRTZXJ2aWNlLmxvZ1NlY3VyaXR5RXZlbnQoe1xuICAgICAgICAgIHR5cGU6ICdMT0dJTl9GQUlMVVJFJyxcbiAgICAgICAgICBzZXZlcml0eTogJ0xPVycsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdNaXNzaW5nIGF1dGhvcml6YXRpb24gaGVhZGVyJyxcbiAgICAgICAgICBtZXRhZGF0YTogeyBcbiAgICAgICAgICAgIHBhdGg6IHJlcS5wYXRoLFxuICAgICAgICAgICAgbWV0aG9kOiByZXEubWV0aG9kLFxuICAgICAgICAgICAgaXA6IHJlcS5pcCxcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnTUlTU0lOR19BVVRIT1JJWkFUSU9OJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aG9yaXphdGlvbiBoZWFkZXIgaXMgcmVxdWlyZWQnXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRva2VuID0gQXV0aE1pZGRsZXdhcmUuand0U2VydmljZS5leHRyYWN0VG9rZW5Gcm9tSGVhZGVyKGF1dGhIZWFkZXIpO1xuICAgICAgaWYgKCF0b2tlbikge1xuICAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdJTlZBTElEX1RPS0VOX0ZPUk1BVCcsXG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgYXV0aG9yaXphdGlvbiBoZWFkZXIgZm9ybWF0LiBFeHBlY3RlZDogQmVhcmVyIDx0b2tlbj4nXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHJlcS50b2tlbiA9IHRva2VuO1xuXG4gICAgICAvLyBWZXJpZnkgSldUIHRva2VuXG4gICAgICBjb25zdCB0b2tlblBheWxvYWQgPSBhd2FpdCBBdXRoTWlkZGxld2FyZS5qd3RTZXJ2aWNlLnZlcmlmeUFjY2Vzc1Rva2VuKHRva2VuKTtcbiAgICAgIFxuICAgICAgLy8gR2V0IGFuZCB2YWxpZGF0ZSBzZXNzaW9uXG4gICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgQXV0aE1pZGRsZXdhcmUuc2Vzc2lvbk1hbmFnZXIuZ2V0U2Vzc2lvbih0b2tlblBheWxvYWQuc2Vzc2lvbklkKTtcbiAgICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdTRVNTSU9OX0VYUElSRUQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdZb3VyIHNlc3Npb24gaGFzIGV4cGlyZWQuIFBsZWFzZSBsb2cgaW4gYWdhaW4uJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSBzZXNzaW9uIHNlY3VyaXR5XG4gICAgICBjb25zdCBzZWN1cml0eVZhbGlkYXRpb24gPSBhd2FpdCBBdXRoTWlkZGxld2FyZS5zZXNzaW9uTWFuYWdlci52YWxpZGF0ZVNlc3Npb25TZWN1cml0eShcbiAgICAgICAgc2Vzc2lvbixcbiAgICAgICAgcmVxLmlwIHx8ICd1bmtub3duJyxcbiAgICAgICAgcmVxLmdldCgnVXNlci1BZ2VudCcpIHx8ICd1bmtub3duJ1xuICAgICAgKTtcblxuICAgICAgaWYgKCFzZWN1cml0eVZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgICBhd2FpdCBBdXRoTWlkZGxld2FyZS5hdWRpdFNlcnZpY2UubG9nU2VjdXJpdHlFdmVudCh7XG4gICAgICAgICAgdHlwZTogJ1VOQVVUSE9SSVpFRF9BQ0NFU1MnLFxuICAgICAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VySWQsXG4gICAgICAgICAgc2V2ZXJpdHk6ICdISUdIJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ1Nlc3Npb24gc2VjdXJpdHkgdmFsaWRhdGlvbiBmYWlsZWQnLFxuICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICBzZXNzaW9uSWQ6IHNlc3Npb24uc2Vzc2lvbklkLFxuICAgICAgICAgICAgc2VjdXJpdHlJc3N1ZXM6IHNlY3VyaXR5VmFsaWRhdGlvbi5zZWN1cml0eUlzc3VlcyxcbiAgICAgICAgICAgIGlwQWRkcmVzczogcmVxLmlwLFxuICAgICAgICAgICAgdXNlckFnZW50OiByZXEuZ2V0KCdVc2VyLUFnZW50JylcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIERlc3Ryb3kgY29tcHJvbWlzZWQgc2Vzc2lvblxuICAgICAgICBhd2FpdCBBdXRoTWlkZGxld2FyZS5zZXNzaW9uTWFuYWdlci5kZXN0cm95U2Vzc2lvbihzZXNzaW9uLnNlc3Npb25JZCk7XG5cbiAgICAgICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnU0VDVVJJVFlfVklPTEFUSU9OJyxcbiAgICAgICAgICBtZXNzYWdlOiAnU2Vzc2lvbiBzZWN1cml0eSB2YWxpZGF0aW9uIGZhaWxlZC4gUGxlYXNlIGxvZyBpbiBhZ2Fpbi4nXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBzZXNzaW9uIGFjdGl2aXR5XG4gICAgICBjb25zdCB1cGRhdGVkU2Vzc2lvbiA9IGF3YWl0IEF1dGhNaWRkbGV3YXJlLnNlc3Npb25NYW5hZ2VyLnVwZGF0ZVNlc3Npb25BY3Rpdml0eShzZXNzaW9uLnNlc3Npb25JZCk7XG4gICAgICBpZiAodXBkYXRlZFNlc3Npb24pIHtcbiAgICAgICAgcmVxLnNlc3Npb24gPSB1cGRhdGVkU2Vzc2lvbjtcbiAgICAgIH1cblxuICAgICAgLy8gTW9jayB1c2VyIGxvb2t1cCAtIHJlcGxhY2Ugd2l0aCBhY3R1YWwgZGF0YWJhc2UgcXVlcnlcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBBdXRoTWlkZGxld2FyZS5nZXRVc2VyQnlJZCh0b2tlblBheWxvYWQudXNlcklkKTtcbiAgICAgIGlmICghdXNlciB8fCAhdXNlci5pc0FjdGl2ZSkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdVU0VSX0lOQUNUSVZFJyxcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBhY2NvdW50IGlzIG5vdCBhY3RpdmUnXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHJlcS51c2VyID0gdXNlcjtcblxuICAgICAgLy8gTG9nIHN1Y2Nlc3NmdWwgYXV0aGVudGljYXRpb25cbiAgICAgIGF3YWl0IEF1dGhNaWRkbGV3YXJlLmF1ZGl0U2VydmljZS5sb2dVc2VyQWN0aW9uKFxuICAgICAgICB1c2VyLmlkLFxuICAgICAgICAnYXV0aGVudGljYXRlJyxcbiAgICAgICAgcmVxLnBhdGgsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgcmVxLmlwIHx8ICd1bmtub3duJyxcbiAgICAgICAgcmVxLmdldCgnVXNlci1BZ2VudCcpIHx8ICd1bmtub3duJyxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcblxuICAgICAgbmV4dCgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBhd2FpdCBBdXRoTWlkZGxld2FyZS5hdWRpdFNlcnZpY2UubG9nU2VjdXJpdHlFdmVudCh7XG4gICAgICAgIHR5cGU6ICdMT0dJTl9GQUlMVVJFJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdNRURJVU0nLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCcsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgZXJyb3I6IGdldEVycm9yTWVzc2FnZShlcnJvciksXG4gICAgICAgICAgaXBBZGRyZXNzOiByZXEuaXAsXG4gICAgICAgICAgdXNlckFnZW50OiByZXEuZ2V0KCdVc2VyLUFnZW50JyksXG4gICAgICAgICAgcGF0aDogcmVxLnBhdGhcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnQVVUSEVOVElDQVRJT05fRkFJTEVEJyxcbiAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgb3IgZXhwaXJlZCBhdXRoZW50aWNhdGlvbiB0b2tlbidcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTTUFSVCBvbiBGSElSIEF1dGhlbnRpY2F0aW9uIChmb3IgZXh0ZXJuYWwgc3lzdGVtcylcbiAgICovXG4gIHN0YXRpYyBhc3luYyBzbWFydEF1dGhlbnRpY2F0ZShyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbjtcbiAgICAgIGlmICghYXV0aEhlYWRlcikge1xuICAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdsb2dpbicsXG4gICAgICAgICAgICBkaWFnbm9zdGljczogJ0F1dGhvcml6YXRpb24gaGVhZGVyIGlzIHJlcXVpcmVkJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcGFydHMgPSBhdXRoSGVhZGVyLnNwbGl0KCcgJyk7XG4gICAgICBpZiAocGFydHMubGVuZ3RoICE9PSAyIHx8IHBhcnRzWzBdICE9PSAnQmVhcmVyJykge1xuICAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdsb2dpbicsXG4gICAgICAgICAgICBkaWFnbm9zdGljczogJ0ludmFsaWQgYXV0aG9yaXphdGlvbiBoZWFkZXIgZm9ybWF0LiBFeHBlY3RlZDogQmVhcmVyIDx0b2tlbj4nLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0b2tlbiA9IHBhcnRzWzFdO1xuICAgICAgaWYgKCF0b2tlbikge1xuICAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdNSVNTSU5HX1RPS0VOJyxcbiAgICAgICAgICBtZXNzYWdlOiAnTm8gdG9rZW4gcHJvdmlkZWQnXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJlcS50b2tlbiA9IHRva2VuO1xuXG4gICAgICAvLyBUcnkgU01BUlQgdG9rZW4gaW50cm9zcGVjdGlvblxuICAgICAgY29uc3QgaW50cm9zcGVjdGlvblJlc3VsdCA9IGF3YWl0IHNtYXJ0RkhJUlNlcnZpY2UuaW50cm9zcGVjdFRva2VuKHRva2VuKTtcbiAgICAgIFxuICAgICAgaWYgKCFpbnRyb3NwZWN0aW9uUmVzdWx0LmFjdGl2ZSkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdsb2dpbicsXG4gICAgICAgICAgICBkaWFnbm9zdGljczogJ1Rva2VuIGlzIG5vdCBhY3RpdmUnLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICByZXEuc21hcnRBdXRoID0ge1xuICAgICAgICBpZDogaW50cm9zcGVjdGlvblJlc3VsdC5zdWIgfHwgaW50cm9zcGVjdGlvblJlc3VsdC5wYXRpZW50LFxuICAgICAgICBzdWI6IGludHJvc3BlY3Rpb25SZXN1bHQuc3ViLFxuICAgICAgICBzY29wZTogaW50cm9zcGVjdGlvblJlc3VsdC5zY29wZSA/IGludHJvc3BlY3Rpb25SZXN1bHQuc2NvcGUuc3BsaXQoJyAnKSA6IFtdLFxuICAgICAgICBwYXRpZW50OiBpbnRyb3NwZWN0aW9uUmVzdWx0LnBhdGllbnQsXG4gICAgICAgIGVuY291bnRlcjogaW50cm9zcGVjdGlvblJlc3VsdC5lbmNvdW50ZXIsXG4gICAgICAgIGZoaXJVc2VyOiBpbnRyb3NwZWN0aW9uUmVzdWx0LmZoaXJVc2VyLFxuICAgICAgICBpc3M6IGludHJvc3BlY3Rpb25SZXN1bHQuaXNzLFxuICAgICAgICBhdWQ6IGludHJvc3BlY3Rpb25SZXN1bHQuYXVkLFxuICAgICAgICBjbGllbnRJZDogaW50cm9zcGVjdGlvblJlc3VsdC5jbGllbnRfaWQsXG4gICAgICAgIHRva2VuVHlwZTogJ3NtYXJ0JyxcbiAgICAgIH07XG5cbiAgICAgIGxvZ2dlci5zZWN1cml0eSgnU01BUlQgdG9rZW4gYXV0aGVudGljYXRpb24gc3VjY2Vzc2Z1bCcsIHtcbiAgICAgICAgdXNlcklkOiByZXEuc21hcnRBdXRoLmlkLFxuICAgICAgICBjbGllbnRJZDogcmVxLnNtYXJ0QXV0aC5jbGllbnRJZCxcbiAgICAgICAgcGF0aDogcmVxLnBhdGgsXG4gICAgICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcbiAgICAgIH0pO1xuXG4gICAgICBuZXh0KCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignU01BUlQgYXV0aGVudGljYXRpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgIGlzc3VlOiBbe1xuICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgIGNvZGU6ICdsb2dpbicsXG4gICAgICAgICAgZGlhZ25vc3RpY3M6ICdJbnZhbGlkIG9yIGV4cGlyZWQgdG9rZW4nLFxuICAgICAgICB9XSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBPcHRpb25hbCBhdXRoZW50aWNhdGlvbiAtIGFsbG93cyBib3RoIGF1dGhlbnRpY2F0ZWQgYW5kIHVuYXV0aGVudGljYXRlZCByZXF1ZXN0c1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIG9wdGlvbmFsQXV0aGVudGljYXRlKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XG4gICAgXG4gICAgaWYgKCFhdXRoSGVhZGVyKSB7XG4gICAgICAvLyBObyBhdXRoZW50aWNhdGlvbiBwcm92aWRlZCwgY29udGludWUgd2l0aG91dCB1c2VyIGNvbnRleHRcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBBdXRoZW50aWNhdGlvbiBwcm92aWRlZCwgdmFsaWRhdGUgaXRcbiAgICBhd2FpdCBBdXRoTWlkZGxld2FyZS5hdXRoZW50aWNhdGUocmVxLCByZXMsIG5leHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBlcm1pc3Npb24tYmFzZWQgYXV0aG9yaXphdGlvbiBtaWRkbGV3YXJlXG4gICAqL1xuICBzdGF0aWMgcmVxdWlyZVBlcm1pc3Npb24oLi4ucmVxdWlyZWRQZXJtaXNzaW9uczogUGVybWlzc2lvbltdKSB7XG4gICAgcmV0dXJuIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgaWYgKCFyZXEudXNlcikge1xuICAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdBVVRIRU5USUNBVElPTl9SRVFVSVJFRCcsXG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7IHVzZXIgfSA9IHJlcTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgaWYgdXNlciBoYXMgYWxsIHJlcXVpcmVkIHBlcm1pc3Npb25zXG4gICAgICBjb25zdCBoYXNBbGxQZXJtaXNzaW9ucyA9IHJlcXVpcmVkUGVybWlzc2lvbnMuZXZlcnkocGVybWlzc2lvbiA9PiBcbiAgICAgICAgaGFzUGVybWlzc2lvbih1c2VyLnJvbGUsIHBlcm1pc3Npb24pXG4gICAgICApO1xuXG4gICAgICBpZiAoIWhhc0FsbFBlcm1pc3Npb25zKSB7XG4gICAgICAgIGF3YWl0IEF1dGhNaWRkbGV3YXJlLmF1ZGl0U2VydmljZS5sb2dVc2VyQWN0aW9uKFxuICAgICAgICAgIHVzZXIuaWQsXG4gICAgICAgICAgJ3VuYXV0aG9yaXplZF9hY2Nlc3NfYXR0ZW1wdCcsXG4gICAgICAgICAgcmVxLnBhdGgsXG4gICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgIHJlcS5pcCB8fCAndW5rbm93bicsXG4gICAgICAgICAgcmVxLmdldCgnVXNlci1BZ2VudCcpIHx8ICd1bmtub3duJyxcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICBgTWlzc2luZyByZXF1aXJlZCBwZXJtaXNzaW9uczogJHtyZXF1aXJlZFBlcm1pc3Npb25zLmpvaW4oJywgJyl9YFxuICAgICAgICApO1xuXG4gICAgICAgIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgICAgbWVzc2FnZTogJ1lvdSBkbyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGFjY2VzcyB0aGlzIHJlc291cmNlJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBuZXh0KCk7XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSb2xlLWJhc2VkIGF1dGhvcml6YXRpb24gbWlkZGxld2FyZVxuICAgKi9cbiAgc3RhdGljIHJlcXVpcmVSb2xlKC4uLmFsbG93ZWRSb2xlczogVXNlclJvbGVbXSkge1xuICAgIHJldHVybiBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICAgIGlmICghcmVxLnVzZXIpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnQVVUSEVOVElDQVRJT05fUkVRVUlSRUQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCdcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyB1c2VyIH0gPSByZXE7XG4gICAgICBcbiAgICAgIGlmICghYWxsb3dlZFJvbGVzLmluY2x1ZGVzKHVzZXIucm9sZSkpIHtcbiAgICAgICAgYXdhaXQgQXV0aE1pZGRsZXdhcmUuYXVkaXRTZXJ2aWNlLmxvZ1VzZXJBY3Rpb24oXG4gICAgICAgICAgdXNlci5pZCxcbiAgICAgICAgICAndW5hdXRob3JpemVkX3JvbGVfYWNjZXNzJyxcbiAgICAgICAgICByZXEucGF0aCxcbiAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgcmVxLmlwIHx8ICd1bmtub3duJyxcbiAgICAgICAgICByZXEuZ2V0KCdVc2VyLUFnZW50JykgfHwgJ3Vua25vd24nLFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIGBVc2VyIHJvbGUgJHt1c2VyLnJvbGV9IG5vdCBpbiBhbGxvd2VkIHJvbGVzOiAke2FsbG93ZWRSb2xlcy5qb2luKCcsICcpfWBcbiAgICAgICAgKTtcblxuICAgICAgICByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdJTlNVRkZJQ0lFTlRfUFJJVklMRUdFUycsXG4gICAgICAgICAgbWVzc2FnZTogJ1lvdXIgcm9sZSBkb2VzIG5vdCBoYXZlIGFjY2VzcyB0byB0aGlzIHJlc291cmNlJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBuZXh0KCk7XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIaWVyYXJjaGljYWwgcm9sZSBhdXRob3JpemF0aW9uICh1c2VyIG11c3QgaGF2ZSBoaWdoZXIgb3IgZXF1YWwgcm9sZSlcbiAgICovXG4gIHN0YXRpYyByZXF1aXJlTWluaW11bVJvbGUobWluaW11bVJvbGU6IFVzZXJSb2xlKSB7XG4gICAgcmV0dXJuIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgaWYgKCFyZXEudXNlcikge1xuICAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdBVVRIRU5USUNBVElPTl9SRVFVSVJFRCcsXG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7IHVzZXIgfSA9IHJlcTtcbiAgICAgIFxuICAgICAgaWYgKCFoYXNIaWdoZXJSb2xlKHVzZXIucm9sZSwgbWluaW11bVJvbGUpICYmIHVzZXIucm9sZSAhPT0gbWluaW11bVJvbGUpIHtcbiAgICAgICAgYXdhaXQgQXV0aE1pZGRsZXdhcmUuYXVkaXRTZXJ2aWNlLmxvZ1VzZXJBY3Rpb24oXG4gICAgICAgICAgdXNlci5pZCxcbiAgICAgICAgICAnaW5zdWZmaWNpZW50X3JvbGVfbGV2ZWwnLFxuICAgICAgICAgIHJlcS5wYXRoLFxuICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICByZXEuaXAgfHwgJ3Vua25vd24nLFxuICAgICAgICAgIHJlcS5nZXQoJ1VzZXItQWdlbnQnKSB8fCAndW5rbm93bicsXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgYFVzZXIgcm9sZSAke3VzZXIucm9sZX0gYmVsb3cgbWluaW11bSByZXF1aXJlZCByb2xlOiAke21pbmltdW1Sb2xlfWBcbiAgICAgICAgKTtcblxuICAgICAgICByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdJTlNVRkZJQ0lFTlRfUk9MRV9MRVZFTCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1lvdXIgcm9sZSBsZXZlbCBpcyBpbnN1ZmZpY2llbnQgZm9yIHRoaXMgcmVzb3VyY2UnXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG5leHQoKTtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFBhdGllbnQtc3BlY2lmaWMgYXV0aG9yaXphdGlvbiAtIGVuc3VyZSB1c2VyIGNhbiBhY2Nlc3Mgc3BlY2lmaWMgcGF0aWVudCBkYXRhXG4gICAqL1xuICBzdGF0aWMgcmVxdWlyZVBhdGllbnRBY2Nlc3MocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiB2b2lkIHtcbiAgICBpZiAoIXJlcS51c2VyKSB7XG4gICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgIHJlc291cmNlVHlwZTogJ09wZXJhdGlvbk91dGNvbWUnLFxuICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICBjb2RlOiAnbG9naW4nLFxuICAgICAgICAgIGRpYWdub3N0aWNzOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICB9XSxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHJlcXVlc3RlZFBhdGllbnRJZCA9IHJlcS5wYXJhbXMucGF0aWVudElkIHx8IHJlcS5wYXJhbXMuaWQ7XG4gICAgY29uc3QgYXV0aG9yaXplZFBhdGllbnRJZCA9IHJlcS51c2VyLnBhdGllbnQ7XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyBzeXN0ZW0tbGV2ZWwgYWNjZXNzXG4gICAgY29uc3QgaGFzU3lzdGVtQWNjZXNzID0gcmVxLnVzZXIuc2NvcGU/LnNvbWUoc2NvcGUgPT4gXG4gICAgICBzY29wZS5pbmNsdWRlcygnc3lzdGVtLycpIHx8IHNjb3BlID09PSAnKidcbiAgICApO1xuXG4gICAgaWYgKGhhc1N5c3RlbUFjY2Vzcykge1xuICAgICAgLy8gU3lzdGVtLWxldmVsIGFjY2VzcyBhbGxvd3MgYWNjZXNzIHRvIGFueSBwYXRpZW50XG4gICAgICBuZXh0KCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gRm9yIHBhdGllbnQtbGV2ZWwgYWNjZXNzLCB2ZXJpZnkgcGF0aWVudCBJRCBtYXRjaGVzXG4gICAgaWYgKCFhdXRob3JpemVkUGF0aWVudElkKSB7XG4gICAgICBsb2dnZXIuc2VjdXJpdHkoJ1BhdGllbnQgYWNjZXNzIGRlbmllZCAtIG5vIHBhdGllbnQgY29udGV4dCcsIHtcbiAgICAgICAgdXNlcklkOiByZXEudXNlci5pZCxcbiAgICAgICAgcmVxdWVzdGVkUGF0aWVudElkLFxuICAgICAgICBwYXRoOiByZXEucGF0aCxcbiAgICAgICAgbWV0aG9kOiByZXEubWV0aG9kLFxuICAgICAgfSk7XG4gICAgICByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgIHJlc291cmNlVHlwZTogJ09wZXJhdGlvbk91dGNvbWUnLFxuICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICBjb2RlOiAnZm9yYmlkZGVuJyxcbiAgICAgICAgICBkaWFnbm9zdGljczogJ05vIHBhdGllbnQgY29udGV4dCBhdmFpbGFibGUnLFxuICAgICAgICB9XSxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChyZXF1ZXN0ZWRQYXRpZW50SWQgJiYgYXV0aG9yaXplZFBhdGllbnRJZCAhPT0gcmVxdWVzdGVkUGF0aWVudElkKSB7XG4gICAgICBsb2dnZXIuc2VjdXJpdHkoJ1BhdGllbnQgYWNjZXNzIGRlbmllZCAtIHBhdGllbnQgSUQgbWlzbWF0Y2gnLCB7XG4gICAgICAgIHVzZXJJZDogcmVxLnVzZXIuaWQsXG4gICAgICAgIGF1dGhvcml6ZWRQYXRpZW50SWQsXG4gICAgICAgIHJlcXVlc3RlZFBhdGllbnRJZCxcbiAgICAgICAgcGF0aDogcmVxLnBhdGgsXG4gICAgICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcbiAgICAgIH0pO1xuICAgICAgcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgY29kZTogJ2ZvcmJpZGRlbicsXG4gICAgICAgICAgZGlhZ25vc3RpY3M6ICdBY2Nlc3MgZGVuaWVkIHRvIHJlcXVlc3RlZCBwYXRpZW50JyxcbiAgICAgICAgfV0sXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBuZXh0KCk7XG4gIH1cblxuICAvKipcbiAgICogUmVzb3VyY2Utc3BlY2lmaWMgYXV0aG9yaXphdGlvbiBtaWRkbGV3YXJlXG4gICAqL1xuICBzdGF0aWMgcmVxdWlyZVJlc291cmNlQWNjZXNzKHJlc291cmNlVHlwZTogc3RyaW5nLCBvcGVyYXRpb246ICdyZWFkJyB8ICd3cml0ZScgfCAnY3JlYXRlJyB8ICdkZWxldGUnIHwgJyonKSB7XG4gICAgcmV0dXJuIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IHZvaWQgPT4ge1xuICAgICAgaWYgKCFyZXEudXNlcikge1xuICAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdsb2dpbicsXG4gICAgICAgICAgICBkaWFnbm9zdGljczogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXNlclNjb3BlcyA9IHJlcS51c2VyLnNjb3BlIHx8IFtdO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBmb3Igc3BlY2lmaWMgcmVzb3VyY2UgYWNjZXNzXG4gICAgICBjb25zdCByZXNvdXJjZVNjb3BlcyA9IFtcbiAgICAgICAgYHN5c3RlbS8ke3Jlc291cmNlVHlwZX0uJHtvcGVyYXRpb259YCxcbiAgICAgICAgYHN5c3RlbS8ke3Jlc291cmNlVHlwZX0uKmAsXG4gICAgICAgIGB1c2VyLyR7cmVzb3VyY2VUeXBlfS4ke29wZXJhdGlvbn1gLFxuICAgICAgICBgdXNlci8ke3Jlc291cmNlVHlwZX0uKmAsXG4gICAgICAgIGBwYXRpZW50LyR7cmVzb3VyY2VUeXBlfS4ke29wZXJhdGlvbn1gLFxuICAgICAgICBgcGF0aWVudC8ke3Jlc291cmNlVHlwZX0uKmAsXG4gICAgICAgIG9wZXJhdGlvbiA9PT0gJ3JlYWQnID8gYHN5c3RlbS8ke3Jlc291cmNlVHlwZX0ucmVhZGAgOiBudWxsLFxuICAgICAgICBvcGVyYXRpb24gPT09ICd3cml0ZScgPyBgc3lzdGVtLyR7cmVzb3VyY2VUeXBlfS53cml0ZWAgOiBudWxsLFxuICAgICAgICAnKicsXG4gICAgICBdLmZpbHRlcihCb29sZWFuKSBhcyBzdHJpbmdbXTtcblxuICAgICAgY29uc3QgaGFzQWNjZXNzID0gcmVzb3VyY2VTY29wZXMuc29tZShzY29wZSA9PiB1c2VyU2NvcGVzLmluY2x1ZGVzKHNjb3BlKSk7XG5cbiAgICAgIGlmICghaGFzQWNjZXNzKSB7XG4gICAgICAgIGxvZ2dlci5zZWN1cml0eSgnUmVzb3VyY2UgYWNjZXNzIGRlbmllZCcsIHtcbiAgICAgICAgICB1c2VySWQ6IHJlcS51c2VyLmlkLFxuICAgICAgICAgIHJlc291cmNlVHlwZSxcbiAgICAgICAgICBvcGVyYXRpb24sXG4gICAgICAgICAgdXNlclNjb3BlcyxcbiAgICAgICAgICBwYXRoOiByZXEucGF0aCxcbiAgICAgICAgICBtZXRob2Q6IHJlcS5tZXRob2QsXG4gICAgICAgIH0pO1xuICAgICAgICByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdmb3JiaWRkZW4nLFxuICAgICAgICAgICAgZGlhZ25vc3RpY3M6IGBJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMgZm9yICR7cmVzb3VyY2VUeXBlfSAke29wZXJhdGlvbn1gLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBuZXh0KCk7XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTTUFSVCBvbiBGSElSIHNjb3BlIGF1dGhvcml6YXRpb24gbWlkZGxld2FyZVxuICAgKi9cbiAgc3RhdGljIHJlcXVpcmVTY29wZShyZXF1aXJlZFNjb3Blczogc3RyaW5nW10pIHtcbiAgICByZXR1cm4gKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogdm9pZCA9PiB7XG4gICAgICBpZiAoIXJlcS51c2VyICYmICFyZXEuc21hcnRBdXRoKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgICAgY29kZTogJ2xvZ2luJyxcbiAgICAgICAgICAgIGRpYWdub3N0aWNzOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB1c2VyU2NvcGVzID0gcmVxLnVzZXI/LnNjb3BlIHx8IHJlcS5zbWFydEF1dGg/LnNjb3BlIHx8IFtdO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyBhbnkgb2YgdGhlIHJlcXVpcmVkIHNjb3Blc1xuICAgICAgY29uc3QgaGFzUmVxdWlyZWRTY29wZSA9IHJlcXVpcmVkU2NvcGVzLnNvbWUocmVxdWlyZWRTY29wZSA9PiB7XG4gICAgICAgIC8vIENoZWNrIGZvciBleGFjdCBtYXRjaFxuICAgICAgICBpZiAodXNlclNjb3Blcy5pbmNsdWRlcyhyZXF1aXJlZFNjb3BlKSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBDaGVjayBmb3Igd2lsZGNhcmQgbWF0Y2hlc1xuICAgICAgICBpZiAodXNlclNjb3Blcy5pbmNsdWRlcygnKicpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIGZvciBwYXJ0aWFsIHdpbGRjYXJkIG1hdGNoZXMgKGUuZy4sIHN5c3RlbS8qIG1hdGNoZXMgc3lzdGVtLyoucmVhZClcbiAgICAgICAgY29uc3Qgc2NvcGVQYXJ0cyA9IHJlcXVpcmVkU2NvcGUuc3BsaXQoJy8nKTtcbiAgICAgICAgY29uc3QgcmVzb3VyY2VQYXJ0ID0gc2NvcGVQYXJ0c1swXTtcbiAgICAgICAgY29uc3QgcGVybWlzc2lvblBhcnQgPSBzY29wZVBhcnRzWzFdO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHVzZXJTY29wZXMuc29tZSh1c2VyU2NvcGUgPT4ge1xuICAgICAgICAgIGlmICh1c2VyU2NvcGUgPT09IGAke3Jlc291cmNlUGFydH0vKmApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocGVybWlzc2lvblBhcnQgJiYgdXNlclNjb3BlID09PSBgJHtyZXNvdXJjZVBhcnR9LyR7cGVybWlzc2lvblBhcnQuc3BsaXQoJy4nKVswXX0uKmApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGlmICghaGFzUmVxdWlyZWRTY29wZSkge1xuICAgICAgICBsb2dnZXIuc2VjdXJpdHkoJ1Njb3BlIGFjY2VzcyBkZW5pZWQnLCB7XG4gICAgICAgICAgdXNlcklkOiByZXEudXNlcj8uaWQgfHwgcmVxLnNtYXJ0QXV0aD8uaWQsXG4gICAgICAgICAgcmVxdWlyZWRTY29wZXMsXG4gICAgICAgICAgdXNlclNjb3BlcyxcbiAgICAgICAgICBwYXRoOiByZXEucGF0aCxcbiAgICAgICAgICBtZXRob2Q6IHJlcS5tZXRob2QsXG4gICAgICAgIH0pO1xuICAgICAgICByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgICAgIGNvZGU6ICdmb3JiaWRkZW4nLFxuICAgICAgICAgICAgZGlhZ25vc3RpY3M6IGBJbnN1ZmZpY2llbnQgc2NvcGVzLiBSZXF1aXJlZDogJHtyZXF1aXJlZFNjb3Blcy5qb2luKCcgb3IgJyl9YCxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbmV4dCgpO1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQWRtaW4gcm9sZSBhdXRob3JpemF0aW9uXG4gICAqL1xuICBzdGF0aWMgcmVxdWlyZUFkbWluKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogdm9pZCB7XG4gICAgaWYgKCFyZXEudXNlcikge1xuICAgICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgaXNzdWU6IFt7XG4gICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICAgICAgY29kZTogJ2xvZ2luJyxcbiAgICAgICAgICBkaWFnbm9zdGljczogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgfV0sXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBpc0FkbWluID0gcmVxLnVzZXIuc2NvcGU/LmluY2x1ZGVzKCdhZG1pbicpIHx8IFxuICAgICAgICAgICAgICAgICAgIHJlcS51c2VyLnNjb3BlPy5pbmNsdWRlcygnKicpIHx8XG4gICAgICAgICAgICAgICAgICAgcmVxLnVzZXIuc2NvcGU/LmluY2x1ZGVzKCdzeXN0ZW0vKi4qJyk7XG5cbiAgICBpZiAoIWlzQWRtaW4pIHtcbiAgICAgIGxvZ2dlci5zZWN1cml0eSgnQWRtaW4gYWNjZXNzIGRlbmllZCcsIHtcbiAgICAgICAgdXNlcklkOiByZXEudXNlci5pZCxcbiAgICAgICAgdXNlclNjb3BlczogcmVxLnVzZXIuc2NvcGUsXG4gICAgICAgIHBhdGg6IHJlcS5wYXRoLFxuICAgICAgICBtZXRob2Q6IHJlcS5tZXRob2QsXG4gICAgICB9KTtcbiAgICAgIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgcmVzb3VyY2VUeXBlOiAnT3BlcmF0aW9uT3V0Y29tZScsXG4gICAgICAgIGlzc3VlOiBbe1xuICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgIGNvZGU6ICdmb3JiaWRkZW4nLFxuICAgICAgICAgIGRpYWdub3N0aWNzOiAnQWRtaW5pc3RyYXRvciBwcml2aWxlZ2VzIHJlcXVpcmVkJyxcbiAgICAgICAgfV0sXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBuZXh0KCk7XG4gIH1cblxuICAvKipcbiAgICogTW9jayB1c2VyIGxvb2t1cCAtIHJlcGxhY2Ugd2l0aCBhY3R1YWwgZGF0YWJhc2UgcXVlcnlcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGFzeW5jIGdldFVzZXJCeUlkKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxVc2VyIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIC0gcmVwbGFjZSB3aXRoIGFjdHVhbCBkYXRhYmFzZSBxdWVyeVxuICAgICAgY29uc3QgbW9ja1VzZXJzOiBSZWNvcmQ8c3RyaW5nLCBVc2VyPiA9IHtcbiAgICAgICAgJ3VzZXItMSc6IHtcbiAgICAgICAgICBpZDogJ3VzZXItMScsXG4gICAgICAgICAgdXNlcm5hbWU6ICdhZG1pbkBvbW5pY2FyZS5jb20nLFxuICAgICAgICAgIGVtYWlsOiAnYWRtaW5Ab21uaWNhcmUuY29tJyxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdTeXN0ZW0nLFxuICAgICAgICAgIGxhc3ROYW1lOiAnQWRtaW5pc3RyYXRvcicsXG4gICAgICAgICAgcm9sZTogVXNlclJvbGVzLlNZU1RFTV9BRE1JTklTVFJBVE9SLFxuICAgICAgICAgIGRlcGFydG1lbnQ6ICdJVCcsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgaXNNZmFFbmFibGVkOiB0cnVlLFxuICAgICAgICAgIHBhc3N3b3JkQ2hhbmdlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGZhaWxlZExvZ2luQXR0ZW1wdHM6IDAsXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxuICAgICAgICB9LFxuICAgICAgICAndXNlci0yJzoge1xuICAgICAgICAgIGlkOiAndXNlci0yJyxcbiAgICAgICAgICB1c2VybmFtZTogJ2RvY3RvckBvbW5pY2FyZS5jb20nLFxuICAgICAgICAgIGVtYWlsOiAnZG9jdG9yQG9tbmljYXJlLmNvbScsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnRHIuIEphbmUnLFxuICAgICAgICAgIGxhc3ROYW1lOiAnU21pdGgnLFxuICAgICAgICAgIHJvbGU6IFVzZXJSb2xlcy5QSFlTSUNJQU4sXG4gICAgICAgICAgZGVwYXJ0bWVudDogJ0NhcmRpb2xvZ3knLFxuICAgICAgICAgIGxpY2Vuc2VOdW1iZXI6ICdNRDEyMzQ1NicsXG4gICAgICAgICAgbnBpTnVtYmVyOiAnMTIzNDU2Nzg5MCcsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgaXNNZmFFbmFibGVkOiB0cnVlLFxuICAgICAgICAgIHBhc3N3b3JkQ2hhbmdlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGZhaWxlZExvZ2luQXR0ZW1wdHM6IDAsXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxuICAgICAgICB9LFxuICAgICAgICAndXNlci0zJzoge1xuICAgICAgICAgIGlkOiAndXNlci0zJyxcbiAgICAgICAgICB1c2VybmFtZTogJ251cnNlQG9tbmljYXJlLmNvbScsXG4gICAgICAgICAgZW1haWw6ICdudXJzZUBvbW5pY2FyZS5jb20nLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ1NhcmFoJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ0pvaG5zb24nLFxuICAgICAgICAgIHJvbGU6IFVzZXJSb2xlcy5OVVJTSU5HX1NUQUZGLFxuICAgICAgICAgIGRlcGFydG1lbnQ6ICdFbWVyZ2VuY3knLFxuICAgICAgICAgIGxpY2Vuc2VOdW1iZXI6ICdSTjc4OTAxMicsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgaXNNZmFFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICBwYXNzd29yZENoYW5nZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICBmYWlsZWRMb2dpbkF0dGVtcHRzOiAwLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgcmV0dXJuIG1vY2tVc2Vyc1t1c2VySWRdIHx8IG51bGw7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignR2V0IHVzZXIgYnkgSUQgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSYXRlIGxpbWl0aW5nIGJhc2VkIG9uIHVzZXIgb3IgY2xpZW50XG4gICAqL1xuICBzdGF0aWMgY3JlYXRlUmF0ZUxpbWl0ZXIod2luZG93TXM6IG51bWJlciA9IDE1ICogNjAgKiAxMDAwLCBtYXg6IG51bWJlciA9IDEwMCkge1xuICAgIGNvbnN0IHJhdGVMaW1pdFN0b3JlID0gbmV3IE1hcDxzdHJpbmcsIHsgY291bnQ6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXIgfT4oKTtcbiAgICBcbiAgICByZXR1cm4gKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCBrZXkgPSByZXEudXNlcj8uaWQgfHwgcmVxLnVzZXI/LmNsaWVudElkIHx8IHJlcS5pcCB8fCAndW5rbm93bic7XG4gICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgXG4gICAgICBjb25zdCB1c2VyTGltaXQgPSByYXRlTGltaXRTdG9yZS5nZXQoa2V5KTtcbiAgICAgIFxuICAgICAgaWYgKCF1c2VyTGltaXQgfHwgbm93ID4gdXNlckxpbWl0LnJlc2V0VGltZSkge1xuICAgICAgICAvLyBSZXNldCBvciBjcmVhdGUgbmV3IGxpbWl0XG4gICAgICAgIHJhdGVMaW1pdFN0b3JlLnNldChrZXksIHtcbiAgICAgICAgICBjb3VudDogMSxcbiAgICAgICAgICByZXNldFRpbWU6IG5vdyArIHdpbmRvd01zLFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmF0ZUxpbWl0LUxpbWl0JywgbWF4KTtcbiAgICAgICAgcmVzLnNldEhlYWRlcignWC1SYXRlTGltaXQtUmVtYWluaW5nJywgbWF4IC0gMSk7XG4gICAgICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmF0ZUxpbWl0LVJlc2V0JywgbmV3IERhdGUobm93ICsgd2luZG93TXMpLnRvSVNPU3RyaW5nKCkpO1xuICAgICAgICBcbiAgICAgICAgbmV4dCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmICh1c2VyTGltaXQuY291bnQgPj0gbWF4KSB7XG4gICAgICAgIGxvZ2dlci5zZWN1cml0eSgnUmF0ZSBsaW1pdCBleGNlZWRlZCcsIHtcbiAgICAgICAgICBrZXksXG4gICAgICAgICAgdXNlcklkOiByZXEudXNlcj8uaWQsXG4gICAgICAgICAgY2xpZW50SWQ6IHJlcS51c2VyPy5jbGllbnRJZCxcbiAgICAgICAgICBwYXRoOiByZXEucGF0aCxcbiAgICAgICAgICBtZXRob2Q6IHJlcS5tZXRob2QsXG4gICAgICAgICAgY291bnQ6IHVzZXJMaW1pdC5jb3VudCxcbiAgICAgICAgICBsaW1pdDogbWF4LFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHJlcy5zdGF0dXMoNDI5KS5qc29uKHtcbiAgICAgICAgICByZXNvdXJjZVR5cGU6ICdPcGVyYXRpb25PdXRjb21lJyxcbiAgICAgICAgICBpc3N1ZTogW3tcbiAgICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgICAgY29kZTogJ3Rocm90dGxlZCcsXG4gICAgICAgICAgICBkaWFnbm9zdGljczogJ1JhdGUgbGltaXQgZXhjZWVkZWQuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdXNlckxpbWl0LmNvdW50Kys7XG4gICAgICByYXRlTGltaXRTdG9yZS5zZXQoa2V5LCB1c2VyTGltaXQpO1xuICAgICAgXG4gICAgICByZXMuc2V0SGVhZGVyKCdYLVJhdGVMaW1pdC1MaW1pdCcsIG1heCk7XG4gICAgICByZXMuc2V0SGVhZGVyKCdYLVJhdGVMaW1pdC1SZW1haW5pbmcnLCBtYXggLSB1c2VyTGltaXQuY291bnQpO1xuICAgICAgcmVzLnNldEhlYWRlcignWC1SYXRlTGltaXQtUmVzZXQnLCBuZXcgRGF0ZSh1c2VyTGltaXQucmVzZXRUaW1lKS50b0lTT1N0cmluZygpKTtcbiAgICAgIFxuICAgICAgbmV4dCgpO1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQXVkaXQgbG9nZ2luZyBtaWRkbGV3YXJlXG4gICAqL1xuICBzdGF0aWMgYXVkaXRMb2cocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiB2b2lkIHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIFxuICAgIC8vIExvZyByZXF1ZXN0XG4gICAgbG9nZ2VyLmF1ZGl0KCdBUEkgcmVxdWVzdCBpbml0aWF0ZWQnLCB7XG4gICAgICB1c2VySWQ6IHJlcS51c2VyPy5pZCxcbiAgICAgIGNsaWVudElkOiByZXEudXNlcj8uY2xpZW50SWQsXG4gICAgICBtZXRob2Q6IHJlcS5tZXRob2QsXG4gICAgICBwYXRoOiByZXEucGF0aCxcbiAgICAgIHF1ZXJ5OiByZXEucXVlcnksXG4gICAgICB1c2VyQWdlbnQ6IHJlcS5nZXQoJ1VzZXItQWdlbnQnKSxcbiAgICAgIGlwOiByZXEuaXAsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9KTtcblxuICAgIC8vIE92ZXJyaWRlIHJlcy5qc29uIHRvIGxvZyByZXNwb25zZVxuICAgIGNvbnN0IG9yaWdpbmFsSnNvbiA9IHJlcy5qc29uO1xuICAgIHJlcy5qc29uID0gZnVuY3Rpb24oYm9keTogYW55KSB7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBcbiAgICAgIGxvZ2dlci5hdWRpdCgnQVBJIHJlcXVlc3QgY29tcGxldGVkJywge1xuICAgICAgICB1c2VySWQ6IHJlcS51c2VyPy5pZCxcbiAgICAgICAgY2xpZW50SWQ6IHJlcS51c2VyPy5jbGllbnRJZCxcbiAgICAgICAgbWV0aG9kOiByZXEubWV0aG9kLFxuICAgICAgICBwYXRoOiByZXEucGF0aCxcbiAgICAgICAgc3RhdHVzQ29kZTogcmVzLnN0YXR1c0NvZGUsXG4gICAgICAgIGR1cmF0aW9uOiBgJHtkdXJhdGlvbn1tc2AsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJldHVybiBvcmlnaW5hbEpzb24uY2FsbCh0aGlzLCBib2R5KTtcbiAgICB9O1xuXG4gICAgbmV4dCgpO1xuICB9XG59XG5cbi8vIENvbnZlbmllbmNlIGV4cG9ydHMgZm9yIE9tbmlDYXJlIGF1dGhlbnRpY2F0aW9uXG5leHBvcnQgY29uc3QgYXV0aGVudGljYXRlID0gQXV0aE1pZGRsZXdhcmUuYXV0aGVudGljYXRlO1xuZXhwb3J0IGNvbnN0IGF1dGhNaWRkbGV3YXJlID0gQXV0aE1pZGRsZXdhcmUuYXV0aGVudGljYXRlOyAvLyBBbGlhcyBmb3IgdGVzdCBjb21wYXRpYmlsaXR5XG5leHBvcnQgY29uc3QgYXV0aGVudGljYXRlVG9rZW4gPSBBdXRoTWlkZGxld2FyZS5hdXRoZW50aWNhdGU7IC8vIEFsaWFzIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG5leHBvcnQgY29uc3Qgc21hcnRBdXRoZW50aWNhdGUgPSBBdXRoTWlkZGxld2FyZS5zbWFydEF1dGhlbnRpY2F0ZTtcbmV4cG9ydCBjb25zdCBvcHRpb25hbEF1dGhlbnRpY2F0ZSA9IEF1dGhNaWRkbGV3YXJlLm9wdGlvbmFsQXV0aGVudGljYXRlO1xuZXhwb3J0IGNvbnN0IHJlcXVpcmVQZXJtaXNzaW9uID0gQXV0aE1pZGRsZXdhcmUucmVxdWlyZVBlcm1pc3Npb247XG5leHBvcnQgY29uc3QgcmVxdWlyZVBlcm1pc3Npb25zID0gQXV0aE1pZGRsZXdhcmUucmVxdWlyZVBlcm1pc3Npb247IC8vIEFsaWFzIGZvciB0ZXN0IGNvbXBhdGliaWxpdHlcbmV4cG9ydCBjb25zdCByZXF1aXJlUm9sZSA9IEF1dGhNaWRkbGV3YXJlLnJlcXVpcmVSb2xlO1xuZXhwb3J0IGNvbnN0IHJlcXVpcmVNaW5pbXVtUm9sZSA9IEF1dGhNaWRkbGV3YXJlLnJlcXVpcmVNaW5pbXVtUm9sZTtcbmV4cG9ydCBjb25zdCByZXF1aXJlUGF0aWVudEFjY2VzcyA9IEF1dGhNaWRkbGV3YXJlLnJlcXVpcmVQYXRpZW50QWNjZXNzO1xuZXhwb3J0IGNvbnN0IHJlcXVpcmVSZXNvdXJjZUFjY2VzcyA9IEF1dGhNaWRkbGV3YXJlLnJlcXVpcmVSZXNvdXJjZUFjY2VzcztcbmV4cG9ydCBjb25zdCByZXF1aXJlQWRtaW4gPSBBdXRoTWlkZGxld2FyZS5yZXF1aXJlQWRtaW47XG5leHBvcnQgY29uc3QgYXVkaXRMb2cgPSBBdXRoTWlkZGxld2FyZS5hdWRpdExvZztcbmV4cG9ydCBjb25zdCByZXF1aXJlU2NvcGUgPSBBdXRoTWlkZGxld2FyZS5yZXF1aXJlU2NvcGU7Il0sInZlcnNpb24iOjN9